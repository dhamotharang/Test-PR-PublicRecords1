IMPORT SALT311,STD;
EXPORT Delta(DATASET(Layout_BKForeclosure_Reo)old_s, DATASET(Layout_BKForeclosure_Reo) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['foreclosure_id','ln_filedate','bk_infile_type','fips_cd','prop_full_addr','prop_addr_city','prop_addr_state','prop_addr_zip5','prop_addr_zip4','prop_addr_unit_type','prop_addr_unit_no','prop_addr_house_no','prop_addr_predir','prop_addr_street','prop_addr_suffix','prop_addr_postdir','prop_addr_carrier_rt','recording_date','recording_book_num','recording_page_num','recording_doc_num','doc_type_cd','apn','multi_apn','partial_interest_trans','seller1_fname','seller1_lname','seller1_id','seller2_fname','seller2_lname','buyer1_fname','buyer1_lname','buyer1_id_cd','buyer2_fname','buyer2_lname','buyer_vesting_cd','concurrent_doc_num','buyer_mail_city','buyer_mail_state','buyer_mail_zip5','buyer_mail_zip4','legal_lot_cd','legal_lot_num','legal_block','legal_section','legal_district','legal_land_lot','legal_unit','legacl_city','legal_subdivision','legal_phase_num','legal_tract_num','legal_brief_desc','legal_township','recorder_map_ref','prop_buyer_mail_addr_cd','property_use_cd','orig_contract_date','sales_price','sales_price_cd','city_xfer_tax','county_xfer_tax','total_xfer_tax','concurrent_lender_name','concurrent_lender_type','concurrent_loan_amt','concurrent_loan_type','concurrent_type_fin','concurrent_interest_rate','concurrent_due_dt','concurrent_2nd_loan_amt','buyer_mail_full_addr','buyer_mail_unit_type','buyer_mail_unit_no','lps_internal_pid','buyer_mail_careof','title_co_name','legal_desc_cd','adj_rate_rider','adj_rate_index','change_index','rate_change_freq','int_rate_ngt','int_rate_nlt','max_int_rate','int_only_period','fixed_rate_rider','first_chg_dt_yy','first_chg_dt_mmdd','prepayment_rider','prepayment_term','asses_land_use','res_indicator','construction_loan','inter_family','cash_purchase','stand_alone_refi','equity_credit_line','reo_flag','distressedsaleflag'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := hygiene(old_s).Summary('Old') + hygiene(new_s).Summary('New') + hygiene(PROJECT(Differences(deleted), TRANSFORM(Layout_BKForeclosure_Reo, SELF := LEFT.old_rec))).Summary('Deletions') + hygiene(PROJECT(Differences(added), TRANSFORM(Layout_BKForeclosure_Reo, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_BKForeclosure_Reo, Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
