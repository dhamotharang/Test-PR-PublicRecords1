IMPORT SALT311,STD;
EXPORT Delta(DATASET(Layout_LaborActions_WHD)old_s, DATASET(Layout_LaborActions_WHD) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['dartid','dateadded','dateupdated','website','state','caseid','employername','address1','city','employerstate','zipcode','naicscode','totalviolations','bw_totalagreedamount','cmp_totalassessments','ee_totalviolations','ee_totalagreedcount','ca_countviolations','ca_bw_agreedamount','ca_ee_agreedcount','ccpa_countviolations','ccpa_bw_agreedamount','ccpa_ee_agreedcount','crew_countviolations','crew_bw_agreedamount','crew_cmp_assessedamount','crew_ee_agreedcount','cwhssa_countviolations','cwhssa_bw_agreedamount','cwhssa_ee_agreedcount','dbra_cl_countviolations','dbra_bw_agreedamount','dbra_ee_agreedcount','eev_countviolations','eppa_countviolations','eppa_bw_agreedamount','eppa_cmp_assessedamount','eppa_ee_agreedcount','flsa_countviolations','flsa_bw_15a3_agreedamount','flsa_bw_agreedamount','flsa_bw_minwage_agreedamount','flsa_bw_overtime_agreedamount','flsa_cmp_assessedamount','flsa_ee_agreedcount','flsa_cl_countviolations','flsa_cl_countminorsemployed','flsa_cl_cmp_assessedamount','flsa_hmwkr_countviolations','flsa_hmwkr_bw_agreedamount','flsa_hmwkr_cmp_assessedamount','flsa_hmwkr_ee_agreedcount','flsa_smw14_bw_agreedamount','flsa_smw14_countviolations','flsa_smw14_ee_agreedcount','flsa_smwap_countviolations','flsa_smwap_bw_agreedamount','flsa_smwap_ee_agreedcount','flsa_smwft_countviolations','flsa_smwft_bw_agreedamount','flsa_smwft_ee_agreedcount','flsa_smwl_countviolations','flsa_smwl_bw_agreedamount','flsa_smwl_ee_agreedcount','flsa_smwmg_countviolations','flsa_smwmg_bw_agreedamount','flsa_smwmg_ee_agreedcount','flsa_smwpw_countviolations','flsa_smwpw_bw_agreedamount','flsa_smwpw_ee_agreedcount','flsa_smwsl_countviolations','flsa_smwsl_bw_agreedamount','flsa_smwsl_ee_agreedcount','fmla_countviolations','fmla_bw_agreedamount','fmla_cmp_assessedamount','fmla_ee_agreedcount','h1a_countviolations','h1a_bw_agreedamount','h1a_cmp_assessedamount','h1a_ee_agreedcount','h1b_countviolations','h1b_bw_agreedamount','h1b_cmp_assessedamount','h1b_ee_agreedcount','h2a_countviolations','h2a_bw_agreedamount','h2a_cmp_assessedamount','h2a_ee_agreedcount','h2b_countviolations','h2b_bw_agreedamount','h2b_ee_agreedcount','mpsa_countviolations','mpsa_bw_agreedamount','mpsa_cmp_assessedamount','mpsa_ee_agreedcount','osha_countviolations','osha_bw_agreedamount','osha_cmp_assessedamount','osha_ee_agreedcount','pca_countviolations','pca_bw_agreedamount','pca_ee_agreedcount','sca_countviolations','sca_bw_agreedamount','sca_ee_agreedcount','sraw_countviolations','sraw_bw_agreedamount','sraw_ee_agreedcount'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := hygiene(old_s).Summary('Old') + hygiene(new_s).Summary('New') + hygiene(PROJECT(Differences(deleted), TRANSFORM(Layout_LaborActions_WHD, SELF := LEFT.old_rec))).Summary('Deletions') + hygiene(PROJECT(Differences(added), TRANSFORM(Layout_LaborActions_WHD, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_LaborActions_WHD, Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
