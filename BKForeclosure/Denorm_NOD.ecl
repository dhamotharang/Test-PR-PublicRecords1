IMPORT $,ut,STD;

EXPORT Denorm_NOD (DATASET(Layout_BK.base_nod_ext) Base_nod, DATASET(Layout_BK.CleanFields_NOD) Norm_nod) := FUNCTION

//Project base back into original layout
Layout_BK.base_nod SlimBase(Base_nod L) := TRANSFORM
		SELF.name1.dotid			:= L.name1_dotid;
		SELF.name1.dotscore		:= L.name1_dotscore;
		SELF.name1.dotweight	:= L.name1_dotweight;
		SELF.name1.empid			:= L.name1_empid;
		SELF.name1.empscore		:= L.name1_empscore;
		SELF.name1.empweight	:= L.name1_empweight;
		SELF.name1.powid			:= L.name1_powid;
		SELF.name1.powscore		:= L.name1_powscore;
		SELF.name1.powweight	:= L.name1_powweight;
		SELF.name1.proxid			:= L.name1_proxid;
		SELF.name1.proxscore	:= L.name1_proxscore;
		SELF.name1.proxweight	:= L.name1_proxweight;
		SELF.name1.seleid			:= L.name1_seleid;
		SELF.name1.selescore	:= L.name1_selescore;
		SELF.name1.seleweight	:= L.name1_seleweight;
		SELF.name1.orgid			:= L.name1_orgid;
		SELF.name1.orgscore		:= L.name1_orgscore;
		SELF.name1.orgweight	:= L.name1_orgweight;
		SELF.name1.ultid			:= L.name1_ultid;
		SELF.name1.ultscore		:= L.name1_ultscore;
		SELF.name1.ultweight	:= L.name1_ultweight;
		SELF.name2.dotid			:= L.name2_dotid;
		SELF.name2.dotscore		:= L.name2_dotscore;
		SELF.name2.dotweight	:= L.name2_dotweight;
		SELF.name2.empid			:= L.name2_empid;
		SELF.name2.empscore		:= L.name2_empscore;
		SELF.name2.empweight	:= L.name2_empweight;
		SELF.name2.powid			:= L.name2_powid;
		SELF.name2.powscore		:= L.name2_powscore;
		SELF.name2.powweight	:= L.name2_powweight;
		SELF.name2.proxid			:= L.name2_proxid;
		SELF.name2.proxscore	:= L.name2_proxscore;
		SELF.name2.proxweight	:= L.name2_proxweight;
		SELF.name2.seleid			:= L.name2_seleid;
		SELF.name2.selescore	:= L.name2_selescore;
		SELF.name2.seleweight	:= L.name2_seleweight;
		SELF.name2.orgid			:= L.name2_orgid;
		SELF.name2.orgscore		:= L.name2_orgscore;
		SELF.name2.orgweight	:= L.name2_orgweight;
		SELF.name2.ultid			:= L.name2_ultid;
		SELF.name2.ultscore		:= L.name2_ultscore;
		SELF.name2.ultweight	:= L.name2_ultweight;
		SELF.name3.dotid			:= L.name3_dotid;
		SELF.name3.dotscore		:= L.name3_dotscore;
		SELF.name3.dotweight	:= L.name3_dotweight;
		SELF.name3.empid			:= L.name3_empid;
		SELF.name3.empscore		:= L.name3_empscore;
		SELF.name3.empweight	:= L.name3_empweight;
		SELF.name3.powid			:= L.name3_powid;
		SELF.name3.powscore		:= L.name3_powscore;
		SELF.name3.powweight	:= L.name3_powweight;
		SELF.name3.proxid			:= L.name3_proxid;
		SELF.name3.proxscore	:= L.name3_proxscore;
		SELF.name3.proxweight	:= L.name3_proxweight;
		SELF.name3.seleid			:= L.name3_seleid;
		SELF.name3.selescore	:= L.name3_selescore;
		SELF.name3.seleweight	:= L.name3_seleweight;
		SELF.name3.orgid			:= L.name3_orgid;
		SELF.name3.orgscore		:= L.name3_orgscore;
		SELF.name3.orgweight	:= L.name3_orgweight;
		SELF.name3.ultid			:= L.name3_ultid;
		SELF.name3.ultscore		:= L.name3_ultscore;
		SELF.name3.ultweight	:= L.name3_ultweight;
		SELF.name4.dotid			:= L.name4_dotid;
		SELF.name4.dotscore		:= L.name4_dotscore;
		SELF.name4.dotweight	:= L.name4_dotweight;
		SELF.name4.empid			:= L.name4_empid;
		SELF.name4.empscore		:= L.name4_empscore;
		SELF.name4.empweight	:= L.name4_empweight;
		SELF.name4.powid			:= L.name4_powid;
		SELF.name4.powscore		:= L.name4_powscore;
		SELF.name4.powweight	:= L.name4_powweight;
		SELF.name4.proxid			:= L.name4_proxid;
		SELF.name4.proxscore	:= L.name4_proxscore;
		SELF.name4.proxweight	:= L.name4_proxweight;
		SELF.name4.seleid			:= L.name4_seleid;
		SELF.name4.selescore	:= L.name4_selescore;
		SELF.name4.seleweight	:= L.name4_seleweight;
		SELF.name4.orgid			:= L.name4_orgid;
		SELF.name4.orgscore		:= L.name4_orgscore;
		SELF.name4.orgweight	:= L.name4_orgweight;
		SELF.name4.ultid			:= L.name4_ultid;
		SELF.name4.ultscore		:= L.name4_ultscore;
		SELF.name4.ultweight	:= L.name4_ultweight;
		SELF.name5.dotid			:= L.name5_dotid;
		SELF.name5.dotscore		:= L.name5_dotscore;
		SELF.name5.dotweight	:= L.name5_dotweight;
		SELF.name5.empid			:= L.name5_empid;
		SELF.name5.empscore		:= L.name5_empscore;
		SELF.name5.empweight	:= L.name5_empweight;
		SELF.name5.powid			:= L.name5_powid;
		SELF.name5.powscore		:= L.name5_powscore;
		SELF.name5.powweight	:= L.name5_powweight;
		SELF.name5.proxid			:= L.name5_proxid;
		SELF.name5.proxscore	:= L.name5_proxscore;
		SELF.name5.proxweight	:= L.name5_proxweight;
		SELF.name5.seleid			:= L.name5_seleid;
		SELF.name5.selescore	:= L.name5_selescore;
		SELF.name5.seleweight	:= L.name5_seleweight;
		SELF.name5.orgid			:= L.name5_orgid;
		SELF.name5.orgscore		:= L.name5_orgscore;
		SELF.name5.orgweight	:= L.name5_orgweight;
		SELF.name5.ultid			:= L.name5_ultid;
		SELF.name5.ultscore		:= L.name5_ultscore;
		SELF.name5.ultweight	:= L.name5_ultweight;
		SELF.name6.dotid			:= L.name6_dotid;
		SELF.name6.dotscore		:= L.name6_dotscore;
		SELF.name6.dotweight	:= L.name6_dotweight;
		SELF.name6.empid			:= L.name6_empid;
		SELF.name6.empscore		:= L.name6_empscore;
		SELF.name6.empweight	:= L.name6_empweight;
		SELF.name6.powid			:= L.name6_powid;
		SELF.name6.powscore		:= L.name6_powscore;
		SELF.name6.powweight	:= L.name6_powweight;
		SELF.name6.proxid			:= L.name6_proxid;
		SELF.name6.proxscore	:= L.name6_proxscore;
		SELF.name6.proxweight	:= L.name6_proxweight;
		SELF.name6.seleid			:= L.name6_seleid;
		SELF.name6.selescore	:= L.name6_selescore;
		SELF.name6.seleweight	:= L.name6_seleweight;
		SELF.name6.orgid			:= L.name6_orgid;
		SELF.name6.orgscore		:= L.name6_orgscore;
		SELF.name6.orgweight	:= L.name6_orgweight;
		SELF.name6.ultid			:= L.name6_ultid;
		SELF.name6.ultscore		:= L.name6_ultscore;
		SELF.name6.ultweight	:= L.name6_ultweight;
	SELF := L;
	//SELF := [];
END;

	pSlimBase	:= PROJECT(Base_nod, SlimBase(LEFT));

	Layout_BK.base_nod denormalizeRecords(Layout_BK.base_nod l, Layout_BK.CleanFields_NOD r) := TRANSFORM
		//SELF.delete_flag			:= IF(TRIM(L.bk_infile_type) = 'NOD_DELETE', 'DELETE', L.delete_flag);
		SELF.name1_nid 				:= IF(r.Name_Type = 'BR', r.nid, l.name1_nid);
		SELF.name1_prefix			:= IF(r.Name_Type = 'BR', r.cln_title, l.name1_prefix);
		SELF.name1_first			:= IF(r.Name_Type = 'BR', r.cln_fname, l.name1_first);
		SELF.name1_middle			:= IF(r.Name_Type = 'BR', r.cln_mname, l.name1_middle);
		SELF.name1_last				:= IF(r.Name_Type = 'BR', r.cln_lname, l.name1_last);
		SELF.name1_suffix			:= IF(r.Name_Type = 'BR', r.cln_suffix, l.name1_suffix);
		SELF.name1_company		:= IF(r.Name_Type = 'BR', r.cname, l.name1_company);
		SELF.name1_did 				:= IF(r.Name_Type = 'BR', intformat(r.did,12,1), l.name1_did);
		SELF.name1_did_score 	:= IF(r.Name_Type = 'BR', (string)r.did_score, l.name1_did_score);
		SELF.name1_bdid 			:= IF(r.Name_Type = 'BR', intformat(r.bdid,12,1), l.name1_bdid);
		SELF.name1_bdid_score := IF(r.Name_Type = 'BR', (string)r.bdid_score, l.name1_bdid_score);
		SELF.name1.DotID		  := IF(r.Name_Type = 'BR', r.DotID, 		  l.name1.DotID);
		SELF.name1.DotScore		:= IF(r.Name_Type = 'BR', r.DotScore,	  l.name1.DotScore);
		SELF.name1.DotWeight	:= IF(r.Name_Type = 'BR', r.DotWeight,  l.name1.DotWeight);
		SELF.name1.EmpID		  := IF(r.Name_Type = 'BR', r.EmpID, 		  l.name1.EmpID);
		SELF.name1.EmpScore		:= IF(r.Name_Type = 'BR', r.EmpScore,   l.name1.EmpScore);
		SELF.name1.EmpWeight	:= IF(r.Name_Type = 'BR', r.EmpWeight,  l.name1.EmpWeight);
		SELF.name1.POWID		  := IF(r.Name_Type = 'BR', r.POWID, 		  l.name1.POWID);
		SELF.name1.POWScore		:= IF(r.Name_Type = 'BR', r.POWScore,   l.name1.POWScore);
		SELF.name1.POWWeight	:= IF(r.Name_Type = 'BR', r.POWWeight,  l.name1.POWWeight);
		SELF.name1.ProxID		  := IF(r.Name_Type = 'BR', r.ProxID, 	  l.name1.ProxID);
		SELF.name1.ProxScore	:= IF(r.Name_Type = 'BR', r.ProxScore,  l.name1.ProxScore);
		SELF.name1.ProxWeight	:= IF(r.Name_Type = 'BR', r.ProxWeight, l.name1.ProxWeight);
		SELF.name1.SeleID		  := IF(r.Name_Type = 'BR', r.SeleID, 	  l.name1.SeleID);
		SELF.name1.SeleScore	:= IF(r.Name_Type = 'BR', r.SeleScore,  l.name1.SeleScore);
		SELF.name1.SeleWeight	:= IF(r.Name_Type = 'BR', r.SeleWeight, l.name1.SeleWeight);	
		SELF.name1.OrgID		  := IF(r.Name_Type = 'BR', r.OrgID,			l.name1.OrgID);
		SELF.name1.OrgScore		:= IF(r.Name_Type = 'BR', r.OrgScore, 	l.name1.OrgScore);
		SELF.name1.OrgWeight	:= IF(r.Name_Type = 'BR', r.OrgWeight,  l.name1.OrgWeight);
		SELF.name1.UltID		  := IF(r.Name_Type = 'BR', r.UltID, 		 	l.name1.UltID);
		SELF.name1.UltScore		:= IF(r.Name_Type = 'BR', r.UltScore, 	l.name1.UltScore);
		SELF.name1.UltWeight	:= IF(r.Name_Type = 'BR', r.UltWeight,  l.name1.UltWeight);

		SELF.name2_nid 				:= IF(r.Name_Type = 'B2', r.nid, l.name2_nid);
		SELF.name2_prefix			:= IF(r.Name_Type = 'B2', r.cln_title, l.name2_prefix);
		SELF.name2_first			:= IF(r.Name_Type = 'B2', r.cln_fname, l.name2_first);
		SELF.name2_middle			:= IF(r.Name_Type = 'B2', r.cln_mname, l.name2_middle);
		SELF.name2_last				:= IF(r.Name_Type = 'B2', r.cln_lname, l.name2_last);
		SELF.name2_suffix			:= IF(r.Name_Type = 'B2', r.cln_suffix, l.name2_suffix);
		SELF.name2_company		:= IF(r.Name_Type = 'B2', r.cname, l.name2_company);
		SELF.name2_did 				:= IF(r.Name_Type = 'B2', intformat(r.did,12,1), l.name2_did);
		SELF.name2_did_score 	:= IF(r.Name_Type = 'B2', (string)r.did_score, l.name2_did_score);
		SELF.name2_bdid 			:= IF(r.Name_Type = 'B2', intformat(r.bdid,12,1), l.name2_bdid);
		SELF.name2_bdid_score := IF(r.Name_Type = 'B2', (string)r.bdid_score, l.name2_bdid_score);
		SELF.name2.DotID		  := IF(r.Name_Type = 'B2', r.DotID, 		  l.name2.DotID);
		SELF.name2.DotScore		:= IF(r.Name_Type = 'B2', r.DotScore,	  l.name2.DotScore);
		SELF.name2.DotWeight	:= IF(r.Name_Type = 'B2', r.DotWeight,  l.name2.DotWeight);
		SELF.name2.EmpID		  := IF(r.Name_Type = 'B2', r.EmpID, 		  l.name2.EmpID);
		SELF.name2.EmpScore		:= IF(r.Name_Type = 'B2', r.EmpScore,   l.name2.EmpScore);
		SELF.name2.EmpWeight	:= IF(r.Name_Type = 'B2', r.EmpWeight,  l.name2.EmpWeight);
		SELF.name2.POWID		  := IF(r.Name_Type = 'B2', r.POWID, 		  l.name2.POWID);
		SELF.name2.POWScore		:= IF(r.Name_Type = 'B2', r.POWScore,   l.name2.POWScore);
		SELF.name2.POWWeight	:= IF(r.Name_Type = 'B2', r.POWWeight,  l.name2.POWWeight);
		SELF.name2.ProxID		  := IF(r.Name_Type = 'B2', r.ProxID, 	  l.name2.ProxID);
		SELF.name2.ProxScore	:= IF(r.Name_Type = 'B2', r.ProxScore,  l.name2.ProxScore);
		SELF.name2.ProxWeight	:= IF(r.Name_Type = 'B2', r.ProxWeight, l.name2.ProxWeight);
		SELF.name2.SeleID		  := IF(r.Name_Type = 'B2', r.SeleID, 	  l.name2.SeleID);
		SELF.name2.SeleScore	:= IF(r.Name_Type = 'B2', r.SeleScore,  l.name2.SeleScore);
		SELF.name2.SeleWeight	:= IF(r.Name_Type = 'B2', r.SeleWeight, l.name2.SeleWeight);	
		SELF.name2.OrgID		  := IF(r.Name_Type = 'B2', r.OrgID,			l.name2.OrgID);
		SELF.name2.OrgScore		:= IF(r.Name_Type = 'B2', r.OrgScore, 	l.name2.OrgScore);
		SELF.name2.OrgWeight	:= IF(r.Name_Type = 'B2', r.OrgWeight,  l.name2.OrgWeight);
		SELF.name2.UltID		  := IF(r.Name_Type = 'B2', r.UltID, 		 	l.name2.UltID);
		SELF.name2.UltScore		:= IF(r.Name_Type = 'B2', r.UltScore, 	l.name2.UltScore);
		SELF.name2.UltWeight	:= IF(r.Name_Type = 'B2', r.UltWeight,  l.name2.UltWeight);
	
		SELF.name3_nid 				:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', r.nid, l.name3_nid);
		SELF.name3_prefix			:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', r.cln_title2, l.name3_prefix);
		SELF.name3_first			:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', r.cln_fname2, l.name3_first);
		SELF.name3_middle			:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', r.cln_mname2, l.name3_middle);
		SELF.name3_last				:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', r.cln_lname2, l.name3_last);
		SELF.name3_suffix			:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', r.cln_suffix2, l.name3_suffix);
		SELF.name3_company		:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', '', l.name3_company);
		SELF.name3_did 				:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', intformat(r.did,12,1), l.name3_did);
		SELF.name3_did_score 	:= IF(r.Name_Type = 'BR' AND r.cln_fname2 <> '', (string)r.did_score, l.name3_did_score);
		SELF.name3_bdid 			:= intformat(0,12,1);
		SELF.name3_bdid_score := '0';
		SELF.name3.DotID		  := 0;
		SELF.name3.DotScore		:= 0;
		SELF.name3.DotWeight	:= 0;
		SELF.name3.EmpID		  := 0;
		SELF.name3.EmpScore		:= 0;
		SELF.name3.EmpWeight	:= 0;
		SELF.name3.POWID		  := 0;
		SELF.name3.POWScore		:= 0;
		SELF.name3.POWWeight	:= 0;
		SELF.name3.ProxID		  := 0;
		SELF.name3.ProxScore	:= 0;
		SELF.name3.ProxWeight	:= 0;
		SELF.name3.SeleID		  := 0;
		SELF.name3.SeleScore	:= 0;
		SELF.name3.SeleWeight	:= 0;	
		SELF.name3.OrgID		  := 0;
		SELF.name3.OrgScore		:= 0;
		SELF.name3.OrgWeight	:= 0;
		SELF.name3.UltID		  := 0;
		SELF.name3.UltScore		:= 0;
		SELF.name3.UltWeight	:= 0;
		
		SELF.name4_nid 				:= IF(r.Name_Type = 'B2' AND r.cln_fname2 <> '', r.nid, l.name4_nid);
		SELF.name4_prefix			:= IF(r.Name_Type = 'B2' AND r.cln_fname2 <> '', r.cln_title2, l.name4_prefix);
		SELF.name4_first			:= IF(r.Name_Type = 'B2' AND r.cln_fname2 <> '', r.cln_fname2, l.name4_first);
		SELF.name4_middle			:= IF(r.Name_Type = 'B2' AND r.cln_fname2 <> '', r.cln_mname2, l.name4_middle);
		SELF.name4_last				:= IF(r.Name_Type = 'B2' AND r.cln_fname2 <> '', r.cln_lname2, l.name4_last);
		SELF.name4_suffix			:= IF(r.Name_Type = 'B2' AND r.cln_fname2 <> '', r.cln_suffix2, l.name4_suffix);
		SELF.name4_company		:= '';
		SELF.name4_did 				:= IF(r.Name_Type = 'B2' AND r.cln_fname2 <> '', intformat(r.did,12,1), l.name4_did);
		SELF.name4_did_score 	:= IF(r.Name_Type = 'B2' AND r.cln_fname2 <> '', (string)r.did_score, l.name4_did_score);
		SELF.name4_bdid 			:= intformat(0,12,1);
		SELF.name4_bdid_score := '0';
		SELF.name4.DotID		  := 0;
		SELF.name4.DotScore		:= 0;
		SELF.name4.DotWeight	:= 0;
		SELF.name4.EmpID		  := 0;
		SELF.name4.EmpScore		:= 0;
		SELF.name4.EmpWeight	:= 0;
		SELF.name4.POWID		  := 0;
		SELF.name4.POWScore		:= 0;
		SELF.name4.POWWeight	:= 0;
		SELF.name4.ProxID		  := 0;
		SELF.name4.ProxScore	:= 0;
		SELF.name4.ProxWeight	:= 0;
		SELF.name4.SeleID		  := 0;
		SELF.name4.SeleScore	:= 0;
		SELF.name4.SeleWeight	:= 0;	
		SELF.name4.OrgID		  := 0;
		SELF.name4.OrgScore		:= 0;
		SELF.name4.OrgWeight	:= 0;
		SELF.name4.UltID		  := 0;
		SELF.name4.UltScore		:= 0;
		SELF.name4.UltWeight	:= 0;
		
		SELF.name5_nid 				:= IF(r.Name_Type = 'CT', r.nid, l.name5_nid);
		SELF.name5_prefix			:= IF(r.Name_Type = 'CT', r.cln_title, l.name5_prefix);
		SELF.name5_first			:= IF(r.Name_Type = 'CT', r.cln_fname, l.name5_first);
		SELF.name5_middle			:= IF(r.Name_Type = 'CT', r.cln_mname, l.name5_middle);
		SELF.name5_last				:= IF(r.Name_Type = 'CT', r.cln_lname, l.name5_last);
		SELF.name5_suffix			:= IF(r.Name_Type = 'CT', r.cln_suffix, l.name5_suffix);
		SELF.name5_company		:= IF(r.Name_Type = 'CT', r.cname, l.name5_company);
		SELF.name5_did 				:= IF(r.Name_Type = 'CT', intformat(r.did,12,1), l.name5_did);
		SELF.name5_did_score 	:= IF(r.Name_Type = 'CT', (string)r.did_score, l.name5_did_score);
		SELF.name5_bdid 			:= IF(r.Name_Type = 'CT', intformat(r.bdid,12,1), l.name5_bdid);
		SELF.name5_bdid_score := IF(r.Name_Type = 'CT', (string)r.bdid_score, l.name5_bdid_score);
		SELF.name5.DotID		  := IF(r.Name_Type = 'CT', r.DotID, 		  l.name5.DotID);
		SELF.name5.DotScore		:= IF(r.Name_Type = 'CT', r.DotScore,	  l.name5.DotScore);
		SELF.name5.DotWeight	:= IF(r.Name_Type = 'CT', r.DotWeight,  l.name5.DotWeight);
		SELF.name5.EmpID		  := IF(r.Name_Type = 'CT', r.EmpID, 		  l.name5.EmpID);
		SELF.name5.EmpScore		:= IF(r.Name_Type = 'CT', r.EmpScore,   l.name5.EmpScore);
		SELF.name5.EmpWeight	:= IF(r.Name_Type = 'CT', r.EmpWeight,  l.name5.EmpWeight);
		SELF.name5.POWID		  := IF(r.Name_Type = 'CT', r.POWID, 		  l.name5.POWID);
		SELF.name5.POWScore		:= IF(r.Name_Type = 'CT', r.POWScore,   l.name5.POWScore);
		SELF.name5.POWWeight	:= IF(r.Name_Type = 'CT', r.POWWeight,  l.name5.POWWeight);
		SELF.name5.ProxID		  := IF(r.Name_Type = 'CT', r.ProxID, 	  l.name5.ProxID);
		SELF.name5.ProxScore	:= IF(r.Name_Type = 'CT', r.ProxScore,  l.name5.ProxScore);
		SELF.name5.ProxWeight	:= IF(r.Name_Type = 'CT', r.ProxWeight, l.name5.ProxWeight);
		SELF.name5.SeleID		  := IF(r.Name_Type = 'CT', r.SeleID, 	  l.name5.SeleID);
		SELF.name5.SeleScore	:= IF(r.Name_Type = 'CT', r.SeleScore,  l.name5.SeleScore);
		SELF.name5.SeleWeight	:= IF(r.Name_Type = 'CT', r.SeleWeight, l.name5.SeleWeight);	
		SELF.name5.OrgID		  := IF(r.Name_Type = 'CT', r.OrgID,			l.name5.OrgID);
		SELF.name5.OrgScore		:= IF(r.Name_Type = 'CT', r.OrgScore, 	l.name5.OrgScore);
		SELF.name5.OrgWeight	:= IF(r.Name_Type = 'CT', r.OrgWeight,  l.name5.OrgWeight);
		SELF.name5.UltID		  := IF(r.Name_Type = 'CT', r.UltID, 		 	l.name5.UltID);
		SELF.name5.UltScore		:= IF(r.Name_Type = 'CT', r.UltScore, 	l.name5.UltScore);
		SELF.name5.UltWeight	:= IF(r.Name_Type = 'CT', r.UltWeight,  l.name5.UltWeight);
		
		SELF.name6_nid 				:= IF(r.Name_Type = 'TR', r.nid, l.name6_nid);
		SELF.name6_prefix			:= IF(r.Name_Type = 'TR', r.cln_title, l.name6_prefix);
		SELF.name6_first			:= IF(r.Name_Type = 'TR', r.cln_fname, l.name6_first);
		SELF.name6_middle			:= IF(r.Name_Type = 'TR', r.cln_mname, l.name6_middle);
		SELF.name6_last				:= IF(r.Name_Type = 'TR', r.cln_lname, l.name6_last);
		SELF.name6_suffix			:= IF(r.Name_Type = 'TR', r.cln_suffix, l.name6_suffix);
		SELF.name6_company		:= IF(r.Name_Type = 'TR', r.cname, l.name6_company);
		SELF.name6_did 				:= IF(r.Name_Type = 'TR', intformat(r.did,12,1), l.name6_did);
		SELF.name6_did_score 	:= IF(r.Name_Type = 'TR', (string)r.did_score, l.name6_did_score);
		SELF.name6_bdid 			:= IF(r.Name_Type = 'TR', intformat(r.bdid,12,1), l.name6_bdid);
		SELF.name6_bdid_score := IF(r.Name_Type = 'TR', (string)r.bdid_score, l.name6_bdid_score);
		SELF.name6.DotID		  := IF(r.Name_Type = 'TR', r.DotID, 		  l.name6.DotID);
		SELF.name6.DotScore		:= IF(r.Name_Type = 'TR', r.DotScore,	  l.name6.DotScore);
		SELF.name6.DotWeight	:= IF(r.Name_Type = 'TR', r.DotWeight,  l.name6.DotWeight);
		SELF.name6.EmpID		  := IF(r.Name_Type = 'TR', r.EmpID, 		  l.name6.EmpID);
		SELF.name6.EmpScore		:= IF(r.Name_Type = 'TR', r.EmpScore,   l.name6.EmpScore);
		SELF.name6.EmpWeight	:= IF(r.Name_Type = 'TR', r.EmpWeight,  l.name6.EmpWeight);
		SELF.name6.POWID		  := IF(r.Name_Type = 'TR', r.POWID, 		  l.name6.POWID);
		SELF.name6.POWScore		:= IF(r.Name_Type = 'TR', r.POWScore,   l.name6.POWScore);
		SELF.name6.POWWeight	:= IF(r.Name_Type = 'TR', r.POWWeight,  l.name6.POWWeight);
		SELF.name6.ProxID		  := IF(r.Name_Type = 'TR', r.ProxID, 	  l.name6.ProxID);
		SELF.name6.ProxScore	:= IF(r.Name_Type = 'TR', r.ProxScore,  l.name6.ProxScore);
		SELF.name6.ProxWeight	:= IF(r.Name_Type = 'TR', r.ProxWeight, l.name6.ProxWeight);
		SELF.name6.SeleID		  := IF(r.Name_Type = 'TR', r.SeleID, 	  l.name6.SeleID);
		SELF.name6.SeleScore	:= IF(r.Name_Type = 'TR', r.SeleScore,  l.name6.SeleScore);
		SELF.name6.SeleWeight	:= IF(r.Name_Type = 'TR', r.SeleWeight, l.name6.SeleWeight);	
		SELF.name6.OrgID		  := IF(r.Name_Type = 'TR', r.OrgID,			l.name6.OrgID);
		SELF.name6.OrgScore		:= IF(r.Name_Type = 'TR', r.OrgScore, 	l.name6.OrgScore);
		SELF.name6.OrgWeight	:= IF(r.Name_Type = 'TR', r.OrgWeight,  l.name6.OrgWeight);
		SELF.name6.UltID		  := IF(r.Name_Type = 'TR', r.UltID, 		 	l.name6.UltID);
		SELF.name6.UltScore		:= IF(r.Name_Type = 'TR', r.UltScore, 	l.name6.UltScore);
		SELF.name6.UltWeight	:= IF(r.Name_Type = 'TR', r.UltWeight,  l.name6.UltWeight);
		
		SELF.situs1_RawAID			:= IF(r.AddrType = 'PF', r.rawAid, l.situs1_RawAID);
		SELF.situs1_prim_range	:= IF(r.AddrType = 'PF', r.prim_range, l.situs1_prim_range);
		SELF.situs1_predir			:= IF(r.AddrType = 'PF', r.predir, l.situs1_predir);
		SELF.situs1_prim_name		:= IF(r.AddrType = 'PF', r.prim_name, l.situs1_prim_name);
		SELF.situs1_addr_suffix	:= IF(r.AddrType = 'PF', r.addr_suffix, l.situs1_addr_suffix);
		SELF.situs1_postdir			:= IF(r.AddrType = 'PF', r.postdir, l.situs1_postdir);
		SELF.situs1_unit_desig	:= IF(r.AddrType = 'PF', r.unit_desig, l.situs1_unit_desig);
		SELF.situs1_sec_range		:= IF(r.AddrType = 'PF', r.sec_range, l.situs1_sec_range);
		SELF.situs1_p_city_name	:= IF(r.AddrType = 'PF', r.p_city_name, l.situs1_p_city_name);
		SELF.situs1_v_city_name	:= IF(r.AddrType = 'PF', r.v_city_name, l.situs1_v_city_name);
		SELF.situs1_st					:= IF(r.AddrType = 'PF', r.st, l.situs1_st);
		SELF.situs1_zip					:= IF(r.AddrType = 'PF', r.zip, l.situs1_zip);
		SELF.situs1_zip4				:= IF(r.AddrType = 'PF', r.zip4, l.situs1_zip4);
		SELF.situs1_cart				:= IF(r.AddrType = 'PF', r.cart, l.situs1_cart);
		SELF.situs1_cr_sort_sz	:= IF(r.AddrType = 'PF', r.cr_sort_sz, l.situs1_cr_sort_sz);
		SELF.situs1_lot					:= IF(r.AddrType = 'PF', r.lot, l.situs1_lot);
		SELF.situs1_lot_order		:= IF(r.AddrType = 'PF', r.lot_order, l.situs1_lot_order);
		SELF.situs1_dpbc				:= IF(r.AddrType = 'PF', r.dbpc, l.situs1_dpbc);
		SELF.situs1_chk_digit		:= IF(r.AddrType = 'PF', r.chk_digit, l.situs1_chk_digit);
		SELF.situs1_record_type	:= IF(r.AddrType = 'PF', r.rec_type, l.situs1_record_type);
		SELF.situs1_fipscounty	:= IF(r.AddrType = 'PF', r.county, l.situs1_fipscounty);
		SELF.situs1_geo_lat			:= IF(r.AddrType = 'PF', r.geo_lat, l.situs1_geo_lat);
		SELF.situs1_geo_long		:= IF(r.AddrType = 'PF', r.geo_long, l.situs1_geo_long);
		SELF.situs1_msa					:= IF(r.AddrType = 'PF', r.msa, l.situs1_msa);
		SELF.situs1_geo_blk			:= IF(r.AddrType = 'PF', r.geo_blk, l.situs1_geo_blk);
		SELF.situs1_geo_match		:= IF(r.AddrType = 'PF', r.geo_match, l.situs1_geo_match);
		SELF.situs1_err_stat		:= IF(r.AddrType = 'PF', r.err_stat, l.situs1_err_stat);
		SELF := L;
		//SELF := [];
	END;
	
	//Distribute the data before denormalize to avoid skewing
	NodInDist				:=	SORT(DISTRIBUTE(Norm_nod, HASH32(record_id)),record_id,LOCAL);
	NodBaseDist			:=	SORT(DISTRIBUTE(pSlimBase(delete_flag <> 'DELETE'), HASH32(record_id)),record_id, -date_vendor_last_reported,LOCAL);
	NodBaseDelete		:= 	pSlimBase(delete_flag = 'DELETE');

	NodDeNorm := DENORMALIZE(NodBaseDist, NodInDist,
														left.record_id = right.record_id,
														denormalizeRecords(left,right), LEFT OUTER, LOCAL);
	
	//Add back delete flagged records
	NodAll	:= NodDeNorm + NodBaseDelete;
	
//removing situs1_RawAID from dedup because multiple borrowers have same property address and is causing duplication with different RawAID
	NodBase	:= DEDUP(SORT(NodAll,record_id,foreclosure_id,-process_date),ALL, EXCEPT situs1_RawAID); 
	
	//Translate codes
	code_lkp := BKForeclosure.File_BK_Foreclosure.codes_table;
	
	Layout_BK.base_nod xfrmCodeDesc(BKForeclosure.Layout_BK.base_nod L, BKForeclosure.layout_BK.CodeTable R) := TRANSFORM
		SELF.document_desc := R.code_desc;
		SELF := L;
	END;
	
	AddCodeDesc	:= JOIN(NodBase, code_lkp,
											TRIM(LEFT.src) = TRIM(RIGHT.src) AND
											TRIM(LEFT.doc_type) = TRIM(RIGHT.code),
											xfrmCodeDesc(LEFT,RIGHT),LEFT OUTER, LOOKUP);
	
	RETURN AddCodeDesc;
END;