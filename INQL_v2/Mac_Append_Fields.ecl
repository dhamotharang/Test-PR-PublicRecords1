export Mac_Append_Fields(
	
	 inputFile							              // Input dataset							
	,outputFile													  // Named output to run ecl generated by macro
	,pSeparator								= '\',\''   // Seperator, then passing to macro use like this  ',' , '~~'. 
	,pTerminator							= '\'\\n\'' // Terminator parameter
	,poutlayout               =''         // Transform Output layout
	,transactionid            =''         // Transactionid field based on source
	
	) := macro

		#EXPORTXML(doConcatinateFieldMetaInfo, recordof(inputFile))


		#uniquename(tra)
		{recordof(poutlayout),unsigned8 __internal_fpos__} %tra%(inputFile L) :=TRANSFORM
		#IF (%'doFieldTextConcatinate'%='')
		 #DECLARE(doFieldTextConcatinate)
		 #DECLARE(origtransactionid)
		#END
		#SET (doFieldTextConcatinate, false)		
		#SET (origtransactionid,false)
		#SET (origtransactionid, 'SELF.orig_transaction_id:=')
		#APPEND (origtransactionid,      '(hash(L.'+ #TEXT(transactionid) + '));')
		#SET (doFieldTextConcatinate, 'SELF.raw:=')
		#FOR (doConcatinateFieldMetaInfo)
		 #FOR (Field)
		#IF(%'@type'% != 'string')
					#APPEND (doFieldTextConcatinate, '((string)L.' + %'@name'% + ')+')
		#ELSE
		    	#APPEND (doFieldTextConcatinate, '(L.' + %'@name'% + ')')
					#APPEND (doFieldTextConcatinate, '+'+ #TEXT(pSeparator) +'+')
		  #END
		 #END
		#END
			#APPEND (doFieldTextConcatinate, #TEXT(pTerminator))

			SELF.filedate              := (unsigned8)regexfind('[0-9]{8}|[0-9]{6}', L.filename,0);
			%origtransactionid%;
		  %doFieldTextConcatinate%;
			SELF.__internal_fpos__     :=0;
			SELF := L;
		END;
		
		outputFile := PROJECT(inputFile, %tra%(LEFT));
		
	endmacro;
