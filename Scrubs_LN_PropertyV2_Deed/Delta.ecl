IMPORT SALT311,STD;
EXPORT Delta(DATASET(Layout_Property_deed)old_s, DATASET(Layout_Property_deed) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['ln_fares_id','process_date','vendor_source_flag','current_record','from_file','fips_code','state','county_name','record_type','apnt_or_pin_number','fares_unformatted_apn','multi_apn_flag','tax_id_number','excise_tax_number','buyer_or_borrower_ind','name1','name1_id_code','name2','name2_id_code','vesting_code','addendum_flag','phone_number','mailing_care_of','mailing_street','mailing_unit_number','mailing_csz','mailing_address_cd','seller1','seller1_id_code','seller2','seller2_id_code','seller_addendum_flag','seller_mailing_full_street_address','seller_mailing_address_unit_number','seller_mailing_address_citystatezip','property_full_street_address','property_address_unit_number','property_address_citystatezip','property_address_code','legal_lot_code','legal_lot_number','legal_block','legal_section','legal_district','legal_land_lot','legal_unit','legal_city_municipality_township','legal_subdivision_name','legal_phase_number','legal_tract_number','legal_sec_twn_rng_mer','legal_brief_description','recorder_map_reference','complete_legal_description_code','contract_date','recording_date','arm_reset_date','document_number','document_type_code','loan_number','recorder_book_number','recorder_page_number','concurrent_mortgage_book_page_document_number','sales_price','sales_price_code','city_transfer_tax','county_transfer_tax','total_transfer_tax','first_td_loan_amount','second_td_loan_amount','first_td_lender_type_code','second_td_lender_type_code','first_td_loan_type_code','type_financing','first_td_interest_rate','first_td_due_date','title_company_name','partial_interest_transferred','loan_term_months','loan_term_years','lender_name','lender_name_id','lender_dba_aka_name','lender_full_street_address','lender_address_unit_number','lender_address_citystatezip','assessment_match_land_use_code','property_use_code','condo_code','timeshare_flag','land_lot_size','hawaii_tct','hawaii_condo_cpr_code','hawaii_condo_name','filler_except_hawaii','rate_change_frequency','change_index','adjustable_rate_index','adjustable_rate_rider','graduated_payment_rider','balloon_rider','fixed_step_rate_rider','condominium_rider','planned_unit_development_rider','rate_improvement_rider','assumability_rider','prepayment_rider','one_four_family_rider','biweekly_payment_rider','second_home_rider','data_source_code','main_record_id_code','addl_name_flag','prop_addr_propagated_ind','ln_ownership_rights','ln_relationship_type','ln_buyer_mailing_country_code','ln_seller_mailing_country_code'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary(BOOLEAN Glob = TRUE) := hygiene(old_s).Summary('Old',Glob) + hygiene(new_s).Summary('New',Glob) + hygiene(PROJECT(Differences(deleted), TRANSFORM(Layout_Property_deed, SELF := LEFT.old_rec))).Summary('Deletions',Glob) + hygiene(PROJECT(Differences(added), TRANSFORM(Layout_Property_deed, SELF := LEFT.new_rec))).Summary('Additions',Glob);
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE, BOOLEAN doHygieneSummaryPerSrc = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary(TRUE);
    hygieneDiffPerSrc := DifferenceSummary(FALSE);
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_LN_PropertyV2_Deed, Fields, 'RECORDOF(hygieneDiffOverall)', TRUE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
    hygieneDiffPerSrc_Standard := IF(doHygieneSummaryPerSrc, NORMALIZE(hygieneDiffPerSrc, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_src', LEFT.txt + '_src')));
 
    RETURN hygieneDiffOverall_Standard & hygieneDiffPerSrc_Standard;
  END;
END;
