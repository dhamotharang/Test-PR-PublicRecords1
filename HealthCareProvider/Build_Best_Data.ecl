EXPORT Build_Best_Data (DATASET ({UNSIGNED8 LNPID}) Infile) := FUNCTION

	Header_DS := HealthCareProvider.Files.Provider_Header_DS;
 
	H_dist := DISTRIBUTE (Header_DS, HASH32(lnpid));  
	P_dist := DISTRIBUTE (Infile, HASH32(lnpid));

	P_CDS := JOIN (H_Dist, P_Dist, LEFT.LNPID = RIGHT.LNPID, TRANSFORM(RECORDOF(H_DIST), SELF := LEFT;),LOOKUP,LOCAL);

	G_CDS	:=	GROUP (P_CDS,LNPID,LOCAL);
	
	RECORDOF(H_DIST) GetBestData (RECORDOF(H_DIST) L, DATASET (RECORDOF(H_DIST)) R) := TRANSFORM
		SELF.DT_LIC_EXPIRATION	:=	R(DT_LIC_EXPIRATION > 20140617)[1].DT_LIC_EXPIRATION; 	
		SELF.DID								:=	DEDUP(SORT(R(DID_FLAG IN ['O','G','F']),MAP(DID_FLAG = 'O' => 1, DID_FLAG = 'G' => 2,3)),DID_FLAG)[1].DID; 
		SELF.SSN								:=	DEDUP(SORT(R(SSN_FLAG IN ['O','G','F']),MAP(SSN_FLAG = 'O' => 1, SSN_FLAG = 'G' => 2,3)),SSN_FLAG)[1].SSN; 
		SELF.CNSMR_SSN					:=	DEDUP(SORT(R(CNSMR_SSN_FLAG IN ['O','G','F']),MAP(CNSMR_SSN_FLAG = 'O' => 1, CNSMR_SSN_FLAG = 'G' => 2,3)),CNSMR_SSN_FLAG)[1].CNSMR_SSN; 
		SELF.DOB								:=	DEDUP(SORT(R(DOB_FLAG IN ['G','F']),MAP(DOB_FLAG = 'G' => 1, 2)),DOB_FLAG)[1].DOB; 
		SELF.CNSMR_DOB					:=	DEDUP(SORT(R(CNSMR_DOB_FLAG IN ['G','F']),MAP(CNSMR_DOB_FLAG = 'G' => 1, 2)),CNSMR_DOB_FLAG)[1].CNSMR_DOB; 
		SELF.LIC_NBR						:=	DEDUP(SORT(R(LIC_NBR_FLAG IN ['G','F'] AND LIC_STATE = 'FL'),MAP(LIC_NBR_FLAG = 'G' => 1, 2)),LIC_NBR_FLAG)[1].LIC_NBR; 
		SELF.C_LIC_NBR					:=	DEDUP(SORT(R(C_LIC_NBR_FLAG IN ['G','F'] AND LIC_STATE = 'FL'),MAP(C_LIC_NBR_FLAG = 'G' => 1, 2)),C_LIC_NBR_FLAG)[1].C_LIC_NBR; 
		SELF.LIC_STATE					:=	R(LIC_STATE = 'FL')[1].LIC_STATE; 
		SELF.FNAME							:=	DEDUP(SORT(R(FNAME_FLAG IN ['G','F']),MAP(FNAME_FLAG = 'G' => 1, 2)),FNAME_FLAG)[1].FNAME; 
		SELF.MNAME							:=	DEDUP(SORT(R(MNAME_FLAG IN ['G','F']),MAP(MNAME_FLAG = 'G' => 1, 2)),MNAME_FLAG)[1].MNAME; 
		SELF.LNAME							:=	DEDUP(SORT(R(LNAME_FLAG IN ['G','F']),MAP(LNAME_FLAG = 'G' => 1, 2)),LNAME_FLAG)[1].LNAME; 
		SELF.BILLING_TAX_ID 		:=	DEDUP(SORT(R(BILLING_TAX_ID_FLAG IN ['G','F']),MAP(BILLING_TAX_ID_FLAG = 'G' => 1, 2)),BILLING_TAX_ID_FLAG)[1].BILLING_TAX_ID; 
		SELF.UPIN								:=	DEDUP(SORT(R(UPIN_FLAG IN ['O','G','F']),MAP(UPIN_FLAG = 'O' => 1,UPIN_FLAG = 'G' => 2, 3)),UPIN_FLAG)[1].UPIN; 
		SELF.NPI_NUMBER					:=	DEDUP(SORT(R(NPI_NUMBER_FLAG IN ['O','G','F']),MAP(NPI_NUMBER_FLAG = 'O' => 1,NPI_NUMBER_FLAG = 'G' => 2, 3)),NPI_NUMBER_FLAG)[1].NPI_NUMBER; 
		SELF.DEA_NUMBER					:=	DEDUP(SORT(R(DEA_NUMBER_FLAG IN ['O','G','F']),MAP(DEA_NUMBER_FLAG = 'O' => 1,DEA_NUMBER_FLAG = 'G' => 2, 3)),DEA_NUMBER_FLAG)[1].DEA_NUMBER; 
		SELF.PHONE							:=	DEDUP(SORT(R(PHONE_FLAG IN ['O','G','F']),MAP(PHONE_FLAG = 'O' => 1,PHONE_FLAG = 'G' => 2, 3)),PHONE_FLAG)[1].PHONE; 
		SELF.FAX								:=	DEDUP(SORT(R(FAX_FLAG IN ['O','G','F']),MAP(FAX_FLAG = 'O' => 1,FAX_FLAG = 'G' => 2, 3)),FAX_FLAG)[1].FAX; 
		SELF.TAXONOMY						:=	DEDUP(SORT(R(TAXONOMY_FLAG IN ['O','G','F']),MAP(TAXONOMY_FLAG = 'O' => 1,TAXONOMY_FLAG = 'G' => 2, 3)),TAXONOMY_FLAG)[1].TAXONOMY; 
		SELF.VENDOR_ID					:=	R(SRC = '64')[1].VENDOR_ID; 
		SELF := L;
	END;
	
	Best_Data	:= ROLLUP (G_CDS,GROUP,GetBestData (LEFT,ROWS(LEFT)));
	
	RETURN Best_Data;
END;