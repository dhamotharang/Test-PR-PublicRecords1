IMPORT SALT311,STD;
EXPORT Attributes_Delta(DATASET(Attributes_Layout_Cortera)old_s, DATASET(Attributes_Layout_Cortera) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['ultimate_linkid','cortera_score','cpr_score','cpr_segment','dbt','avg_bal','air_spend','fuel_spend','leasing_spend','ltl_spend','rail_spend','tl_spend','transvc_spend','transup_spend','bst_spend','dg_spend','electrical_spend','hvac_spend','other_b_spend','plumbing_spend','rs_spend','wp_spend','chemical_spend','electronic_spend','metal_spend','other_m_spend','packaging_spend','pvf_spend','plastic_spend','textile_spend','bs_spend','ce_spend','hardware_spend','ie_spend','is_spend','it_spend','mls_spend','os_spend','pp_spend','sis_spend','apparel_spend','beverages_spend','constr_spend','consulting_spend','fs_spend','fp_spend','insurance_spend','ls_spend','oil_gas_spend','utilities_spend','other_spend','advt_spend','air_growth','fuel_growth','leasing_growth','ltl_growth','rail_growth','tl_growth','transvc_growth','transup_growth','bst_growth','dg_growth','electrical_growth','hvac_growth','other_b_growth','plumbing_growth','rs_growth','wp_growth','chemical_growth','electronic_growth','metal_growth','other_m_growth','packaging_growth','pvf_growth','plastic_growth','textile_growth','bs_growth','ce_growth','hardware_growth','ie_growth','is_growth','it_growth','mls_growth','os_growth','pp_growth','sis_growth','apparel_growth','beverages_growth','constr_growth','consulting_growth','fs_growth','fp_growth','insurance_growth','ls_growth','oil_gas_growth','utilities_growth','other_growth','advt_growth','top5_growth','shipping_y1','shipping_growth','materials_y1','materials_growth','operations_y1','operations_growth','total_paid_average_0t12','total_paid_monthspastworst_24','total_paid_slope_0t12','total_paid_slope_0t6','total_paid_slope_6t12','total_paid_slope_6t18','total_paid_volatility_0t12','total_paid_volatility_0t6','total_paid_volatility_12t18','total_paid_volatility_6t12','total_spend_monthspastleast_24','total_spend_monthspastmost_24','total_spend_slope_0t12','total_spend_slope_0t24','total_spend_slope_0t6','total_spend_slope_6t12','total_spend_sum_12','total_spend_volatility_0t12','total_spend_volatility_0t6','total_spend_volatility_12t18','total_spend_volatility_6t12','mfgmat_paid_average_12','mfgmat_paid_monthspastworst_24','mfgmat_paid_slope_0t12','mfgmat_paid_slope_0t24','mfgmat_paid_slope_0t6','mfgmat_paid_volatility_0t12','mfgmat_paid_volatility_0t6','mfgmat_spend_monthspastleast_24','mfgmat_spend_monthspastmost_24','mfgmat_spend_slope_0t12','mfgmat_spend_slope_0t24','mfgmat_spend_slope_0t6','mfgmat_spend_sum_12','mfgmat_spend_volatility_0t6','mfgmat_spend_volatility_6t12','ops_paid_average_12','ops_paid_monthspastworst_24','ops_paid_slope_0t12','ops_paid_slope_0t24','ops_paid_slope_0t6','ops_paid_volatility_0t12','ops_paid_volatility_0t6','ops_spend_monthspastleast_24','ops_spend_monthspastmost_24','ops_spend_slope_0t12','ops_spend_slope_0t24','ops_spend_slope_0t6','ops_spend_sum_12','ops_spend_volatility_0t6','ops_spend_volatility_6t12','fleet_paid_average_12','fleet_paid_monthspastworst_24','fleet_paid_slope_0t12','fleet_paid_slope_0t24','fleet_paid_slope_0t6','fleet_paid_volatility_0t12','fleet_paid_volatility_0t6','fleet_spend_monthspastleast_24','fleet_spend_monthspastmost_24','fleet_spend_slope_0t12','fleet_spend_slope_0t24','fleet_spend_slope_0t6','fleet_spend_sum_12','fleet_spend_volatility_0t6','fleet_spend_volatility_6t12','carrier_paid_average_12','carrier_paid_monthspastworst_24','carrier_paid_slope_0t12','carrier_paid_slope_0t24','carrier_paid_slope_0t6','carrier_paid_volatility_0t12','carrier_paid_volatility_0t6','carrier_spend_monthspastleast_24','carrier_spend_monthspastmost_24','carrier_spend_slope_0t12','carrier_spend_slope_0t24','carrier_spend_slope_0t6','carrier_spend_sum_12','carrier_spend_volatility_0t6','carrier_spend_volatility_6t12','bldgmats_paid_average_12','bldgmats_paid_monthspastworst_24','bldgmats_paid_slope_0t12','bldgmats_paid_slope_0t24','bldgmats_paid_slope_0t6','bldgmats_paid_volatility_0t12','bldgmats_paid_volatility_0t6','bldgmats_spend_monthspastleast_24','bldgmats_spend_monthspastmost_24','bldgmats_spend_slope_0t12','bldgmats_spend_slope_0t24','bldgmats_spend_slope_0t6','bldgmats_spend_sum_12','bldgmats_spend_volatility_0t6','bldgmats_spend_volatility_6t12','top5_paid_average_12','top5_paid_monthspastworst_24','top5_paid_slope_0t12','top5_paid_slope_0t24','top5_paid_slope_0t6','top5_paid_volatility_0t12','top5_paid_volatility_0t6','top5_spend_monthspastleast_24','top5_spend_monthspastmost_24','top5_spend_slope_0t12','top5_spend_slope_0t24','top5_spend_slope_0t6','top5_spend_sum_12','top5_spend_volatility_0t6','top5_spend_volatility_6t12','total_numrel_avg12','total_numrel_monthpspastmost_24','total_numrel_monthspastleast_24','total_numrel_slope_0t12','total_numrel_slope_0t24','total_numrel_slope_0t6','total_numrel_slope_6t12','total_numrel_var_0t12','total_numrel_var_0t24','total_numrel_var_12t24','total_numrel_var_6t18','mfgmat_numrel_avg12','mfgmat_numrel_slope_0t12','mfgmat_numrel_slope_0t24','mfgmat_numrel_slope_0t6','mfgmat_numrel_slope_6t12','mfgmat_numrel_var_0t12','mfgmat_numrel_var_12t24','ops_numrel_avg12','ops_numrel_slope_0t12','ops_numrel_slope_0t24','ops_numrel_slope_0t6','ops_numrel_slope_6t12','ops_numrel_var_0t12','ops_numrel_var_12t24','fleet_numrel_avg12','fleet_numrel_slope_0t12','fleet_numrel_slope_0t24','fleet_numrel_slope_0t6','fleet_numrel_slope_6t12','fleet_numrel_var_0t12','fleet_numrel_var_12t24','carrier_numrel_avg12','carrier_numrel_slope_0t12','carrier_numrel_slope_0t24','carrier_numrel_slope_0t6','carrier_numrel_slope_6t12','carrier_numrel_var_0t12','carrier_numrel_var_12t24','bldgmats_numrel_avg12','bldgmats_numrel_slope_0t12','bldgmats_numrel_slope_0t24','bldgmats_numrel_slope_0t6','bldgmats_numrel_slope_6t12','bldgmats_numrel_var_0t12','bldgmats_numrel_var_12t24','total_monthsoutstanding_slope24','total_percprov30_avg_0t12','total_percprov30_slope_0t12','total_percprov30_slope_0t24','total_percprov30_slope_0t6','total_percprov30_slope_6t12','total_percprov60_avg_0t12','total_percprov60_slope_0t12','total_percprov60_slope_0t24','total_percprov60_slope_0t6','total_percprov60_slope_6t12','total_percprov90_avg_0t12','total_percprov90_lowerlim_0t12','total_percprov90_slope_0t24','total_percprov90_slope_0t6','total_percprov90_slope_6t12','total_percprovoutstanding_adjustedslope_0t12','mfgmat_monthsoutstanding_slope24','mfgmat_percprov30_slope_0t12','mfgmat_percprov30_slope_6t12','mfgmat_percprov60_slope_0t12','mfgmat_percprov60_slope_6t12','mfgmat_percprov90_slope_0t24','mfgmat_percprov90_slope_0t6','mfgmat_percprov90_slope_6t12','mfgmat_percprovoutstanding_adjustedslope_0t12','ops_monthsoutstanding_slope24','ops_percprov30_slope_0t12','ops_percprov30_slope_6t12','ops_percprov60_slope_0t12','ops_percprov60_slope_6t12','ops_percprov90_slope_0t24','ops_percprov90_slope_0t6','ops_percprov90_slope_6t12','ops_percprovoutstanding_adjustedslope_0t12','fleet_monthsoutstanding_slope24','fleet_percprov30_slope_0t12','fleet_percprov30_slope_6t12','fleet_percprov60_slope_0t12','fleet_percprov60_slope_6t12','fleet_percprov90_slope_0t24','fleet_percprov90_slope_0t6','fleet_percprov90_slope_6t12','fleet_percprovoutstanding_adjustedslope_0t12','carrier_monthsoutstanding_slope24','carrier_percprov30_slope_0t12','carrier_percprov30_slope_6t12','carrier_percprov60_slope_0t12','carrier_percprov60_slope_6t12','carrier_percprov90_slope_0t24','carrier_percprov90_slope_0t6','carrier_percprov90_slope_6t12','carrier_percprovoutstanding_adjustedslope_0t12','bldgmats_monthsoutstanding_slope24','bldgmats_percprov30_slope_0t12','bldgmats_percprov30_slope_6t12','bldgmats_percprov60_slope_0t12','bldgmats_percprov60_slope_6t12','bldgmats_percprov90_slope_0t24','bldgmats_percprov90_slope_0t6','bldgmats_percprov90_slope_6t12','bldgmats_percprovoutstanding_adjustedslope_0t12','top5_monthsoutstanding_slope24','top5_percprov30_slope_0t12','top5_percprov30_slope_6t12','top5_percprov60_slope_0t12','top5_percprov60_slope_6t12','top5_percprov90_slope_0t24','top5_percprov90_slope_0t6','top5_percprov90_slope_6t12','top5_percprovoutstanding_adjustedslope_0t12'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := Attributes_hygiene(old_s).Summary('Old') + Attributes_hygiene(new_s).Summary('New') + Attributes_hygiene(PROJECT(Differences(deleted), TRANSFORM(Attributes_Layout_Cortera, SELF := LEFT.old_rec))).Summary('Deletions') + Attributes_hygiene(PROJECT(Differences(added), TRANSFORM(Attributes_Layout_Cortera, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_Cortera, Attributes_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
