//HPCC Systems KEL Compiler Version 0.11.6
IMPORT KEL011 AS KEL;
IMPORT CFG_Compile,E_Criminal_Offense,E_Person,E_Person_Offenses FROM PublicRecords_KEL;
IMPORT * FROM KEL011.Null;
EXPORT Q_Criminal_Offense_Search(KEL.typ.uid __PLexID, UNSIGNED1 __PDPM, CFG_Compile.FDCDataset __in = CFG_Compile.FDCDefault) := MODULE
  SHARED E_Person_Filtered_2(CFG_Compile.FDCDataset __in = CFG_Compile.FDCDefault) := MODULE(E_Person(__in))
    SHARED __UsingFitler(DATASET(InLayout) __ds) := __ds((__ds.__Permits & __PDPM) = __ds.__Permits);
    SHARED __GroupTest(DATASET(InLayout) __g) := EXISTS(__g(__T(__OP2(__g.UID,=,__CN(__PLexID)))));
    SHARED __SourceFilter(DATASET(InLayout) __ds) := __UsingFitler(__ds);
    SHARED __GroupedFilter(GROUPED DATASET(InLayout) __ds) := HAVING(__ds,__GroupTest(ROWS(LEFT)));
  END;
  SHARED E_Person_Offenses_Filtered_1(CFG_Compile.FDCDataset __in = CFG_Compile.FDCDefault) := MODULE(E_Person_Offenses(__in))
    SHARED __UsingFitler(DATASET(InLayout) __ds) := __ds((__ds.__Permits & __PDPM) = __ds.__Permits);
    SHARED __SourceFilter(DATASET(InLayout) __ds) := __UsingFitler(__ds);
    SHARED __GroupedFilter(GROUPED DATASET(InLayout) __ds) := JOIN(__ds,E_Person_Filtered_2(__in).__PostFilter,__EEQP(LEFT.Subject_,RIGHT.UID),TRANSFORM(InLayout,SELF:=LEFT),HASH,GROUPED,KEEP(1));
  END;
  SHARED E_Criminal_Offense_Filtered(CFG_Compile.FDCDataset __in = CFG_Compile.FDCDefault) := MODULE(E_Criminal_Offense(__in))
    SHARED __UsingFitler(DATASET(InLayout) __ds) := __ds((__ds.__Permits & __PDPM) = __ds.__Permits);
    SHARED __SourceFilter(DATASET(InLayout) __ds) := __UsingFitler(__ds);
    SHARED __GroupedFilter(GROUPED DATASET(InLayout) __ds) := JOIN(__ds,E_Person_Offenses_Filtered_1(__in).__PostFilter,__EEQP(LEFT.UID,RIGHT.Offense_),TRANSFORM(InLayout,SELF:=LEFT),HASH,GROUPED,KEEP(1));
  END;
  SHARED E_Person_Filtered := E_Person_Filtered_2;
  SHARED E_Person_Offenses_Filtered := E_Person_Offenses_Filtered_1;
  SHARED TYPEOF(E_Criminal_Offense(__in).__Result) __E_Criminal_Offense := E_Criminal_Offense_Filtered(__in).__Result;
  SHARED TYPEOF(E_Person(__in).__Result) __E_Person := E_Person_Filtered(__in).__Result;
  SHARED TYPEOF(E_Person_Offenses(__in).__Result) __E_Person_Offenses := E_Person_Offenses_Filtered(__in).__Result;
  SHARED __EE10561 := __E_Person;
  SHARED __EE13397 := __EE10561(__T(__OP2(__EE10561.UID,=,__CN(__PLexID))));
  SHARED __EE10563 := __E_Criminal_Offense;
  SHARED __EE10562 := __E_Person_Offenses;
  SHARED __EE12162 := __EE10562(__NN(__EE10562.Subject_) AND __NN(__EE10562.Offense_));
  __JC13406(E_Person_Offenses(__in).Layout __EE12162, E_Person(__in).Layout __EE13397) := __EEQP(__EE13397.UID,__EE12162.Subject_);
  SHARED __EE13407 := JOIN(__EE12162,__EE13397,__JC13406(LEFT,RIGHT),TRANSFORM(E_Person_Offenses(__in).Layout,SELF:=LEFT),MANY LOOKUP,KEEP(1));
  SHARED __ST9219_Layout := RECORD
    KEL.typ.nuid UID;
    KEL.typ.nstr Offender_Key_;
    KEL.typ.nstr Offense_Type_;
    KEL.typ.nkdate Date_Of_Offence_;
    KEL.typ.nint Offense_Category_;
    KEL.typ.nstr County_Of_Source_;
    KEL.typ.nstr State_Of_Source_;
    KEL.typ.nstr Department_Of_Law_Enforcement_Number_;
    KEL.typ.nstr Federal_Bureau_Of_Investigations_Number_;
    KEL.typ.nstr Inmate_Number_;
    KEL.typ.nstr State_Identification_Number_Assigned_;
    KEL.typ.nkdate Date_Of_Arrest_;
    KEL.typ.nstr Agency_Name_;
    KEL.typ.nint Agency_Case_Number_;
    KEL.typ.nstr Traffic_Ticket_Number_;
    KEL.typ.nstr Arrest_Offense_Code_;
    KEL.typ.nstr Arrest_Initial_Charge_Description_;
    KEL.typ.nstr Arrest_Amended_Charge_Description_;
    KEL.typ.nstr Arrest_Offense_Level_;
    KEL.typ.nkdate Date_Of_Disposition_For_Initial_Charge_;
    KEL.typ.nstr Arrest_Offence_Type_Description_;
    KEL.typ.nstr Initial_Charge_Disposition_Description_;
    KEL.typ.nstr Additional_Disposition_Description_;
    KEL.typ.nstr Court_Code_;
    KEL.typ.nstr Court_Description_;
    KEL.typ.nstr Court_Final_Plea_;
    KEL.typ.nstr Court_Offense_Code_;
    KEL.typ.nstr Court_Offense_Description_;
    KEL.typ.nstr Court_Offense_Additional_Description_;
    KEL.typ.nstr Court_Statute_;
    KEL.typ.nkdate Court_Disposition_Date_;
    KEL.typ.nint Court_Fine_;
    KEL.typ.nstr Suspended_Court_Fine_;
    KEL.typ.nint Court_Cost_;
    KEL.typ.nstr Court_Disposition_Code_;
    KEL.typ.nstr Court_Disposition_Description_;
    KEL.typ.nstr Court_Additional_Disposition_Description_;
    KEL.typ.nkdate Date_Of_Appeal_;
    KEL.typ.nkdate Dateof_Verdict_;
    KEL.typ.nstr Offense_Town_;
    KEL.typ.nstr Persistent_Offense_Key_;
    KEL.typ.nkdate Court_Date_;
    KEL.typ.nstr Court_County_;
    KEL.typ.nstr Arrest_Offense_Level_Mapped_;
    KEL.typ.nstr Court_Offense_Level_Mapped_;
    KEL.typ.ndataset(E_Criminal_Offense(__in).Offense_Charges_Layout) Offense_Charges_;
    KEL.typ.ndataset(E_Criminal_Offense(__in).Criminal_Data_Sources_Layout) Criminal_Data_Sources_;
    KEL.typ.ndataset(E_Criminal_Offense(__in).Court_Offense_Level_Layout) Court_Offense_Level_;
    KEL.typ.ndataset(E_Criminal_Offense(__in).Offender_Level_Layout) Offender_Level_;
    KEL.typ.ndataset(E_Criminal_Offense(__in).Fcra_Data_Layout) Fcra_Data_;
    KEL.typ.ndataset(E_Criminal_Offense(__in).Conviction_Overrides_Layout) Conviction_Overrides_;
    KEL.typ.ndataset(E_Criminal_Offense(__in).Data_Sources_Layout) Data_Sources_;
    KEL.typ.ntyp(E_Person().Typ) Subject_;
    KEL.typ.ntyp(E_Criminal_Offense().Typ) Offense_;
    KEL.typ.ndataset(E_Person_Offenses(__in).Data_Sources_Layout) Data_Sources__1_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  __JC13416(E_Criminal_Offense(__in).Layout __EE10563, E_Person_Offenses(__in).Layout __EE13407) := __EEQP(__EE13407.Offense_,__EE10563.UID);
  __ST9219_Layout __JT13416(E_Criminal_Offense(__in).Layout __l, E_Person_Offenses(__in).Layout __r) := TRANSFORM
    SELF.Data_Sources__1_ := __r.Data_Sources_;
    SELF := __l;
    SELF := __r;
  END;
  SHARED __EE13417 := JOIN(__EE10563,__EE13407,__JC13416(LEFT,RIGHT),__JT13416(LEFT,RIGHT),INNER,MANY LOOKUP);
  SHARED __ST10230_Layout := RECORD
    KEL.typ.nuid UID;
    KEL.typ.nstr Gender_;
    KEL.typ.nstr Lex_I_D_Segment_;
    KEL.typ.ndataset(E_Person(__in).Full_Name_Layout) Full_Name_;
    KEL.typ.ndataset(E_Person(__in).Reported_Dates_Of_Birth_Layout) Reported_Dates_Of_Birth_;
    KEL.typ.ndataset(E_Person(__in).Reported_Dates_Of_Death_Layout) Reported_Dates_Of_Death_;
    KEL.typ.nstr Race_;
    KEL.typ.nstr Race_Description_;
    KEL.typ.ndataset(E_Person(__in).Data_Sources_Layout) Data_Sources_;
    KEL.typ.ndataset(__ST9219_Layout) Offense_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  __JC13426(E_Person(__in).Layout __EE13397, __ST9219_Layout __EE13417) := __EEQP(__EE13397.UID,__EE13417.Subject_);
  __ST10230_Layout __Join__ST10230_Layout(E_Person(__in).Layout __r, DATASET(__ST9219_Layout) __recs) := TRANSFORM
    SELF := __r;
    SELF.Offense_ := __CN(__recs);
  END;
  SHARED __EE13427 := DENORMALIZE(DISTRIBUTE(__EE13397,HASH(UID)),DISTRIBUTE(__EE13417,HASH(Subject_)),__JC13426(LEFT,RIGHT),GROUP,__Join__ST10230_Layout(LEFT,ROWS(RIGHT)),LOCAL,MANY LOOKUP);
  SHARED __ST2894_Layout := RECORD
    KEL.typ.nstr Case_Number_;
    KEL.typ.nkdate Case_Date_;
    KEL.typ.nstr Case_Type_Description_;
    KEL.typ.nkdate Offense_Date_;
    KEL.typ.nstr Offense_Score_;
    KEL.typ.nint Data_Type_;
    KEL.typ.nstr Traffic_Flag_;
    KEL.typ.nstr Conviction_Flag_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2906_Layout := RECORD
    KEL.typ.nstr Data_Source_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2911_Layout := RECORD
    KEL.typ.nstr Court_Offense_Level_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2916_Layout := RECORD
    KEL.typ.nint Offender_Level_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2921_Layout := RECORD
    KEL.typ.nstr Fcra_Offense_Key_;
    KEL.typ.nkdate Fcra_Date_;
    KEL.typ.nstr Fcra_Date_Type_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2928_Layout := RECORD
    KEL.typ.nkdate Conviction_Override_Date_;
    KEL.typ.nstr Conviction_Override_Date_Type_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2934_Layout := RECORD
    KEL.typ.nstr Source_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2937_Layout := RECORD
    KEL.typ.nstr Offender_Key_;
    KEL.typ.nstr Offense_Type_;
    KEL.typ.nkdate Date_Of_Offence_;
    KEL.typ.nint Offense_Category_;
    KEL.typ.nstr County_Of_Source_;
    KEL.typ.nstr State_Of_Source_;
    KEL.typ.nstr Department_Of_Law_Enforcement_Number_;
    KEL.typ.nstr Federal_Bureau_Of_Investigations_Number_;
    KEL.typ.nstr Inmate_Number_;
    KEL.typ.nstr State_Identification_Number_Assigned_;
    KEL.typ.nkdate Date_Of_Arrest_;
    KEL.typ.nstr Agency_Name_;
    KEL.typ.nint Agency_Case_Number_;
    KEL.typ.nstr Traffic_Ticket_Number_;
    KEL.typ.nstr Arrest_Offense_Code_;
    KEL.typ.nstr Arrest_Initial_Charge_Description_;
    KEL.typ.nstr Arrest_Amended_Charge_Description_;
    KEL.typ.nstr Arrest_Offense_Level_;
    KEL.typ.nkdate Date_Of_Disposition_For_Initial_Charge_;
    KEL.typ.nstr Arrest_Offence_Type_Description_;
    KEL.typ.nstr Initial_Charge_Disposition_Description_;
    KEL.typ.nstr Additional_Disposition_Description_;
    KEL.typ.nstr Court_Code_;
    KEL.typ.nstr Court_Description_;
    KEL.typ.nstr Court_Final_Plea_;
    KEL.typ.nstr Court_Offense_Code_;
    KEL.typ.nstr Court_Offense_Description_;
    KEL.typ.nstr Court_Offense_Additional_Description_;
    KEL.typ.nstr Court_Statute_;
    KEL.typ.nkdate Court_Disposition_Date_;
    KEL.typ.nint Court_Fine_;
    KEL.typ.nstr Suspended_Court_Fine_;
    KEL.typ.nint Court_Cost_;
    KEL.typ.nstr Court_Disposition_Code_;
    KEL.typ.nstr Court_Disposition_Description_;
    KEL.typ.nstr Court_Additional_Disposition_Description_;
    KEL.typ.nkdate Date_Of_Appeal_;
    KEL.typ.nkdate Dateof_Verdict_;
    KEL.typ.nstr Offense_Town_;
    KEL.typ.nstr Persistent_Offense_Key_;
    KEL.typ.nkdate Court_Date_;
    KEL.typ.nstr Court_County_;
    KEL.typ.nstr Arrest_Offense_Level_Mapped_;
    KEL.typ.nstr Court_Offense_Level_Mapped_;
    KEL.typ.ndataset(__ST2894_Layout) Offense_Charges_;
    KEL.typ.ndataset(__ST2906_Layout) Criminal_Data_Sources_;
    KEL.typ.ndataset(__ST2911_Layout) Court_Offense_Level_;
    KEL.typ.ndataset(__ST2916_Layout) Offender_Level_;
    KEL.typ.ndataset(__ST2921_Layout) Fcra_Data_;
    KEL.typ.ndataset(__ST2928_Layout) Conviction_Overrides_;
    KEL.typ.ndataset(__ST2934_Layout) Data_Sources_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2990_Layout := RECORD
    KEL.typ.nuid UID;
    KEL.typ.ndataset(__ST2937_Layout) Offense_;
    KEL.typ.epoch Date_First_Seen_ := 0;
    KEL.typ.epoch Date_Last_Seen_ := 0;
    KEL.typ.int __RecordCount := 0;
  END;
  SHARED __ST2990_Layout __ND13039__Project(__ST10230_Layout __PP13035) := TRANSFORM
    __EE13430 := __PP13035.Offense_;
    __ST2937_Layout __ND13077__Project(__ST9219_Layout __PP13073) := TRANSFORM
      __EE13439 := __PP13073.Offense_Charges_;
      SELF.Offense_Charges_ := __BN(PROJECT(TABLE(PROJECT(__T(__EE13439),__ST2894_Layout),{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Case_Number_,Case_Date_,Case_Type_Description_,Offense_Date_,Offense_Score_,Data_Type_,Traffic_Flag_,Conviction_Flag_},Case_Number_,Case_Date_,Case_Type_Description_,Offense_Date_,Offense_Score_,Data_Type_,Traffic_Flag_,Conviction_Flag_,MERGE),__ST2894_Layout),__NL(__EE13439));
      __EE13442 := __PP13073.Criminal_Data_Sources_;
      SELF.Criminal_Data_Sources_ := __BN(PROJECT(TABLE(PROJECT(__T(__EE13442),__ST2906_Layout),{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Data_Source_},Data_Source_,MERGE),__ST2906_Layout),__NL(__EE13442));
      __EE13436 := __PP13073.Court_Offense_Level_;
      SELF.Court_Offense_Level_ := __BN(PROJECT(TABLE(PROJECT(__T(__EE13436),__ST2911_Layout),{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Court_Offense_Level_},Court_Offense_Level_,MERGE),__ST2911_Layout),__NL(__EE13436));
      __EE13445 := __PP13073.Offender_Level_;
      SELF.Offender_Level_ := __BN(PROJECT(TABLE(PROJECT(__T(__EE13445),__ST2916_Layout),{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Offender_Level_},Offender_Level_,MERGE),__ST2916_Layout),__NL(__EE13445));
      __EE13448 := __PP13073.Fcra_Data_;
      SELF.Fcra_Data_ := __BN(PROJECT(TABLE(PROJECT(__T(__EE13448),__ST2921_Layout),{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Fcra_Offense_Key_,Fcra_Date_,Fcra_Date_Type_},Fcra_Offense_Key_,Fcra_Date_,Fcra_Date_Type_,MERGE),__ST2921_Layout),__NL(__EE13448));
      __EE13451 := __PP13073.Conviction_Overrides_;
      SELF.Conviction_Overrides_ := __BN(PROJECT(TABLE(PROJECT(__T(__EE13451),__ST2928_Layout),{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Conviction_Override_Date_,Conviction_Override_Date_Type_},Conviction_Override_Date_,Conviction_Override_Date_Type_,MERGE),__ST2928_Layout),__NL(__EE13451));
      __EE13433 := __PP13073.Data_Sources_;
      SELF.Data_Sources_ := __BN(PROJECT(TABLE(PROJECT(__T(__EE13433),__ST2934_Layout),{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Source_},Source_,MERGE),__ST2934_Layout),__NL(__EE13433));
      SELF := __PP13073;
    END;
    __ST2937_Layout __ND13077__Rollup(__ST2937_Layout __r, DATASET(__ST2937_Layout) __recs) := TRANSFORM
      __recs_Offense_Charges_ := NORMALIZE(__recs,__T(LEFT.Offense_Charges_),TRANSFORM(__ST2894_Layout,SELF:=RIGHT));
      __recs_Offense_Charges__allnull := NOT EXISTS(__recs(__NN(Offense_Charges_)));
      SELF.Offense_Charges_ := __BN(PROJECT(TABLE(__recs_Offense_Charges_,{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Case_Number_,Case_Date_,Case_Type_Description_,Offense_Date_,Offense_Score_,Data_Type_,Traffic_Flag_,Conviction_Flag_},Case_Number_,Case_Date_,Case_Type_Description_,Offense_Date_,Offense_Score_,Data_Type_,Traffic_Flag_,Conviction_Flag_),__ST2894_Layout),__recs_Offense_Charges__allnull);
      __recs_Criminal_Data_Sources_ := NORMALIZE(__recs,__T(LEFT.Criminal_Data_Sources_),TRANSFORM(__ST2906_Layout,SELF:=RIGHT));
      __recs_Criminal_Data_Sources__allnull := NOT EXISTS(__recs(__NN(Criminal_Data_Sources_)));
      SELF.Criminal_Data_Sources_ := __BN(PROJECT(TABLE(__recs_Criminal_Data_Sources_,{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Data_Source_},Data_Source_),__ST2906_Layout),__recs_Criminal_Data_Sources__allnull);
      __recs_Court_Offense_Level_ := NORMALIZE(__recs,__T(LEFT.Court_Offense_Level_),TRANSFORM(__ST2911_Layout,SELF:=RIGHT));
      __recs_Court_Offense_Level__allnull := NOT EXISTS(__recs(__NN(Court_Offense_Level_)));
      SELF.Court_Offense_Level_ := __BN(PROJECT(TABLE(__recs_Court_Offense_Level_,{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Court_Offense_Level_},Court_Offense_Level_),__ST2911_Layout),__recs_Court_Offense_Level__allnull);
      __recs_Offender_Level_ := NORMALIZE(__recs,__T(LEFT.Offender_Level_),TRANSFORM(__ST2916_Layout,SELF:=RIGHT));
      __recs_Offender_Level__allnull := NOT EXISTS(__recs(__NN(Offender_Level_)));
      SELF.Offender_Level_ := __BN(PROJECT(TABLE(__recs_Offender_Level_,{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Offender_Level_},Offender_Level_),__ST2916_Layout),__recs_Offender_Level__allnull);
      __recs_Fcra_Data_ := NORMALIZE(__recs,__T(LEFT.Fcra_Data_),TRANSFORM(__ST2921_Layout,SELF:=RIGHT));
      __recs_Fcra_Data__allnull := NOT EXISTS(__recs(__NN(Fcra_Data_)));
      SELF.Fcra_Data_ := __BN(PROJECT(TABLE(__recs_Fcra_Data_,{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Fcra_Offense_Key_,Fcra_Date_,Fcra_Date_Type_},Fcra_Offense_Key_,Fcra_Date_,Fcra_Date_Type_),__ST2921_Layout),__recs_Fcra_Data__allnull);
      __recs_Conviction_Overrides_ := NORMALIZE(__recs,__T(LEFT.Conviction_Overrides_),TRANSFORM(__ST2928_Layout,SELF:=RIGHT));
      __recs_Conviction_Overrides__allnull := NOT EXISTS(__recs(__NN(Conviction_Overrides_)));
      SELF.Conviction_Overrides_ := __BN(PROJECT(TABLE(__recs_Conviction_Overrides_,{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Conviction_Override_Date_,Conviction_Override_Date_Type_},Conviction_Override_Date_,Conviction_Override_Date_Type_),__ST2928_Layout),__recs_Conviction_Overrides__allnull);
      __recs_Data_Sources_ := NORMALIZE(__recs,__T(LEFT.Data_Sources_),TRANSFORM(__ST2934_Layout,SELF:=RIGHT));
      __recs_Data_Sources__allnull := NOT EXISTS(__recs(__NN(Data_Sources_)));
      SELF.Data_Sources_ := __BN(PROJECT(TABLE(__recs_Data_Sources_,{KEL.typ.int __RecordCount := SUM(GROUP,__RecordCount),KEL.typ.epoch Date_First_Seen_ := KEL.era.SimpleRoll(GROUP,Date_First_Seen_,MIN,TRUE),KEL.typ.epoch Date_Last_Seen_ := KEL.era.SimpleRoll(GROUP,Date_Last_Seen_,MAX,FALSE),Source_},Source_),__ST2934_Layout),__recs_Data_Sources__allnull);
      SELF.__RecordCount := SUM(__recs,__RecordCount);
      SELF.Date_First_Seen_ := KEL.era.SimpleRoll(__recs,Date_First_Seen_,MIN,TRUE);
      SELF.Date_Last_Seen_ := KEL.era.SimpleRoll(__recs,Date_Last_Seen_,MAX,FALSE);
      SELF := __r;
    END;
    SELF.Offense_ := __BN(ROLLUP(GROUP(KEL.Routines.SortAndAppendFilteredChildren(PROJECT(__T(__EE13430),__ND13077__Project(LEFT))(__NN(Offender_Key_) OR __NN(Offense_Type_) OR __NN(Date_Of_Offence_) OR __NN(Offense_Category_) OR __NN(County_Of_Source_) OR __NN(State_Of_Source_) OR __NN(Department_Of_Law_Enforcement_Number_) OR __NN(Federal_Bureau_Of_Investigations_Number_) OR __NN(Inmate_Number_) OR __NN(State_Identification_Number_Assigned_) OR __NN(Date_Of_Arrest_) OR __NN(Agency_Name_) OR __NN(Agency_Case_Number_) OR __NN(Traffic_Ticket_Number_) OR __NN(Arrest_Offense_Code_) OR __NN(Arrest_Initial_Charge_Description_) OR __NN(Arrest_Amended_Charge_Description_) OR __NN(Arrest_Offense_Level_) OR __NN(Date_Of_Disposition_For_Initial_Charge_) OR __NN(Arrest_Offence_Type_Description_) OR __NN(Initial_Charge_Disposition_Description_) OR __NN(Additional_Disposition_Description_) OR __NN(Court_Code_) OR __NN(Court_Description_) OR __NN(Court_Final_Plea_) OR __NN(Court_Offense_Code_) OR __NN(Court_Offense_Description_) OR __NN(Court_Offense_Additional_Description_) OR __NN(Court_Statute_) OR __NN(Court_Disposition_Date_) OR __NN(Court_Fine_) OR __NN(Suspended_Court_Fine_) OR __NN(Court_Cost_) OR __NN(Court_Disposition_Code_) OR __NN(Court_Disposition_Description_) OR __NN(Court_Additional_Disposition_Description_) OR __NN(Date_Of_Appeal_) OR __NN(Dateof_Verdict_) OR __NN(Offense_Town_) OR __NN(Persistent_Offense_Key_) OR __NN(Court_Date_) OR __NN(Court_County_) OR __NN(Arrest_Offense_Level_Mapped_) OR __NN(Court_Offense_Level_Mapped_) OR __NN(Offense_Charges_) OR __NN(Criminal_Data_Sources_) OR __NN(Court_Offense_Level_) OR __NN(Offender_Level_) OR __NN(Fcra_Data_) OR __NN(Conviction_Overrides_) OR __NN(Data_Sources_)),'Offense_Charges_,Criminal_Data_Sources_,Court_Offense_Level_,Offender_Level_,Fcra_Data_,Conviction_Overrides_,Data_Sources_','offense_charges_,criminal_data_sources_,court_offense_level_,offender_level_,fcra_data_,conviction_overrides_,data_sources_','clean','__recordcount,date_first_seen_,date_last_seen_'),Offender_Key_,Offense_Type_,Date_Of_Offence_,Offense_Category_,County_Of_Source_,State_Of_Source_,Department_Of_Law_Enforcement_Number_,Federal_Bureau_Of_Investigations_Number_,Inmate_Number_,State_Identification_Number_Assigned_,Date_Of_Arrest_,Agency_Name_,Agency_Case_Number_,Traffic_Ticket_Number_,Arrest_Offense_Code_,Arrest_Initial_Charge_Description_,Arrest_Amended_Charge_Description_,Arrest_Offense_Level_,Date_Of_Disposition_For_Initial_Charge_,Arrest_Offence_Type_Description_,Initial_Charge_Disposition_Description_,Additional_Disposition_Description_,Court_Code_,Court_Description_,Court_Final_Plea_,Court_Offense_Code_,Court_Offense_Description_,Court_Offense_Additional_Description_,Court_Statute_,Court_Disposition_Date_,Court_Fine_,Suspended_Court_Fine_,Court_Cost_,Court_Disposition_Code_,Court_Disposition_Description_,Court_Additional_Disposition_Description_,Date_Of_Appeal_,Dateof_Verdict_,Offense_Town_,Persistent_Offense_Key_,Court_Date_,Court_County_,Arrest_Offense_Level_Mapped_,Court_Offense_Level_Mapped_,Offense_Charges_Clean,Criminal_Data_Sources_Clean,Court_Offense_Level_Clean,Offender_Level_Clean,Fcra_Data_Clean,Conviction_Overrides_Clean,Data_Sources_Clean,ALL),GROUP,__ND13077__Rollup(ROW(LEFT,__ST2937_Layout), PROJECT(ROWS(LEFT),__ST2937_Layout))),__NL(__EE13430));
    SELF := __PP13035;
  END;
  EXPORT Res0 := __UNWRAP(PROJECT(PROJECT(__EE13427,__ND13039__Project(LEFT)),__ST2990_Layout));
END;
