IMPORT SALT311,STD;
EXPORT Raw_Delta(DATASET(Raw_Layout_IRS5500)old_s, DATASET(Raw_Layout_IRS5500) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['ack_id','form_plan_year_begin_date','form_tax_prd','type_plan_entity_cd','type_dfe_plan_entity_cd','initial_filing_ind','amended_ind','final_filing_ind','short_plan_yr_ind','collective_bargain_ind','f5558_application_filed_ind','ext_automatic_ind','dfvc_program_ind','ext_special_ind','ext_special_text','plan_name','spons_dfe_pn','plan_eff_date','sponsor_dfe_name','spons_dfe_dba_name','spons_dfe_care_of_name','spons_dfe_mail_us_address1','spons_dfe_mail_us_address2','spons_dfe_mail_us_city','spons_dfe_mail_us_state','spons_dfe_mail_us_zip','spons_dfe_mail_foreign_addr1','spons_dfe_mail_foreign_addr2','spons_dfe_mail_foreign_city','spons_dfe_mail_forgn_prov_st','spons_dfe_mail_foreign_cntry','spons_dfe_mail_forgn_postal_cd','spons_dfe_loc_us_address1','spons_dfe_loc_us_address2','spons_dfe_loc_us_city','spons_dfe_loc_us_state','spons_dfe_loc_us_zip','spons_dfe_loc_foreign_address1','spons_dfe_loc_foreign_address2','spons_dfe_loc_foreign_city','spons_dfe_loc_forgn_prov_st','spons_dfe_loc_foreign_cntry','spons_dfe_loc_forgn_postal_cd','spons_dfe_ein','spons_dfe_phone_num','business_code','admin_name','admin_care_of_name','admin_us_address1','admin_us_address2','admin_us_city','admin_us_state','admin_us_zip','admin_foreign_address1','admin_foreign_address2','admin_foreign_city','admin_foreign_prov_state','admin_foreign_cntry','admin_foreign_postal_cd','admin_ein','admin_phone_num','last_rpt_spons_name','last_rpt_spons_ein','last_rpt_plan_num','admin_signed_date','admin_signed_name','spons_signed_date','spons_signed_name','dfe_signed_date','dfe_signed_name','tot_partcp_boy_cnt','tot_active_partcp_cnt','rtd_sep_partcp_rcvg_cnt','rtd_sep_partcp_fut_cnt','subtl_act_rtd_sep_cnt','benef_rcvg_bnft_cnt','tot_act_rtd_sep_benef_cnt','partcp_account_bal_cnt','sep_partcp_partl_vstd_cnt','contrib_emplrs_cnt','type_pension_bnft_code','type_welfare_bnft_code','funding_insurance_ind','funding_sec412_ind','funding_trust_ind','funding_gen_asset_ind','benefit_insurance_ind','benefit_sec412_ind','benefit_trust_ind','benefit_gen_asset_ind','sch_r_attached_ind','sch_mb_attached_ind','sch_sb_attached_ind','sch_h_attached_ind','sch_i_attached_ind','sch_a_attached_ind','num_sch_a_attached_cnt','sch_c_attached_ind','sch_d_attached_ind','sch_g_attached_ind','filing_status','date_received','valid_admin_signature','valid_dfe_signature','valid_sponsor_signature','admin_phone_num_foreign','spons_dfe_phone_num_foreign','admin_name_same_spon_ind','admin_address_same_spon_ind','preparer_name','preparer_firm_name','preparer_us_address1','preparer_us_address2','preparer_us_city','preparer_us_state','preparer_us_zip','preparer_foreign_address1','preparer_foreign_address2','preparer_foreign_city','preparer_foreign_prov_state','preparer_foreign_cntry','preparer_foreign_postal_cd','preparer_phone_num','preparer_phone_num_foreign'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := Raw_hygiene(old_s).Summary('Old') + Raw_hygiene(new_s).Summary('New') + Raw_hygiene(PROJECT(Differences(deleted), TRANSFORM(Raw_Layout_IRS5500, SELF := LEFT.old_rec))).Summary('Deletions') + Raw_hygiene(PROJECT(Differences(added), TRANSFORM(Raw_Layout_IRS5500, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_IRS5500, Raw_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
