import BairRx_Common,iesp,SALT32;

EXPORT ESPOut := MODULE

	// -----------------------------------------------------------------
	// SEARCH TRANSFORMS 
	// -----------------------------------------------------------------

	EXPORT iesp.bair_event.t_BAIREventSearchRecord SearchView(BairRx_Event.Layouts.SearchPayload L, REAL geo_lat, REAL geo_lon) := TRANSFORM
		SELF.EntityID := BairRx_Common.EID.Stamp(L.eid, (unsigned)L.mostamp),
		SELF.IRNumber := L.ir_number,
		SELF.UCRGroup := (string) L.ucr_group,
		SELF.Class := (string) L.ucr_group,
		SELF.Crime := L.Crime,
		SELF.LocationType := L.location_type,
		SELF.ObjectOfAttack1 := L.object_of_attack_1,
		SELF.ObjectOfAttack2 := L.object_of_attack_2,
		SELF.PointOfEntry1 := L.point_of_entry_1,
		SELF.PointOfEntry2 := L.point_of_entry_2,
		SELF.MethodOfEntry1 := L.method_of_entry_1, 
		SELF.MethodOfEntry2 := L.method_of_entry_2,
		SELF.SuspectsActionsAgainstPerson1 := L.suspects_actions_against_person_1,
		SELF.SuspectsActionsAgainstPerson2 := L.suspects_actions_against_person_2,
		SELF.SuspectsActionsAgainstPerson3 := L.suspects_actions_against_person_3,
		SELF.SuspectsActionsAgainstPerson4 := L.suspects_actions_against_person_4,
		SELF.SuspectsActionsAgainstPerson5 := L.suspects_actions_against_person_5,
		SELF.SuspectsActionsAgainstProperty1 := L.suspects_actions_against_property_1,
		SELF.SuspectsActionsAgainstProperty2 := L.suspects_actions_against_property_2,
		SELF.SuspectsActionsAgainstProperty3 := L.suspects_actions_against_property_3,
		SELF.PropertyTaken1 := L.property_taken_1,
		SELF.PropertyTaken2 := L.property_taken_2,
		SELF.PropertyTaken3 := L.property_taken_3,
		SELF.PropertyValue := L.property_value,
		SELF.WeaponType1 := L.weapon_type_1,
		SELF.WeaponType2 := L.weapon_type_2,
		SELF.MethodOfDeparture := L.method_of_departure,
		SELF.FirstDateTime := L.first_date_time,
		SELF.LastDateTime := L.last_date_time,
		SELF.ReportDate := L.report_date,
		SELF.PublicAddress := L.public_address,
		SELF.AddressOfCrime := L.address_of_crime,
		SELF.AddressName   :=	L.address_name,
		SELF.Beat := L.beat,
		SELF.RD := L.rd,
		SELF.Raids := (string) L.raids,
		SELF.CitizenObserverID:= (string)L.citizen_observer_id,
		SELF.NumOfCompanions := L.companions,
		SELF.AptNum := L.apt,
		SELF.Agency := L.agency,
		SELF.Accuracy := L.accuracy,					
		SELF.NameType := L.name_type,
		SELF.FirstName := L.first_name,
		SELF.MiddleName := L.middle_name,
		SELF.LastName := L.last_name,
		SELF.Moniker := L.moniker,
		SELF.PersonsAddress := L.persons_address,
		SELF.DOB := L.dob,
		SELF.Race := L.race,
		SELF.Sex := L.sex,
		SELF.Hair := L.hair,
		SELF.HairLength := L.hair_length,
		SELF.Eyes := L.eyes,
		SELF.HandUse := L.hand_use,
		SELF.Speech := L.speech,
		SELF.Teeth := L.teeth,
		SELF.PhysicalCondition := L.physical_condition,
		SELF.Build := L.build,
		SELF.Complexion := L.complexion,
		SELF.FacialHair := L.facial_hair,
		SELF.Hat := L.hat,
		SELF.Mask := L.mask,
		SELF.Glasses := L.glasses,
		SELF.Appearance := L.appearance,
		SELF.Shirt := L.shirt,
		SELF.Pants := L.pants,
		SELF.Shoes := L.shoes,
		SELF.Jacket := L.jacket,
		SELF.Soundex := L.soundex,
		SELF.Weight1 := (STRING) L.weight_1,
		SELF.Weight2 := (STRING) L.weight_2,
		SELF.Height1 := (STRING) L.height_1,
		SELF.Height2 := (STRING) L.height_2,
		SELF.Age1 := (STRING) L.age_1,
		SELF.Age2 := (STRING) L.age_2,
		SELF.SID := L.persons_sid,
		SELF.FacialRecognition := L.facial_recognition,
		SELF.Plate := L.plate,
		SELF.PlateState := L.plate_state,
		SELF.Make := L.make,
		SELF.Model := L.model,
		SELF.Style := L.style,
		SELF.Color := L.color,
		SELF.Year := L.year,
		SELF._Type := L.type,
		SELF.VehicleStatus := L.vehicle_status,
		SELF.VehicleAddress := L.vehicle_address,		
		SELF.XCoordinate := (STRING) L.x_coordinate,
		SELF.YCoordinate := (STRING) L.y_coordinate,
		SELF.XOffset := (STRING) L.x_offset,
		SELF.YOffset := (STRING) L.y_offset,
		SELF.ProjectedX := (STRING) L.projected_x,
		SELF.ProjectedY := (STRING) L.projected_y,
		SELF.TCoordinate :=	(string)L.t_coordinate,
		SELF.GeoCoded := L.geocoded,
		_distance := IF(geo_lat<>0 and geo_lon<>0, SALT32.MOD_LL.Distance((REAL)L.y_coordinate,(REAL)L.x_coordinate,geo_lat,geo_lon), 0.0);				
		SELF.Distance := REALFORMAT(_distance,10,2),				
		SELF.MOUDF1 	:= L.MOUDF1,
		SELF.MOUDF2 	:= L.MOUDF2,
		SELF.MOUDF3 	:= L.MOUDF3,
		SELF.MOUDF4 	:= L.MOUDF4,
		SELF.MOUDF5 	:= L.MOUDF5,
		SELF.MOUDF6 	:= L.MOUDF6,
		SELF.MOUDF7 	:= L.MOUDF7,
		SELF.MOUDF8 	:= L.MOUDF8,
		SELF.PersonsUDF1 := L.PersonUDF1,
		SELF.PersonsUDF2 := L.PersonUDF2,
		SELF.PersonsUDF3 := L.PersonUDF3,
		SELF.PersonsUDF4 := L.PersonUDF4,	
		SELF.FirstDay :=	L.first_day,
		SELF.LastDay :=	L.last_day,
		SELF.Commonalities :=	(string)L.commonalities,
		SELF.MoStamp := (string)L.mostamp,
		SELF.ORI :=	(string) L.ORI,
		SELF.FirstDate := L.first_date,
		SELF.LastDate := L.last_date,
		SELF.FirstTime := (STRING) L.first_time,
		SELF.LastTime := (STRING) L.last_time,
		SELF.PersonsXCoordinate := (STRING)L.persons_x_coordinate,
		SELF.PersonsYCoordinate := (STRING)L.persons_y_coordinate,
		SELF.PersonsXProjected := (STRING)L.persons_x_projected,
		SELF.PersonsYProjected := (STRING)L.persons_y_projected,
		SELF.PersonsAccuracy := (STRING)L.persons_accuracy,
		SELF.PersonsGeocoded := (STRING)L.persons_geocoded,
		SELF.PersonsEditDate := L.persons_edit_date,
		SELF.VehicleXCoordinate := (STRING)L.vehicle_x_coordinate,
		SELF.VehicleYCoordinate := (STRING)L.vehicle_y_coordinate,
		SELF.VehicleXProjected := (STRING)L.vehicle_x_projected,
		SELF.VehicleYProjected := (STRING)L.vehicle_y_projected,
		SELF.VehicleAccuracy := (STRING)L.vehicle_accuracy,
		SELF.VehicleGeocoded := (STRING)L.vehicle_geocoded,
		SELF.VehicleEditDate := L.vehicle_edit_date,
		SELF.AddressOfCrimeClean.City := L.City,
		SELF.AddressOfCrimeClean.State := L.State,
		SELF.AddressOfCrimeClean.Zip5 := L.Zip,
		SELF := []
	END;
	
	EXPORT iesp.bair_event_slim.t_BAIREventSlimSearchRecord SlimSearchView(BairRx_Event.Layouts.SlimSearchPayload L, REAL geo_lat, REAL geo_lon) := TRANSFORM
		SELF.EntityID := BairRx_Common.EID.Stamp(L.eid, (unsigned)L.mostamp),
		SELF.IRNumber := L.ir_number,
		SELF.UCRGroup := (string) L.ucr_group,
		SELF.Class := (string) L.ucr_group,
		SELF.Crime := L.Crime,
		SELF.PublicAddress := L.public_address,
		SELF.Accuracy := L.accuracy,
		_distance := IF(geo_lat<>0 and geo_lon<>0, SALT32.MOD_LL.Distance((REAL)L.y_coordinate,(REAL)L.x_coordinate,geo_lat,geo_lon), 0.0);				
		SELF.Distance := REALFORMAT(_distance,10,2),
		SELF.LocationType := L.location_type,
		SELF.FirstDateTime := L.first_date_time,
		SELF.XCoordinate := (STRING) L.x_coordinate,
		SELF.YCoordinate := (STRING) L.y_coordinate,
		SELF.XOffset := (STRING) L.x_offset,
		SELF.YOffset := (STRING) L.y_offset,
		SELF.Agency := L.agency,
		SELF.ORI :=	(string) L.ORI,
		SELF.SynopsisOfCrime := L.public_synopsis,
		SELF.PublicAddressClean := []
	END;
	
	
	// -----------------------------------------------------------------
	// REPORT TRANSFORMS 
	// -----------------------------------------------------------------
	
	SHARED iesp.bair_event.t_BAIRMORecord xtReportMo(BairRx_Event.Layouts.PayloadMOWithNotes L) := TRANSFORM			
			SELF.GeoCoded := L.geocoded;
			SELF.IRNumber := L.ir_number,
			SELF.UCRGroup := (string) L.ucr_group,
			SELF.Class := BairRx_Common.Functions.GetClass(BairRx_Common.Constants.Mode.EVE,(string) L.ucr_group),
			SELF.Crime := L.Crime,
			SELF.FirstDate := L.first_date,
			SELF.LastDate := L.last_date,
			SELF.FirstDateTime := L.first_date_time,
			SELF.LastDateTime := L.last_date_time,
			SELF.FirstTime := (string)L.first_time,
			SELF.LastTime :=  (string)L.last_time,
			SELF.AddressOfCrime := L.address_of_crime,
			SELF.Agency := L.Agency,
			SELF.Accuracy := L.accuracy,
			SELF.XCoordinate := (STRING) L.x_coordinate,
			SELF.YCoordinate := (STRING) L.y_coordinate,		
			SELF.XOffset := (STRING) L.x_offset,
			SELF.YOffset := (STRING) L.y_offset,
			SELF.EditDate := L.edit_date, 
			SELF.ProjectedX := (STRING) L.projected_x,
			SELF.ProjectedY := (STRING) L.projected_y,
			SELF.PublicAddress := L.public_address,
			SELF.ObjectOfAttack1 := L.object_of_attack_1,
			SELF.ObjectOfAttack2 := L.object_of_attack_2,
			SELF.PointOfEntry1 := L.point_of_entry_1,
			SELF.PointOfEntry2 := L.point_of_entry_2,
			SELF.MethodOfEntry1 := L.method_of_entry_1, 
			SELF.MethodOfEntry2 := L.method_of_entry_2,
			SELF.SuspectsActionsAgainstPerson1 := L.suspects_actions_against_person_1,
			SELF.SuspectsActionsAgainstPerson2 := L.suspects_actions_against_person_2,
			SELF.SuspectsActionsAgainstPerson3 := L.suspects_actions_against_person_3,
			SELF.SuspectsActionsAgainstPerson4 := L.suspects_actions_against_person_4,
			SELF.SuspectsActionsAgainstPerson5 := L.suspects_actions_against_person_5,
			SELF.SuspectsActionsAgainstProperty1 := L.suspects_actions_against_property_1,
			SELF.SuspectsActionsAgainstProperty2 := L.suspects_actions_against_property_2,
			SELF.SuspectsActionsAgainstProperty3 := L.suspects_actions_against_property_3,
			SELF.PropertyTaken1 := L.property_taken_1,
			SELF.PropertyTaken2 := L.property_taken_2,
			SELF.PropertyTaken3 := L.property_taken_3,
			SELF.PropertyValue := L.property_value,
			SELF.WeaponType1 := L.weapon_type_1,
			SELF.WeaponType2 := L.weapon_type_2,
			SELF.MethodOfDeparture := L.method_of_departure,
			SELF.Beat := L.beat,
			SELF.RD := L.rd,
			SELF.NumOfCompanions := L.companions,
			SELF.AptNum := L.apt,
			SELF.ORI :=	(string) L.ORI,
			SELF.AddressName   :=	L.address_name,
			SELF.TCoordinate   :=	(string)L.t_coordinate,
			SELF.Duration      :=	(string)L.duration,
			SELF.FirstDay      :=	L.first_day,
			SELF.LastDay       :=	L.last_day,
			SELF.Sequence      :=	L.sequence,
			SELF.Marked        :=	L.marked,
			SELF.Commonalities :=	(string)L.commonalities,
			SELF.Interval      :=	L.interval,
			SELF.MOUDF1 	:= L.MOUDF1,
			SELF.MOUDF2 	:= L.MOUDF2,
			SELF.MOUDF3 	:= L.MOUDF3,
			SELF.MOUDF4 	:= L.MOUDF4,
			SELF.MOUDF5 	:= L.MOUDF5,
			SELF.MOUDF6 	:= L.MOUDF6,
			SELF.MOUDF7 	:= L.MOUDF7,
			SELF.MOUDF8 	:= L.MOUDF8,
			SELF.LocationType := L.location_type,
			SELF.MoStamp := (string)L.mostamp,
			SELF.CitizenObserverID:= (string)L.citizen_observer_id,
			SELF.Raids := (string) L.raids,
			SELF.SynopsisOfCrime := L.notes,
			SELF.AddressOfCrimeClean.City := L.City,
			SELF.AddressOfCrimeClean.State := L.State,
			SELF.AddressOfCrimeClean.Zip5 := L.Zip,
			SELF := [],
	END;
	
	SHARED iesp.bair_event.t_BAIRPersonRecord xtReportPerson(BairRx_Event.Layouts.PayloadPersonWithNotes L) := TRANSFORM
		SELF.ORI := (string) L.ori,
		SELF.NameType := L.name_type,
		SELF.FirstName := L.first_name,
		SELF.MiddleName := L.middle_name,
		SELF.LastName := L.last_name,
		SELF.Moniker := L.moniker,
		SELF.PersonsAddress := L.persons_address,
		SELF.Race := L.race,
		SELF.Sex := L.sex,
		SELF.Hair := L.hair,
		SELF.HairLength := L.hair_length,
		SELF.Eyes := L.eyes,
		SELF.HandUse := L.hand_use,
		SELF.Speech := L.speech,
		SELF.Teeth := L.teeth,
		SELF.PhysicalCondition := L.physical_condition,
		SELF.Build := L.build,
		SELF.Complexion := L.complexion,
		SELF.FacialHair := L.facial_hair,
		SELF.Hat := L.hat,
		SELF.Mask := L.mask,
		SELF.Glasses := L.glasses,
		SELF.Appearance := L.appearance,
		SELF.Shirt := L.shirt,
		SELF.Pants := L.pants,
		SELF.Shoes := L.shoes,
		SELF.Jacket := L.jacket,
		SELF.Soundex := L.soundex,
		SELF.Weight1 := (string) L.weight_1,
		SELF.Weight2 := (string) L.weight_2,
		SELF.Height1 := (string) L.height_1,
		SELF.Height2 := (string) L.height_2,
		SELF.Age1 := (string) L.age_1,
		SELF.Age2 := (string) L.age_2,
		SELF.SID := L.persons_sid,
		SELF.FacialRecognition := L.facial_recognition,
		SELF.PersonsProjectedX := (STRING) L.persons_x_projected;
		SELF.PersonsProjectedY := (STRING) L.persons_y_projected;
		SELF.XCoordinate := (STRING) L.persons_x_coordinate,
		SELF.YCoordinate := (STRING) L.persons_y_coordinate,
		SELF.DateOfBirth := L.DOB; // to string
		SELF.EditDate := L.persons_edit_date; // to string
		SELF.PersonsUDF1 := L.PersonUDF1,
		SELF.PersonsUDF2 := L.PersonUDF2,
		SELF.PersonsUDF3 := L.PersonUDF3,
		SELF.PersonsUDF4 := L.PersonUDF4,
		SELF.PersonsNotes := L.notes,
		SELF.LexID := (string) L.LexID,
		SELF.PersonsAddressClean.City := L.City,
		SELF.PersonsAddressClean.State := L.State,
		SELF.PersonsAddressClean.Zip5 := L.Zip,
		SELF := []
	END;
	
	EXPORT iesp.bair_event.t_BAIRVehicleRecord xtReportVehicle(BairRx_Event.Layouts.PayloadVehicleWithNotes L) := TRANSFORM
		SELF.VehicleID := '', // (string) L.id,
		SELF.VIN := '', //(string) L.id, -- no vin for events?
		SELF.Plate := L.plate,
		SELF.PlateState := L.plate_state,
		SELF.Make := L.make,
		SELF.Model := L.model,
		SELF.Style := L.style,
		SELF.Color := L.color,
		SELF.Year :=  (integer)L.year,
		SELF._Type := L.type,
		SELF.SID := '', // ??
		SELF.VehicleStatus := L.vehicle_status,
		SELF.VehicleProjectedX := (STRING) L.vehicle_x_projected,
		SELF.VehicleProjectedY := (STRING) L.vehicle_y_projected,
		SELF.EditDate := L.vehicle_edit_date,
		SELF.ORI := (string) L.ORI,
		SELF.XCoordinate := (STRING) L.vehicle_x_coordinate,
		SELF.YCoordinate := (STRING) L.vehicle_y_coordinate,
		SELF.VehicleAddress := L.vehicle_address,
		SELF.VehicleDescription := L.Notes,
		SELF.VehicleAddressClean.City := L.City,
		SELF.VehicleAddressClean.State := L.State,
		SELF.VehicleAddressClean.Zip5 := L.Zip,
		SELF := []
	END;
	
	iesp.bair_share.t_BAIRNote xtReportNotes(BairRx_Common.Layouts.PayloadNotes L) := TRANSFORM
		SELF.NoteType := BairRx_Common.Constants.NoteTypeLabel(L.note_type),
		SELF.NoteText := L.notes;
	END;
	
	EXPORT iesp.bair_event.t_BAIREventReportRecord ReportView(BairRx_Event.Layouts.ReportPayload L) := TRANSFORM
		// this top section is for convenience. ATACRadids will display this first thing in the report popup.
		_mo := L.MOs[1];
		SELF.ORI := (STRING) _mo.ORI,
		SELF.EntityID := L.EID,
		SELF.IRNumber := _mo.ir_number,
		SELF.UCRGroup := (string) _mo.ucr_group,
		SELF.Class := BairRx_Common.Functions.GetClass(BairRx_Common.Constants.Mode.EVE,(string) _mo.ucr_group),
		SELF.Crime := _mo.Crime,
		SELF.LocationType := _mo.location_type,
		SELF.FirstDateTime := _mo.first_date_time,
		SELF.AddressOfCrime := _mo.address_of_crime,
		SELF.Agency := _mo.agency,
		SELF.Accuracy := _mo.accuracy,
		// everything else is displayed only when user clicks to see full record.
		SELF.MOs := PROJECT(L.Mos, xtReportMO(LEFT)),
		SELF.Persons := PROJECT(L.Persons, xtReportPerson(LEFT)),
		SELF.Vehicles := PROJECT(L.Vehicles, xtReportVehicle(LEFT)),
		self.firsttime := (string)_mo.first_time,
		self.lasttime := (string)_mo.last_time,
		SELF.AddressOfCrimeClean.City := _mo.City,
		SELF.AddressOfCrimeClean.State := _mo.State,
		SELF.AddressOfCrimeClean.Zip5 := _mo.Zip,
		SELF 				:= []
	END;
	
END;
