IMPORT SALT39,STD;
EXPORT Base_Reg_Delta(DATASET(Base_Reg_Layout_Voters)old_s, DATASET(Base_Reg_Layout_Voters) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['rid','did','did_score','ssn','vtid','process_date','date_first_seen','date_last_seen','source','file_id','vendor_id','source_state','source_code','file_acquired_date','use_code','prefix_title','last_name','first_name','middle_name','maiden_prior','clean_maiden_pri','name_suffix_in','voterfiller','source_voterid','dob','agecat','agecat_exp','headhousehold','place_of_birth','occupation','maiden_name','motorvoterid','regsource','regdate','race','race_exp','gender','political_party','politicalparty_exp','phone','work_phone','other_phone','active_status','active_status_exp','gendersurnamguess','active_other','voter_status','voter_status_exp','res_addr1','res_addr2','res_city','res_state','res_zip','res_county','mail_addr1','mail_addr2','mail_city','mail_state','mail_zip','mail_county','addr_filler1','addr_filler2','city_filler','state_filler','zip_filler','timezonetbl','towncode','distcode','countycode','schoolcode','cityinout','spec_dist1','spec_dist2','precinct1','precinct2','precinct3','villageprecinct','schoolprecinct','ward','precinct_citytown','ancsmdindc','citycouncildist','countycommdist','statehouse','statesenate','ushouse','elemschooldist','schooldist','schoolfiller','commcolldist','dist_filler','municipal','villagedist','policejury','policedist','publicservcomm','rescue','fire','sanitary','sewerdist','waterdist','mosquitodist','taxdist','supremecourt','justiceofpeace','judicialdist','superiorctdist','appealsct','courtfiller','cassaddrtyptbl','cassdelivpointcd','casscarrierrtetbl','blkgrpenumdist','congressionaldist','lattitude','countyfips','censustract','fipsstcountycd','longitude','contributorparty','recipientparty','dateofcontr','dollaramt','officecontto','cumuldollaramt','contfiller1','contfiller2','conttype','contfiller4','lastdatevote','miscvotehist','title','fname','mname','lname','name_suffix','name_score','prim_range','predir','prim_name','addr_suffix','postdir','unit_desig','sec_range','p_city_name','v_city_name','st','zip','zip4','cart','cr_sort_sz','lot','lot_order','dpbc','chk_digit','rec_type','ace_fips_st','fips_county','geo_lat','geo_long','msa','geo_blk','geo_match','err_stat','mail_prim_range','mail_predir','mail_prim_name','mail_addr_suffix','mail_postdir','mail_unit_desig','mail_sec_range','mail_p_city_name','mail_v_city_name','mail_st','mail_ace_zip','mail_zip4','mail_cart','mail_cr_sort_sz','mail_lot','mail_lot_order','mail_dpbc','mail_chk_digit','mail_rec_type','mail_ace_fips_st','mail_fips_county','mail_geo_lat','mail_geo_long','mail_msa','mail_geo_blk','mail_geo_match','mail_err_stat','idtypes','precinct','ward1','idcode','precinctparttextdesig','precinctparttextname','precincttextdesig','marriedappend','supervisordistrict','district','ward2','citycountycouncil','countyprecinct','countycommis','schoolboard','ward3','towncitycouncil1','towncitycouncil2','regents','watershed','education','policeconstable','freeholder','municourt','changedate','name_type','addr_type'];
  EXPORT Differences := SALT39.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := Base_Reg_hygiene(old_s).Summary('Old') + Base_Reg_hygiene(new_s).Summary('New') + Base_Reg_hygiene(PROJECT(Differences(deleted), TRANSFORM(Base_Reg_Layout_Voters, SELF := LEFT.old_rec))).Summary('Deletions') + Base_Reg_hygiene(PROJECT(Differences(added), TRANSFORM(Base_Reg_Layout_Voters, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT39.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT39.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_Voters, Base_Reg_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
