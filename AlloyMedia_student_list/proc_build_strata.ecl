  EXPORT proc_build_strata(STRING version) := FUNCTION
 IMPORT STRATA;
 
 Basefile:=Files.File_Base;
 
Layout_Strata:=RECORD
  basefile.clean_st;
	CountGroup:=COUNT(GROUP);
	school_act_code_Cnt  := sum(group,if(basefile.school_act_code<>'',1,0));
	tuition_code_Cnt  := sum(group,if(basefile.tuition_code<>'',1,0));
	public_private_code_Cnt  := sum(group,if(basefile.public_private_code<>'',1,0));
	school_size_code_Cnt  := sum(group,if(basefile.school_size_code<>'',1,0));
	student_last_name_Cnt  := sum(group,if(basefile.student_last_name<>'',1,0));
	student_first_name_Cnt  := sum(group,if(basefile.student_first_name<>'',1,0));
	gender_code_Cnt  := sum(group,if(basefile.gender_code<>'',1,0));
	competitive_code_Cnt  := sum(group,if(basefile.competitive_code<>'',1,0));
	intl_exchange_student_code_Cnt  := sum(group,if(basefile.intl_exchange_student_code<>'',1,0));
	address_sequence_code_Cnt  := sum(group,if(basefile.address_sequence_code<>'',1,0));
	school_name_Cnt  := sum(group,if(basefile.school_name<>'',1,0));
	school_address_2_secondary_Cnt  := sum(group,if(basefile.school_address_2_secondary<>'',1,0));
	filler_1_Cnt  := sum(group,if(basefile.filler_1<>'',1,0));
	school_address_1_primary_Cnt  := sum(group,if(basefile.school_address_1_primary<>'',1,0));
	filler_2_Cnt  := sum(group,if(basefile.filler_2<>'',1,0));
	school_city_Cnt  := sum(group,if(basefile.school_city<>'',1,0));
	school_state_Cnt  := sum(group,if(basefile.school_state<>'',1,0));
	school_zip5_Cnt  := sum(group,if(basefile.school_zip5<>'',1,0));
	school_zip4_Cnt  := sum(group,if(basefile.school_zip4<>'',1,0));
	school_phone_number_Cnt  := sum(group,if(basefile.school_phone_number<>'',1,0));
	school_housing_code_Cnt  := sum(group,if(basefile.school_housing_code<>'',1,0));
	filler_3_Cnt  := sum(group,if(basefile.filler_3<>'',1,0));
	home_address_1_secondary_Cnt  := sum(group,if(basefile.home_address_1_secondary<>'',1,0));
	filler_4_Cnt  := sum(group,if(basefile.filler_4<>'',1,0));
	home_address_2_primary_Cnt  := sum(group,if(basefile.home_address_2_primary<>'',1,0));
	filler_5_Cnt  := sum(group,if(basefile.filler_5<>'',1,0));
	home_city_Cnt  := sum(group,if(basefile.home_city<>'',1,0));
	home_state_Cnt  := sum(group,if(basefile.home_state<>'',1,0));
	home_zip5_Cnt  := sum(group,if(basefile.home_zip5<>'',1,0));
	home_zip4_Cnt  := sum(group,if(basefile.home_zip4<>'',1,0));
	home_phone_number_Cnt  := sum(group,if(basefile.home_phone_number<>'',1,0));
	home_housing_code_Cnt  := sum(group,if(basefile.home_housing_code<>'',1,0));
	class_rank_Cnt  := sum(group,if(basefile.class_rank<>'',1,0));
	major_code_Cnt  := sum(group,if(basefile.major_code<>'',1,0));
	school_info_time_zone_Cnt  := sum(group,if(basefile.school_info_time_zone<>'',1,0));
	filler_6_Cnt  := sum(group,if(basefile.filler_6<>'',1,0));
	filler_7_Cnt  := sum(group,if(basefile.filler_7<>'',1,0));
	home_info_time_zone_Cnt  := sum(group,if(basefile.home_info_time_zone<>'',1,0));
	filler_8_Cnt  := sum(group,if(basefile.filler_8<>'',1,0));
	filler_9_Cnt  := sum(group,if(basefile.filler_9<>'',1,0));
	address_type_Cnt  := sum(group,if(basefile.address_type<>'',1,0));
	address_info_code_Cnt  := sum(group,if(basefile.address_info_code<>'',1,0));
	sequence_number_Cnt  := sum(group,if(basefile.sequence_number<>'',1,0));
	filler_10_Cnt  := sum(group,if(basefile.filler_10<>'',1,0));
	filler_11_Cnt  := sum(group,if(basefile.filler_11<>'',1,0));
	key_code_Cnt  := sum(group,if(basefile.key_code<>'',1,0));
	carriage_return_Cnt  := sum(group,if(basefile.carriage_return<>'',1,0));
	line_feed_Cnt  := sum(group,if(basefile.line_feed<>'',1,0));
	file_type_Cnt  := sum(group,if(basefile.file_type<>'',1,0));
	ln_college_name_Cnt  := sum(group,if(basefile.ln_college_name<>'',1,0));
	tier_Cnt  := sum(group,if(basefile.tier<>'',1,0));
	did_Cnt  := sum(group,if(basefile.did<>0,1,0));
	did_score_Cnt  := sum(group,if(basefile.did_score<>0,1,0));
	clean_title_Cnt  := sum(group,if(basefile.clean_title<>'',1,0));
	clean_fname_Cnt  := sum(group,if(basefile.clean_fname<>'',1,0));
	clean_mname_Cnt  := sum(group,if(basefile.clean_mname<>'',1,0));
	clean_lname_Cnt  := sum(group,if(basefile.clean_lname<>'',1,0));
	clean_name_suffix_Cnt  := sum(group,if(basefile.clean_name_suffix<>'',1,0));
	clean_name_score_Cnt  := sum(group,if(basefile.clean_name_score<>'',1,0));
	clean_addr_code_Cnt  := sum(group,if(basefile.clean_addr_code<>'',1,0));
	rawaid_Cnt  := sum(group,if(basefile.rawaid<>0,1,0));
	append_prep_address_Cnt  := sum(group,if(basefile.append_prep_address<>'',1,0));
	append_prep_address_last_Cnt  := sum(group,if(basefile.append_prep_address_last<>'',1,0));
	clean_phone_number_Cnt  := sum(group,if(basefile.clean_phone_number<>'',1,0));
	clean_prim_range_Cnt  := sum(group,if(basefile.clean_prim_range<>'',1,0));
	clean_predir_Cnt  := sum(group,if(basefile.clean_predir<>'',1,0));
	clean_prim_name_Cnt  := sum(group,if(basefile.clean_prim_name<>'',1,0));
	clean_addr_suffix_Cnt  := sum(group,if(basefile.clean_addr_suffix<>'',1,0));
	clean_postdir_Cnt  := sum(group,if(basefile.clean_postdir<>'',1,0));
	clean_unit_desig_Cnt  := sum(group,if(basefile.clean_unit_desig<>'',1,0));
	clean_sec_range_Cnt  := sum(group,if(basefile.clean_sec_range<>'',1,0));
	clean_p_city_name_Cnt  := sum(group,if(basefile.clean_p_city_name<>'',1,0));
	clean_v_city_name_Cnt  := sum(group,if(basefile.clean_v_city_name<>'',1,0));
	clean_st_Cnt  := sum(group,if(basefile.clean_st<>'',1,0));
	clean_zip5_Cnt  := sum(group,if(basefile.clean_zip5<>'',1,0));
	clean_zip4_Cnt  := sum(group,if(basefile.clean_zip4<>'',1,0));
	clean_cart_Cnt  := sum(group,if(basefile.clean_cart<>'',1,0));
	clean_cr_sort_sz_Cnt  := sum(group,if(basefile.clean_cr_sort_sz<>'',1,0));
	clean_lot_Cnt  := sum(group,if(basefile.clean_lot<>'',1,0));
	clean_lot_order_Cnt  := sum(group,if(basefile.clean_lot_order<>'',1,0));
	clean_dbpc_Cnt  := sum(group,if(basefile.clean_dbpc<>'',1,0));
	clean_chk_digit_Cnt  := sum(group,if(basefile.clean_chk_digit<>'',1,0));
	clean_rec_type_Cnt  := sum(group,if(basefile.clean_rec_type<>'',1,0));
	clean_county_Cnt  := sum(group,if(basefile.clean_county<>'',1,0));
	clean_ace_fips_st_Cnt  := sum(group,if(basefile.clean_ace_fips_st<>'',1,0));
	clean_fips_county_Cnt  := sum(group,if(basefile.clean_fips_county<>'',1,0));
	clean_geo_lat_Cnt  := sum(group,if(basefile.clean_geo_lat<>'',1,0));
	clean_geo_long_Cnt  := sum(group,if(basefile.clean_geo_long<>'',1,0));
	clean_msa_Cnt  := sum(group,if(basefile.clean_msa<>'',1,0));
	clean_geo_blk_Cnt  := sum(group,if(basefile.clean_geo_blk<>'',1,0));
	clean_geo_match_Cnt  := sum(group,if(basefile.clean_geo_match<>'',1,0));
	clean_err_stat_Cnt  := sum(group,if(basefile.clean_err_stat<>'',1,0));
	process_date_Cnt  := sum(group,if(basefile.process_date<>'',1,0));
	date_first_seen_Cnt  := sum(group,if(basefile.date_first_seen<>'',1,0));
	date_last_seen_Cnt  := sum(group,if(basefile.date_last_seen<>'',1,0));
	date_vendor_first_reported_Cnt  := sum(group,if(basefile.date_vendor_first_reported<>'',1,0));
	date_vendor_last_reported_Cnt  := sum(group,if(basefile.date_vendor_last_reported<>'',1,0));
	//Added for new field tier2
	tier2_Cnt  := sum(group,if(basefile.tier2<>'',1,0));

 END;
 
 basestrata:=Sort(Table(basefile,Layout_Strata,clean_st,few),clean_st);
 strata.createXMLStats(basestrata,'Alloy_Student_Directory stats','data',version,'',strataResults);
 
 RETURN strataResults;
END;