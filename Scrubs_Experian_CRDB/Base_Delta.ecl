IMPORT SALT38,STD;
EXPORT Base_Delta(DATASET(Base_Layout_Experian_CRDB)old_s, DATASET(Base_Layout_Experian_CRDB) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['dotid','dotscore','dotweight','empid','empscore','empweight','powid','powscore','powweight','proxid','proxscore','proxweight','seleid','selescore','seleweight','orgid','orgscore','orgweight','ultid','ultscore','ultweight','bdid','bdid_score','did','dt_first_seen','dt_last_seen','dt_vendor_first_reported','dt_vendor_last_reported','experian_bus_id','business_name','address','city','state','zip_code','zip_plus_4','carrier_route','county_code','county_name','phone_number','msa_code','msa_description','establish_date','latest_reported_date','years_in_file','geo_code_latitude','geo_code_latitude_direction','geo_code_longitude','geo_code_longitude_direction','recent_update_code','years_in_business_code','year_business_started','months_in_file','address_type_code','estimated_number_of_employees','employee_size_code','estimated_annual_sales_amount_sign','estimated_annual_sales_amount','annual_sales_size_code','location_code','primary_sic_code_industry_classification','primary_sic_code_4_digit','primary_sic_code','second_sic_code','third_sic_code','fourth_sic_code','fifth_sic_code','sixth_sic_code','primary_naics_code','second_naics_code','third_naics_code','fourth_naics_code','executive_count','executive_last_name','executive_first_name','executive_middle_initial','executive_title','business_type','ownership_code','url','derogatory_indicator','recent_derogatory_filed_date','derogatory_liability_amount_sign','derogatory_liability_amount','ucc_data_indicator','ucc_count','number_of_legal_items','legal_balance_sign','legal_balance_amount','pmtkbankruptcy','pmtkjudgment','pmtktaxlien','pmtkpayment','bankruptcy_filed','number_of_derogatory_legal_items','lien_count','judgment_count','bkc006','bkc007','bkc008','bko009','bkb001_sign','bkb001','bkb003_sign','bkb003','bko010','bko011','jdc010','jdc011','jdc012','jdb004','jdb005','jdb006','jDO013','jDO014','jdb002','jdp016','lgc004','pro001','pro003','txc010','txc011','txb004_sign','txb004','txo013','txb002_sign','txb002','txp016','ucc001','ucc002','ucc003','intelliscore_plus','percentile_model','model_action','score_factor_1','score_factor_2','score_factor_3','score_factor_4','model_code','model_type','last_experian_inquiry_date','recent_high_credit_sign','recent_high_credit','median_credit_amount_sign','median_credit_amount','total_combined_trade_lines_count','dbt_of_combined_trade_totals','combined_trade_balance','aged_trade_lines','experian_credit_rating','quarter_1_average_dbt','quarter_2_average_dbt','quarter_3_average_dbt','quarter_4_average_dbt','quarter_5_average_dbt','combined_dbt','total_account_balance_sign','total_account_balance','combined_account_balance_sign','combined_account_balance','collection_count','atc021','atc022','atc023','atc024','atc025','last_activity_age_code','cottage_indicator','nonprofit_indicator','financial_stability_risk_score','fsr_risk_class','fsr_score_factor_1','fsr_score_factor_2','fsr_score_factor_3','fsr_score_factor_4','ip_score_change_sign','ip_score_change','fsr_score_change_sign','fsr_score_change','dba_name','clean_dba_name','clean_phone','prim_range','predir','prim_name','addr_suffix','postdir','unit_desig','sec_range','p_city_name','v_city_name','st','zip','zip4','cart','cr_sort_sz','lot','lot_order','dbpc','chk_digit','rec_type','fips_state','fips_county','geo_lat','geo_long','msa','geo_blk','geo_match','err_stat','recent_update_desc','years_in_business_desc','address_type_desc','employee_size_desc','annual_sales_size_desc','location_desc','primary_sic_code_industry_class_desc','business_type_desc','ownership_code_desc','ucc_data_indicator_desc','experian_credit_rating_desc','last_activity_age_desc','cottage_indicator_desc','nonprofit_indicator_desc','company_name','p_title','p_fname','p_mname','p_lname','p_name_suffix','raw_aid','ace_aid','prep_addr_line1','prep_addr_line_last','source_rec_id'];
  EXPORT Differences := SALT38.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := Base_hygiene(old_s).Summary('Old') + Base_hygiene(new_s).Summary('New') + Base_hygiene(PROJECT(Differences(deleted), TRANSFORM(Base_Layout_Experian_CRDB, SELF := LEFT.old_rec))).Summary('Deletions') + Base_hygiene(PROJECT(Differences(added), TRANSFORM(Base_Layout_Experian_CRDB, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT38.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT38.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_Experian_CRDB, Base_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
