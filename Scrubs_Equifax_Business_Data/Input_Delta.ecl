IMPORT SALT311,STD;
EXPORT Input_Delta(DATASET(Input_Layout_Equifax_Business_Data)old_s, DATASET(Input_Layout_Equifax_Business_Data) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['AT_CERTEXP1','AT_CERTEXP2','AT_CERTEXP3','AT_CERTEXP4','AT_CERTEXP5','AT_CERTEXP6','AT_CERTEXP7','AT_CERTEXP8','AT_CERTEXP9','AT_CERTEXP10','AT_CERTLEV1','AT_CERTLEV2','AT_CERTLEV3','AT_CERTLEV4','AT_CERTLEV5','AT_CERTLEV6','AT_CERTLEV7','AT_CERTLEV8','AT_CERTLEV9','AT_CERTLEV10','EFX_8a','EFX_8aEXPDT','EFX_ADDRESS','EFX_ANC','EFX_BIZ','EFX_BUSSIZE','EFX_BUSSTATCD','EFX_CALTRANS','EFX_CA_PUC','EFX_CITY','EFX_CMRA','EFX_CMSA','EFX_CORPAMOUNT','EFX_CORPAMOUNTCD','EFX_CORPAMOUNTPREC','EFX_CORPAMOUNTTP','EFX_CORPEMPCD','EFX_CORPEMPCNT','EFX_COUNTYNM','EFX_COUNTY','EFX_CTRYISOCD','EFX_CTRYNAME','EFX_CTRYNUM','EFX_CTRYTELCD','EFX_DATE_CREATED','EFX_DBE','EFX_DEAD','EFX_DEADDT','EFX_DIS','EFX_DVET','EFX_DVSBE','EFX_EDU','EFX_EXTRACT_DATE','EFX_FAXPHONE','EFX_FGOV','EFX_FOREIGN','EFX_GAYLESBIAN','EFX_GEOPREC','EFX_GOV','EFX_GSAX','EFX_HBCU','EFX_HUBZONE','EFX_ID','EFX_LBE','EFX_LEGAL_NAME','EFX_LOCAMOUNT','EFX_LOCAMOUNTCD','EFX_LOCAMOUNTTP','EFX_LOCAMOUNTPREC','EFX_LOCEMPCNT','EFX_LOCEMPCD','EFX_MBE','EFX_MERCHANT_ID','EFX_MERCTYPE','EFX_MI','EFX_MRKT_SEASONAL','EFX_MRKT_TELESCORE','EFX_MRKT_TELEVER','EFX_MRKT_TOTALIND','EFX_MRKT_TOTALSCORE','EFX_MRKT_VACANT','EFX_MWBE','EFX_MWBESTATUS','EFX_NAME','EFX_NMSDC','EFX_NONPROFIT','EFX_PHONE','EFX_PRIMNAICSCODE','EFX_PRIMSIC','EFX_PROJECT_ID','EFX_PUBLIC','EFX_RES','EFX_SBE','EFX_SDB','EFX_SECCTRYISOCD','EFX_SECCTRYNUM','EFX_SECGEOPREC','EFX_SECNAICS1','EFX_SECNAICS2','EFX_SECNAICS3','EFX_SECNAICS4','EFX_SECSIC1','EFX_SECSIC2','EFX_SECSIC3','EFX_SECSIC4','EFX_STATEC','EFX_STKEXC','EFX_SOHO','EFX_TX_HUB','EFX_VET','EFX_VSBE','EFX_WBE','EFX_WBENC','EFX_WSBE','EFX_YREST','Record_Update_Refresh_Date'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := Input_hygiene(old_s).Summary('Old') + Input_hygiene(new_s).Summary('New') + Input_hygiene(PROJECT(Differences(deleted), TRANSFORM(Input_Layout_Equifax_Business_Data, SELF := LEFT.old_rec))).Summary('Deletions') + Input_hygiene(PROJECT(Differences(added), TRANSFORM(Input_Layout_Equifax_Business_Data, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_Equifax_Business_Data, Input_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
