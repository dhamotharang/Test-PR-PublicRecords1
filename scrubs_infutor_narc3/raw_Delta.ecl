IMPORT SALT311,STD;
EXPORT raw_Delta(DATASET(raw_Layout_infutor_narc3)old_s, DATASET(raw_Layout_infutor_narc3) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['orig_hhid','orig_pid','orig_fname','orig_mname','orig_lname','orig_suffix','orig_gender','orig_age','orig_dob','orig_hhnbr','orig_addrid','orig_address','orig_house','orig_predir','orig_street','orig_strtype','orig_postdir','orig_apttype','orig_aptnbr','orig_city','orig_state','orig_zip','orig_z4','orig_dpc','orig_z4type','orig_crte','orig_dpv','orig_vacant','orig_msa','orig_cbsa','orig_dma','orig_county_code','orig_time_zone','orig_daylight_savings','orig_latitude','orig_longitude','orig_telephone_number_1','orig_dma_tps_dnc_flag_1','orig_telephone_number_2','orig_dma_tps_dnc_flag_2','orig_telephone_number_3','orig_dma_tps_dnc_flag_3','orig_length_of_residence','orig_homeowner_renter','orig_year_built','orig_mobile_home_indicator','orig_pool_owner','orig_fireplace_in_home','orig_estimated_income','orig_marital_status','orig_single_parent','orig_senior_in_hh','orig_credit_card_user','orig_wealth_score_estimated_net_worth','orig_donator_to_charity_or_causes','orig_dwelling_type','orig_home_market_value','orig_education','orig_ethnicity','orig_child','orig_child_age_ranges','orig_number_of_children_in_hh','orig_luxury_vehicle_owner','orig_suv_owner','orig_pickup_truck_owner','orig_price_club_and_value_purchasing_indicator','orig_womens_apparel_purchasing_indicator','orig_mens_apparel_purchasing_indcator','orig_parenting_and_childrens_interest_bundle','orig_pet_lovers_or_owners','orig_book_buyers','orig_book_readers','orig_hi_tech_enthusiasts','orig_arts_bundle','orig_collectibles_bundle','orig_hobbies_home_and_garden_bundle','orig_home_improvement','orig_cooking_and_wine','orig_gaming_and_gambling_enthusiast','orig_travel_enthusiasts','orig_physical_fitness','orig_self_improvement','orig_automotive_diy','orig_spectator_sports_interest','orig_outdoors','orig_avid_investors','orig_avid_interest_in_boating','orig_avid_interest_in_motorcycling','orig_percent_range_black','orig_percent_range_white','orig_percent_range_hispanic','orig_percent_range_asian','orig_percent_range_english_speaking','orig_percnt_range_spanish_speaking','orig_percent_range_asian_speaking','orig_percent_range_sfdu','orig_percent_range_mfdu','orig_mhv','orig_mor','orig_car','orig_medschl','orig_penetration_range_white_collar','orig_penetration_range_blue_collar','orig_penetration_range_other_occupation','orig_demolevel'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := raw_hygiene(old_s).Summary('Old') + raw_hygiene(new_s).Summary('New') + raw_hygiene(PROJECT(Differences(deleted), TRANSFORM(raw_Layout_infutor_narc3, SELF := LEFT.old_rec))).Summary('Deletions') + raw_hygiene(PROJECT(Differences(added), TRANSFORM(raw_Layout_infutor_narc3, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(scrubs_infutor_narc3, raw_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
