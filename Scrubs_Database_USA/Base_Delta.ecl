IMPORT SALT311,STD;
EXPORT Base_Delta(DATASET(Base_Layout_Database_USA)old_s, DATASET(Base_Layout_Database_USA) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['dt_first_seen','dt_last_seen','dt_vendor_first_reported','dt_vendor_last_reported','process_date','record_type','accounting_expenses_code','advertising_expenses_code','bus_insurance_expense_code','business_status_code','business_status_desc','city_population_code','city_population_descr','company_name','corporate_employee_code','corporate_employee_desc','county_code','creditcode','credit_desc','credit_capacity_code','credit_capacity_desc','db_cons_age','db_cons_child_near_hs_grad','db_cons_children_present','db_cons_college_graduate','db_cons_credit_card_user','db_cons_date_of_birth_month','db_cons_date_of_birth_year','db_cons_discretincomecode','db_cons_discretincomedesc','db_cons_dnc','db_cons_donor_capacity_code','db_cons_donor_capacity_desc','db_cons_dwelling_type','db_cons_education_hh','db_cons_education_ind','db_cons_email','db_cons_ethnic_code','db_cons_full_name','db_cons_gender','db_cons_home_owner_renter','db_cons_home_property_type','db_cons_home_sqft_ranges','db_cons_home_value_code','db_cons_home_value_desc','db_cons_home_year_built','db_cons_income_code','db_cons_income_desc','db_cons_intend_purchase_veh','db_cons_language_pref','db_cons_length_of_res_code','db_cons_length_of_res_desc','db_cons_marital_status','db_cons_networthhomevalcode','db_cons_net_worth_desc','db_cons_new_parent','db_cons_new_teen_driver','db_cons_newlywed','db_cons_occupation_ind','db_cons_other_pet_owner','db_cons_phone','db_cons_poli_party_ind','db_cons_recent_divorce','db_cons_recent_home_buyer','db_cons_religious_affil','db_cons_scrubbed_phoneable','db_cons_time_zone_code','db_cons_time_zone_desc','db_cons_unsecuredcredcapcode','db_cons_unsecuredcredcapdesc','domestic_foreign_owner_flag','email','email_available_indicator','exec_type','executive_level','executive_title_rank','expense_accounting_desc','expense_advertising_desc','expense_bus_insurance_desc','expense_legal_desc','expense_office_equip_desc','expense_rent_desc','expense_technology_desc','expense_telecom_desc','expense_utilities_desc','female_owned','franchise_flag','franchise_type','full_name','gender','home_based_indicator','import_export','ind_frm_indicator','legal_expenses_code','location_employee_code','location_employee_desc','location_sales_code','location_sales_desc','mail_addr_state','mail_addr_zip','mail_score','manufacturing_location','minority_owned_flag','minority_type','naics01','naics02','naics03','naics04','naics05','naics06','nb_flag','non_profit_org','number_of_pcs_code','number_of_pcs_desc','office_equip_expenses_code','phone','phy_addr_state','phy_addr_zip','primary_exec_flag','primary_sic','primarysic2','primarysic4','public_indicator','rent_expenses_code','sic02','sic03','sic04','sic05','sic06','small_business_indicator','square_footage_code','square_footage_desc','standardized_title','technology_expenses_code','telecom_expenses_code','url','utilities_expenses_code','year_established','years_in_business_range'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := Base_hygiene(old_s).Summary('Old') + Base_hygiene(new_s).Summary('New') + Base_hygiene(PROJECT(Differences(deleted), TRANSFORM(Base_Layout_Database_USA, SELF := LEFT.old_rec))).Summary('Deletions') + Base_hygiene(PROJECT(Differences(added), TRANSFORM(Base_Layout_Database_USA, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_Database_USA, Base_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
