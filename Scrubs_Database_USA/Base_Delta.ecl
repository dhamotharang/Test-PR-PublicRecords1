IMPORT SALT311,STD;
EXPORT Base_Delta(DATASET(Scrubs_Database_USA.Base_Layout_Database_USA)old_s, DATASET(Scrubs_Database_USA.Base_Layout_Database_USA) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['dt_first_seen','dt_last_seen','dt_vendor_first_reported','dt_vendor_last_reported','process_date','record_type','ind_frm_indicator','company_name','full_name','gender','primary_exec_flag','exec_type','phy_addr_state','phy_addr_zip','mail_addr_state','mail_addr_zip','mail_score','phone','email','email_available_indicator','url','business_status_code','franchise_flag','franchise_type','county_code','primary_sic','sic02','sic03','sic04','sic05','sic06','primarysic2','primarysic4','naics01','naics02','naics03','naics04','naics05','naics06','location_employee_code','location_sales_code','corporate_employee_code','year_established','female_owned','minority_owned_flag','home_based_indicator','small_business_indicator','import_export','manufacturing_location','public_indicator','non_profit_org','square_footage_code','creditcode','credit_capacity_code','advertising_expenses_code','technology_expenses_code','office_equip_expenses_code','rent_expenses_code','telecom_expenses_code','accounting_expenses_code','bus_insurance_expense_code','legal_expenses_code','utilities_expenses_code','number_of_pcs_code','nb_flag','domestic_foreign_owner_flag','db_cons_full_name','db_cons_email','db_cons_gender','db_cons_date_of_birth_year','db_cons_date_of_birth_month','db_cons_age','db_cons_ethnic_code','db_cons_religious_affil','db_cons_language_pref','db_cons_time_zone_code','db_cons_phone','db_cons_dnc','db_cons_scrubbed_phoneable','db_cons_children_present','db_cons_home_value_code','db_cons_donor_capacity_code','db_cons_home_owner_renter','db_cons_length_of_res_code','db_cons_dwelling_type','db_cons_recent_home_buyer','db_cons_income_code','db_cons_unsecuredcredcapcode','db_cons_networthhomevalcode','db_cons_discretincomecode','db_cons_marital_status','db_cons_new_parent','db_cons_child_near_hs_grad','db_cons_college_graduate','db_cons_intend_purchase_veh','db_cons_recent_divorce','db_cons_newlywed','db_cons_new_teen_driver','db_cons_home_year_built','db_cons_home_sqft_ranges','db_cons_poli_party_ind','db_cons_occupation_ind','db_cons_credit_card_user','db_cons_home_property_type','db_cons_education_hh','db_cons_education_ind','db_cons_other_pet_owner'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := Base_hygiene(old_s).Summary('Old') + Base_hygiene(new_s).Summary('New') + Base_hygiene(PROJECT(Differences(deleted), TRANSFORM(Scrubs_Database_USA.Base_Layout_Database_USA, SELF := LEFT.old_rec))).Summary('Deletions') + Base_hygiene(PROJECT(Differences(added), TRANSFORM(Scrubs_Database_USA.Base_Layout_Database_USA, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(Scrubs_Database_USA, Base_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
