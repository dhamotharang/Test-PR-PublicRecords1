import Bankrupt,lib_keylib,lib_fileservices,_control;

stat_dis := Bankrupt.File_BK_Search;

//stat_dis := distribute(stat_file,hash(court_code));

stat_rec :=  record
 stat_dis.court_code;
 total := count(group);
 stat_case_number:= count(group,stat_dis.case_number <> '');
 stat_debtor_type:= count(group, stat_dis.debtor_type <> '');
 stat_debtor_seq:= count(group, stat_dis.debtor_seq  <> '');
 stat_orig_ssn:= count(group, stat_dis.orig_ssn  <> '');
 stat_debtor_title:= count(group, stat_dis.debtor_title  <> '');
 stat_debtor_fname:= count(group, stat_dis.debtor_fname  <> '');
 stat_debtor_mname:= count(group, stat_dis.debtor_mname  <> '');
 stat_debtor_lname:= count(group, stat_dis.debtor_lname  <> '');
 stat_debtor_name_suffix:= count(group, stat_dis.debtor_name_suffix  <> '');
 stat_score:= count(group, stat_dis.score  <> '');
 stat_debtor_company:= count(group, stat_dis.debtor_company  <> '');
 stat_prim_range:= count(group, stat_dis.prim_range  <> '');
 stat_predir:= count(group, stat_dis.predir  <> '');
 stat_prim_name:= count(group, stat_dis.prim_name  <> '');
 stat_suffix:= count(group, stat_dis.suffix  <> '');
 stat_postdir:= count(group, stat_dis.postdir  <> '');
 stat_unit_desig:= count(group, stat_dis.unit_desig  <> '');
 stat_sec_range:= count(group, stat_dis.sec_range  <> '');
 stat_p_city_name:= count(group, stat_dis.p_city_name  <> '');
 stat_v_city_name:= count(group, stat_dis.v_city_name  <> '');
 stat_st:= count(group, stat_dis.st  <> '');
 stat_z5:= count(group, stat_dis.z5  <> '');
 stat_zip4:= count(group, stat_dis.zip4  <> '');
 stat_cart:= count(group, stat_dis.cart  <> '');
 stat_cr_sort_sz:= count(group, stat_dis.cr_sort_sz  <> '');
 stat_lot:= count(group, stat_dis.lot  <> '');
 stat_lot_order:= count(group, stat_dis.lot_order  <> '');
 stat_dbpc:= count(group, stat_dis.dbpc  <> '');
 stat_chk_digit:= count(group, stat_dis.chk_digit  <> '');
 stat_rec_type:= count(group, stat_dis.rec_type  <> '');
 stat_county:= count(group, stat_dis.county  <> '');
 stat_geo_lat:= count(group, stat_dis.geo_lat  <> '');
 stat_geo_long:= count(group, stat_dis.geo_long  <> '');
 stat_msa:= count(group, stat_dis.msa  <> '');
 stat_geo_blk:= count(group, stat_dis.geo_blk  <> '');
 stat_geo_match:= count(group, stat_dis.geo_match  <> '');
 stat_err_stat:= count(group, stat_dis.err_stat  <> '');
 stat_debtor_DID:= count(group, stat_dis.debtor_DID  <> '');
 stat_debtor_ssn:= count(group, stat_dis.debtor_ssn  <> '');
 stat_debtor_DID_score:= count(group, stat_dis.debtor_DID_score  <> '');
 stat_bdid:= count(group, stat_dis.bdid  <> '');
 stat_GLB_flag:= count(group, stat_dis.GLB_flag  <> '');
end;

stats := table(stat_dis,stat_rec,stat_dis.court_code,few);

perc_rec := record
string5 stat_court_code := '';
string10 stat_total := '';
string10 stat1_case_number := '';
string10 stat1_debtor_type := '';
string10 stat1_debtor_seq := '';
string10 stat1_orig_ssn := '';
string10 stat1_debtor_title := '';
string10 stat1_debtor_fname := '';
string10 stat1_debtor_mname := '';
string10 stat1_debtor_lname := '';
string10 stat1_debtor_name_suffix := '';
string10 stat1_score := '';
string10 stat1_debtor_company := '';
string10 stat1_prim_range := '';
string10 stat1_predir := '';
string10 stat1_prim_name := '';
string10 stat1_suffix := '';
string10 stat1_postdir := '';
string10 stat1_unit_desig := '';
string10 stat1_sec_range := '';
string10 stat1_p_city_name := '';
string10 stat1_v_city_name := '';
string10 stat1_st := '';
string10 stat1_z5 := '';
string10 stat1_zip4 := '';
string10 stat1_cart := '';
string10 stat1_cr_sort_sz := '';
string10 stat1_lot := '';
string10 stat1_lot_order := '';
string10 stat1_dbpc := '';
string10 stat1_chk_digit := '';
string10 stat1_rec_type := '';
string10 stat1_county := '';
string10 stat1_geo_lat := '';
string10 stat1_geo_long := '';
string10 stat1_msa := '';
string10 stat1_geo_blk := '';
string10 stat1_geo_match := '';
string10 stat1_err_stat := '';
string10 stat1_debtor_DID := '';
string10 stat1_debtor_ssn := '';
string10 stat1_debtor_DID_score := '';
string10 stat1_bdid := '';
string10 stat1_GLB_flag := '';
string2 crlf := '\r\n';
end;

perc_rec GetPerc(stats L) := TRANSFORM
 self.stat_court_code := L.court_code;
 self.stat_total := (string10)L.total;
 self.stat1_case_number := (string10)((decimal5_2)((L.stat_case_number*100)/L.total));
 self.stat1_debtor_type := (string10)((decimal5_2)((L.stat_debtor_type*100)/L.total));
 self.stat1_debtor_seq := (string10)((decimal5_2)((L.stat_debtor_seq*100)/L.total));
 self.stat1_orig_ssn := (string10)((decimal5_2)((L.stat_orig_ssn*100)/L.total));
 self.stat1_debtor_title := (string10)((decimal5_2)((L.stat_debtor_title*100)/L.total));
 self.stat1_debtor_fname := (string10)((decimal5_2)((L.stat_debtor_fname*100)/L.total));
 self.stat1_debtor_mname := (string10)((decimal5_2)((L.stat_debtor_mname*100)/L.total));
 self.stat1_debtor_lname := (string10)((decimal5_2)((L.stat_debtor_lname*100)/L.total));
 self.stat1_debtor_name_suffix := (string10)((decimal5_2)((L.stat_debtor_name_suffix*100)/L.total));
 self.stat1_score := (string10)((decimal5_2)((L.stat_score*100)/L.total));
 self.stat1_debtor_company := (string10)((decimal5_2)((L.stat_debtor_company*100)/L.total));
 self.stat1_prim_range := (string10)((decimal5_2)((L.stat_prim_range*100)/L.total));
 self.stat1_predir := (string10)((decimal5_2)((L.stat_predir*100)/L.total));
 self.stat1_prim_name := (string10)((decimal5_2)((L.stat_prim_name*100)/L.total));
 self.stat1_suffix := (string10)((decimal5_2)((L.stat_suffix*100)/L.total));
 self.stat1_postdir := (string10)((decimal5_2)((L.stat_postdir*100)/L.total));
 self.stat1_unit_desig := (string10)((decimal5_2)((L.stat_unit_desig*100)/L.total));
 self.stat1_sec_range := (string10)((decimal5_2)((L.stat_sec_range*100)/L.total));
 self.stat1_p_city_name := (string10)((decimal5_2)((L.stat_p_city_name*100)/L.total));
 self.stat1_v_city_name := (string10)((decimal5_2)((L.stat_v_city_name*100)/L.total));
 self.stat1_st := (string10)((decimal5_2)((L.stat_st*100)/L.total));
 self.stat1_z5 := (string10)((decimal5_2)((L.stat_z5*100)/L.total));
 self.stat1_zip4 := (string10)((decimal5_2)((L.stat_zip4*100)/L.total));
 self.stat1_cart := (string10)((decimal5_2)((L.stat_cart*100)/L.total));
 self.stat1_cr_sort_sz := (string10)((decimal5_2)((L.stat_cr_sort_sz*100)/L.total));
 self.stat1_lot := (string10)((decimal5_2)((L.stat_lot*100)/L.total));
 self.stat1_lot_order := (string10)((decimal5_2)((L.stat_lot_order*100)/L.total));
 self.stat1_dbpc := (string10)((decimal5_2)((L.stat_dbpc*100)/L.total));
 self.stat1_chk_digit := (string10)((decimal5_2)((L.stat_chk_digit*100)/L.total));
 self.stat1_rec_type := (string10)((decimal5_2)((L.stat_rec_type*100)/L.total));
 self.stat1_county := (string10)((decimal5_2)((L.stat_county*100)/L.total));
 self.stat1_geo_lat := (string10)((decimal5_2)((L.stat_geo_lat*100)/L.total));
 self.stat1_geo_long := (string10)((decimal5_2)((L.stat_geo_long*100)/L.total));
 self.stat1_msa := (string10)((decimal5_2)((L.stat_msa*100)/L.total));
 self.stat1_geo_blk := (string10)((decimal5_2)((L.stat_geo_blk*100)/L.total));
 self.stat1_geo_match := (string10)((decimal5_2)((L.stat_geo_match*100)/L.total));
 self.stat1_err_stat := (string10)((decimal5_2)((L.stat_err_stat*100)/L.total));
 self.stat1_debtor_DID := (string10)((decimal5_2)((L.stat_debtor_DID*100)/L.total));
 self.stat1_debtor_ssn := (string10)((decimal5_2)((L.stat_debtor_ssn*100)/L.total));
 self.stat1_debtor_DID_score := (string10)((decimal5_2)((L.stat_debtor_DID_score*100)/L.total));
 self.stat1_bdid := (string10)((decimal5_2)((L.stat_bdid*100)/L.total));
 self.stat1_GLB_flag := (string10)((decimal5_2)((L.stat_GLB_flag*100)/L.total));
end;

perc_rec_proj := project(stats,GetPerc(LEFT));

stats_sort := sort(perc_rec_proj,stat_court_code);

search_stat_out := output(stats_sort(trim(stat_court_code) <> 'ture:'),,'~thor_data400::out::bk_search_full_stats',overwrite);

search_file_despray := lib_fileservices.fileservices.Despray('~thor_data400::out::bk_search_full_stats',_control.IPAddress.edata12,
 									'/thor_back5/bk_v8/stats/bk_search_stat.d00',,,,TRUE);

export BK_Search_Full_Stats := sequential(search_stat_out,search_file_despray);