IMPORT SALT311,STD;
EXPORT raw_Delta(DATASET(raw_Layout_Fed_Bureau_Prisons)old_s, DATASET(raw_Layout_Fed_Bureau_Prisons) new_s) := MODULE//Routines to compute the differences between two instances of a file
  SHARED inFieldList := ['recordid','sourcename','sourcetype','statecode','recordtype','recorduploaddate','docnumber','fbinumber','stateidnumber','inmatenumber','aliennumber','orig_ssn','nametype','name','lastname','firstname','middlename','suffix','defendantstatus','defendantadditionalinfo','dob','birthcity','birthplace','age','gender','height','weight','haircolor','eyecolor','race','ethnicity','skincolor','bodymarks','physicalbuild','photoname','dlnumber','dlstate','phone','phonetype','uscitizenflag','addresstype','street','unit','city','orig_state','orig_zip','county','institutionname','institutiondetails','institutionreceiptdate','releasetolocation','releasetodetails','deceasedflag','deceaseddate','healthflag','healthdesc','bloodtype','sexoffenderregistrydate','sexoffenderregexpirationdate','sexoffenderregistrynumber','sourceid','caseid','casenumber','casetitle','casetype','casestatus','casestatusdate','casecomments','fileddate','caseinfo','docketnumber','offensecode','offensedesc','offensedate','offensetype','offensedegree','offenseclass','dispositionstatus','dispositionstatusdate','disposition','dispositiondate','offenselocation','finaloffense','finaloffensedate','offensecount','victimunder18','prioroffenseflag','initialplea','initialpleadate','finalruling','finalrulingdate','appealstatus','appealdate','courtname','fineamount','courtfee','restitution','trialtype','courtdate','classification_code','sub_classification_code','state','zip','sourceid2','sentencedate','sentencebegindate','sentenceenddate','sentencetype','sentencemaxyears','sentencemaxmonths','sentencemaxdays','sentenceminyears','sentenceminmonths','sentencemindays','scheduledreleasedate','actualreleasedate','sentencestatus','timeservedyears','timeservedmonths','timeserveddays','publicservicehours','sentenceadditionalinfo','communitysupervisioncounty','communitysupervisionyears','communitysupervisionmonths','communitysupervisiondays','parolebegindate','paroleenddate','paroleeligibilitydate','parolehearingdate','parolemaxyears','parolemaxmonths','parolemaxdays','paroleminyears','paroleminmonths','parolemindays','parolestatus','paroleofficer','paroleoffcerphone','probationbegindate','probationenddate','probationmaxyears','probationmaxmonths','probationmaxdays','probationminyears','probationminmonths','probationmindays','probationstatus'];
  EXPORT Differences := SALT311.mod_Delta.mac_DifferencesByFieldList(old_s, new_s, inFieldList);
  EXPORT DifferenceSummary := raw_hygiene(old_s).Summary('Old') + raw_hygiene(new_s).Summary('New') + raw_hygiene(PROJECT(Differences(deleted), TRANSFORM(raw_Layout_Fed_Bureau_Prisons, SELF := LEFT.old_rec))).Summary('Deletions') + raw_hygiene(PROJECT(Differences(added), TRANSFORM(raw_Layout_Fed_Bureau_Prisons, SELF := LEFT.new_rec))).Summary('Additions');
  EXPORT StandardStats(BOOLEAN doHygieneSummaryGlobal = TRUE) := FUNCTION
    myTimeStamp := (UNSIGNED6)SALT311.Fn_Now('YYYYMMDDHHMMSS') : INDEPENDENT;
    hygieneDiffOverall := DifferenceSummary;
    SALT311.mod_StandardStatsTransforms.mac_hygieneSummaryTransform(scrubs_Fed_Bureau_Prisons, raw_Fields, 'RECORDOF(hygieneDiffOverall)', FALSE);
    hygieneDiffOverall_Standard := IF(doHygieneSummaryGlobal, NORMALIZE(hygieneDiffOverall, COUNT(inFieldList) * 6, xSummary(LEFT, COUNTER, myTimeStamp, LEFT.txt + '_all', LEFT.txt + '_all')));
 
    RETURN hygieneDiffOverall_Standard;
  END;
END;
