/*
One time BWR to expand Vehicle file layout with new PRtcc fields.
*/
IMPORT Data_Services;
EXPORT Pre_Update_Vehicle_PRtcc_DataElements := FUNCTION

 Lay := RECORD,maxlength(20000)
  string vehicle_id;
  string creation_date;
  string incident_id;
  string vin;
  string vin_status;
  string damaged_areas_derived1;
  string damaged_areas_derived2;
  string airbags_deployed_derived;
  string vehicle_towed_derived;
  string unit_type;
  string unit_number;
  string registration_state;
  string registration_year;
  string license_plate;
  string make;
  string model_yr;
  string model;
  string body_type_category;
  string total_occupants_in_vehicle;
  string special_function_in_transport;
  string special_function_in_transport_other_unit;
  string emergency_use;
  string posted_satutory_speed_limit;
  string direction_of_travel_before_crash;
  string trafficway_description;
  string traffic_control_device_type;
  string vehicle_maneuver_action_prior1;
  string vehicle_maneuver_action_prior2;
  string impact_area1;
  string impact_area2;
  string event_sequence1;
  string event_sequence2;
  string event_sequence3;
  string event_sequence4;
  string most_harmful_event_for_vehicle;
  string bus_use;
  string vehicle_hit_and_run;
  string vehicle_towed;
  string contributing_circumstances_v1;
  string contributing_circumstances_v2;
  string contributing_circumstances_v3;
  string contributing_circumstances_v4;
  string on_street;
  string vehicle_color;
  string estimated_speed;
  string car_fire;
  string vehicle_damage_amount;
  string contributing_factors1;
  string contributing_factors2;
  string contributing_factors3;
  string contributing_factors4;
  string other_contributing_factors1;
  string other_contributing_factors2;
  string other_contributing_factors3;
  string vision_obscured1;
  string vision_obscured2;
  string vehicle_on_road;
  string ran_off_road;
  string skidding_occurred;
  string vehicle_incident_location1;
  string vehicle_incident_location2;
  string vehicle_incident_location3;
  string vehicle_disabled;
  string vehicle_removed_to;
  string removed_by;
  string tow_requested_by_driver;
  string solicitation;
  string other_unit_vehicle_damage_amount;
  string other_unit_model_year;
  string other_unit_make;
  string other_unit_model;
  string other_unit_vin;
  string other_unit_vin_status;
  string other_unit_body_type_category;
  string other_unit_registration_state;
  string other_unit_registration_year;
  string other_unit_license_plate;
  string other_unit_color;
  string other_unit_type;
  string damaged_areas1;
  string damaged_areas2;
  string parked_vehicle;
  string damage_rating1;
  string damage_rating2;
  string vehicle_inventoried;
  string vehicle_defect_apparent;
  string defect_may_have_contributed1;
  string defect_may_have_contributed2;
  string registration_expiration;
  string owner_driver_type;
  string make_code;
  string number_trailing_units;
  string vehicle_position;
  string vehicle_type;
  string motorcycle_engine_size;
  string motorcycle_driver_educated;
  string motorcycle_helmet_type;
  string motorcycle_passenger;
  string motorcycle_helmet_stayed_on;
  string motorcycle_helmet_dot_snell;
  string motorcycle_saddlebag_trunk;
  string motorcycle_trailer;
  string pedacycle_passenger;
  string pedacycle_headlights;
  string pedacycle_helmet;
  string pedacycle_rear_reflectors;
  string cdl_required;
  string truck_bus_supplement_required;
  string unit_damage_amount;
  string airbag_switch;
  string underride_override_damage;
  string vehicle_attachment;
  string action_on_impact;
  string speed_detection_method;
  string non_motorist_direction_of_travel_from;
  string non_motorist_direction_of_travel_to;
  string vehicle_use;
  string department_unit_number;
  string equipment_in_use_at_time_of_accident;
  string actions_of_police_vehicle;
  string vehicle_command_id;
  string traffic_control_device_inoperative;
  string direction_of_impact1;
  string direction_of_impact2;
  string ran_off_road_direction;
  string vin_other_unit_number;
  string damaged_area_generic;
  string vision_obscured_description;
  string inattention_description;
  string contributing_circumstances_defect_description;
  string contributing_circumstances_other_descriptioin;
  string vehicle_maneuver_action_prior_other_description;
  string vehicle_special_use;
  string vehicle_type_extended1;
  string vehicle_type_extended2;
  string fixed_object_direction1;
  string fixed_object_direction2;
  string fixed_object_direction3;
  string fixed_object_direction4;
  string vehicle_left_at_scene;
  string vehicle_impounded;
  string vehicle_driven_from_scene;
  string on_cross_street;
  string actions_of_police_vehicle_description;
  string avoidance_maneuver;
  string insurance_expiration_date;
  string insurance_policy_number;
  string insurance_company;
  string avoidance_maneuver2;
  string avoidance_maneuver3;
  string avoidance_maneuver4;
  string damaged_areas_severity1;
  string damaged_areas_severity2;
  string vehicle_outside_city_indicator;
  string vehicle_outside_city_distance_miles;
  string vehicle_outside_city_direction;
  string vehicle_crash_cityplace;
  string insurance_company_standardized;
  string insurance_company_phone_number;
  string insurance_effective_date;
  string proof_of_insurance;
  string insurance_expired;
  string insurance_exempt;
  string insurance_type;
  string insurance_company_code;
  string insurance_policy_holder;
  string is_tag_converted;
  string vin_original;
  string make_original;
  string model_original;
  string model_year_original;
  string other_unit_vin_original;
  string other_unit_make_original;
  string other_unit_model_original;
  string other_unit_model_year_original;
  string initial_point_of_contact;
  string vehicle_driveable;
  string commercial_vehicle;
  string number_of_lanes;
  string divided_highway;
  string not_in_transport;
  string other_unit_number;
  string other_unit_length;
  string other_unit_axles;
  string other_unit_plate_expiration;
  string other_unit_permanent_registration;
  string other_unit_model_year2;
  string other_unit_make2;
  string other_unit_vin2;
  string other_unit_registration_state2;
  string other_unit_registration_year2;
  string other_unit_license_plate2;
  string other_unit_number2;
  string other_unit_length2;
  string other_unit_axles2;
  string other_unit_plate_expiration2;
  string other_unit_permanent_registration2;
  string other_unit_type2;
  string other_unit_model_year3;
  string other_unit_make3;
  string other_unit_vin3;
  string other_unit_registration_state3;
  string other_unit_registration_year3;
  string other_unit_license_plate3;
  string other_unit_number3;
  string other_unit_length3;
  string other_unit_axles3;
  string other_unit_plate_expiration3;
  string other_unit_permanent_registration3;
  string other_unit_type3;
  string damaged_areas3;
  string speed_limit_posted;
  string report_damage_extent;
  string report_vehicle_type;
  string report_traffic_control_device_type;
  string report_contributing_circumstances_v;
  string report_vehicle_maneuver_action_prior;
  string report_vehicle_body_type;
 END;

 ds_vehicle := DATASET(Data_Services.foreign_prod+'thor_data400::in::ecrash::vehicl_raw'
											,Lay
											,csv(terminator('\n'), separator(','),quote('"'),maxlength(60000)))(Vehicle_ID != 'Person_ID');
													 

 FLAccidents_Ecrash.Layout_Infiles.vehicl_NEW ExpandVehicleLayout(ds_vehicle L) := TRANSFORM
																																									SELF.Report_Road_Condition := '';
																																									SELF := L;
																																								 END;
																									 
 upd_vehicle_layout := PROJECT(ds_vehicle, ExpandVehicleLayout(LEFT));
		
 OUTPUT(upd_vehicle_layout,,'~thor_data400::in::ecrash::vehicle_layout_change_prtcc_'+workunit,overwrite,__compressed__,
				csv(terminator('\n'), separator(','),quote('"'),maxlength(60000)));

 do_all :=  SEQUENTIAL(
												FileServices.StartSuperFileTransaction(),
												FileServices.AddSuperFile('~thor_data400::in::ecrash::vehicl_raw','~thor_data400::in::ecrash::vehicle_layout_change_prtcc_'+workunit),
												FileServices.FinishSuperFileTransaction()
										  );
					 
 RETURN do_all;
END;

