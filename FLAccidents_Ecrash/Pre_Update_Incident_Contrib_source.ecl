/*
One time BWR to expand Incident file layout with new field contrib_source.
*/
IMPORT Data_Services;
EXPORT Pre_Update_Incident_Contrib_source := FUNCTION

		Lay := record,maxlength(20000)
		string Incident_ID;
		string Creation_Date;
		string Work_Type_ID;
		string Report_ID;
		string Agency_ID;
		string Sent_to_HPCC_DateTime;
		string Corrected_Incident;
		string CRU_Order_ID;
		string CRU_Sequence_Nbr;
		string Loss_State_Abbr;
		string Report_Type_ID;
		string Hash_Key;
		string Case_Identifier;
		string Crash_County;
		string County_Cd;
		string Crash_CityPlace;
		string Crash_City;
		string City_Code;
		string First_Harmful_Event;
		string First_Harmful_Event_Location;
		string Manner_Crash_Impact1;
		string Weather_Condition1;
		string Weather_Condition2;
		string Light_Condition1;
		string Light_Condition2;
		string Road_Surface_Condition;
		string Contributing_Circumstances_Environmental1;
		string Contributing_Circumstances_Environmental2;
		string Contributing_Circumstances_Environmental3;
		string Contributing_Circumstances_Environmental4;
		string Contributing_Circumstances_Road1;
		string Contributing_Circumstances_Road2;
		string Contributing_Circumstances_Road3;
		string Contributing_Circumstances_Road4;
		string Relation_to_Junction;
		string Intersection_Type;
		string School_Bus_Related;
		string Work_Zone_Related;
		string Work_Zone_Location;
		string Work_Zone_Type;
		string Work_Zone_Workers_Present;
		string Work_Zone_Law_Enforcement_Present;
		string Crash_Severity;
		string Number_of_Vehicles;
		string Total_Nonfatal_Injuries;
		string Total_Fatal_Injuries;
		string Day_of_Week;
		string Roadway_Curvature;
		string Part_of_National_Highway_System;
		string Roadway_Functional_Class;
		string Access_Control;
		string RR_Crossing_ID;
		string Roadway_Lighting;
		string Traffic_Control_Type_at_Intersection1;
		string Traffic_Control_Type_at_Intersection2;
		string NCIC_Number;
		string State_Report_Number;
		string ORI_Number;
		string Crash_Date;
		string Crash_Time;
		string Lattitude;
		string Longitude;
		string Milepost1;
		string Milepost2;
		string Address_Number;
		string Loss_Street;
		string Loss_Street_Route_Number;
		string loss_street_type;
		string Loss_Street_Speed_Limit;
		string Incident_Location_Indicator;
		string Loss_Cross_Street;
		string Loss_Cross_Street_Route_Number;
		string Loss_Cross_Street_Intersecting_Route_Segment;
		string Loss_Cross_Street_Type;
		string Loss_Cross_Street_Speed_Limit;
		string Loss_Cross_Street_Number_of_Lanes;
		string Loss_Cross_Street_Orientation;
		string Loss_Cross_Street_Route_Sign;
		string At_Node_Number;
		string Distance_From_Node_Feet;
		string Distance_From_Node_Miles;
		string Next_Node_Number;
		string Next_Roadway_Node_Number;
		string Direction_of_Travel;
		string Next_Street;
		string Next_Street_Type;
		string Next_Street_Suffix;
		string Before_or_After_Next_Street;
		string Next_Street_Distance_Feet;
		string Next_Street_Distance_Miles;
		string Next_Street_Direction;
		string Next_Street_Route_Segment;
		string Continuing_Toward_Street;
		string Continuing_Street_Suffix;
		string Continuing_Street_Direction;
		string Continuting_Street_Route_Segment;
		string City_Type;
		string Outside_City_Indicator;
		string Outside_City_Direction;
		string Outside_City_Distance_Feet;
		string Outside_City_Distance_Miles;
		string Crash_Type;
		string Motor_Vehicle_Involved_With;
		string Report_Investigation_Type;
		string Incident_Hit_and_Run;
		string Tow_Away;
		string Date_Notified;
		string Time_Notified;
		string Notification_Method;
		string Officer_Arrival_Time;
		string Officer_Report_Date;
		string Officer_Report_Time;
		string Officer_ID;
		string Officer_Department;
		string Officer_Rank;
		string Officer_Command;
		string Officer_Tax_ID_Number;
		string Completed_Report_Date;
		string Supervisor_Check_Date;
		string Supervisor_Check_Time;
		string Supervisor_ID;
		string Supervisor_Rank;
		string Reviewers_Name;
		string Road_Surface;
		string Roadway_Alignment;
		string Traffic_Way_Description;
		string Traffic_Flow;
		string Property_Damage_Involved;
		string Property_Damage_Description1;
		string Property_Damage_Description2;
		string Property_Damage_Estimate1;
		string Property_Damage_Estimate2;
		string Incident_Damage_Over_Limit;
		string Property_Owner_Notified;
		string Government_Property;
		string Accident_Condition;
		string Unusual_Road_Condition1;
		string Unusual_Road_Condition2;
		string Number_of_Lanes;
		string Divided_Highway;
		string Most_Harmful_Event;
		string Second_Harmful_Event;
		string EMS_Notified_Date;
		string EMS_Arrival_Date;
		string Hospital_Arrival_Date;
		string Injured_Taken_By;
		string Injured_Taken_To;
		string Incident_Transported_for_Medical_Care;
		string Photographs_Taken;
		string Photographed_By;
		string Photographer_ID;
		string Photography_Agency_Name;
		string Agency_Name;
		string Judicial_District;
		string Precinct;
		string Beat;
		string Location_Type;
		string Shoulder_Type;
		string Investigation_Complete;
		string Investigation_Not_Complete_Why;
		string Investigating_Officer_Name;
		string Investigation_Notification_Issued;
		string Agency_Type;
		string No_Injury_Tow_Involved;
		string Injury_Tow_Involved;
		string LARS_Code1;
		string LARS_Code2;
		string Private_Property_Incident;
		string Accident_Involvement;
		string Local_Use;
		string Street_Prefix;
		string Street_Suffix;
		string Toll_Road;
		string Street_Description;
		string Cross_Street_Address_Number;
		string Cross_Street_Prefix;
		string Cross_Street_Suffix;
		string Report_Complete;
		string Dispatch_Notified;
		string Counter_Report;
		string Road_Type;
		string Agency_Code;
		string Public_Property_Employee;
		string Bridge_Related;
		string Ramp_Indicator;
		string To_or_From_Location;
		string Complaint_Number;
		string School_Zone_Related;
		string Notify_DOT_Maintenance;
		string Special_Location;
		string Route_Segment;
		string Route_Sign;
		string Route_Category_Street;
		string Route_Category_Cross_Street;
		string Route_Category_Next_Street;
		string Lane_Closed;
		string Lane_Closure_Direction;
		string Lane_Direction;
		string Traffic_Detoured;
		string Time_Closed;
		string Pedestrian_Signals;
		string Work_Zone_Speed_Limit;
		string Work_Zone_Shoulder_Median;
		string Work_Zone_Intermittent_Moving;
		string Work_Zone_Flagger_Control;
		string Special_Work_Zone_Characteristics;
		string Lane_Number;
		string Offset_Distance_Feet;
		string Offset_Distance_MIles;
		string Offset_Direction;
		string ASRU_Code;
		string MP_Grid;
		string Number_of_Qualifying_Units;
		string Number_of_HazMat_Vehicles;
		string Number_of_Buses_Involved;
		string Number_Taken_to_Treatment;
		string Number_Vehicles_Towed;
		string Vehicle_at_Fault_Unit_Number;
		string Time_Officer_Cleared_Scene;
		string Total_Minutes_on_Scene;
		string Motorists_Report;
		string Fatality_Involved;
		string Local_DOT_Index_Number;
		string DOR_Number;
		string Hospital_Code;
		string Special_Jurisdiction;
		string Document_Type;
		string Distance_Was_Measured;
		string Street_Orientation;
		string Intersecting_Route_Segment;
		string Primary_Fault_Indicator;
		string First_Harmful_Event_Pedestrian;
		string Reference_Markers;
		string Other_Officer_on_Scene;
		string Other_Officer_Badge_Number;
		string Supplemental_Report;
		string Supplemental_Type;
		string Amended_Report;
		string Corrected_Report;
		string State_Highway_Related;
		string Roadway_Lighting_Condition;
		string Vendor_Reference_Number;
		string Duplicate_Copy_Unit_Number;
		string Other_City_Agency_Description;
		string Notifcation_Description;
		string Primary_Collision_Improper_Driving_Description;
		string Weather_Other_Description;
		string Crash_Type_Description;
		string Motor_Vehicle_Involved_With_Animal_Description;
		string Motor_Vehicle_Involved_With_Fixed_Object_Description;
		string Motor_Vehicle_Involved_With_Other_Object_Description;
		string Other_Investigation_Time;
		string Milepost_Detail;
		string Utility_Pole_Number1;
		string Utility_Pole_Number2;
		string Utility_Pole_Number3;
		string Utility_Pole_Number4;
		string Incident_Special_Use;
		string Felony_Misdemeanor_Involved;
		string Duplicate_Copy_Required;
		string Highway_District_at_Scene;
		string Distance_Was_Approximated;
		string Avoidance_Maneuver;
		string Investigation_at_Scene;
		string Accident_Investigation_Site;
		string Narrative;
		string Narrative_Continuance;
		string Report_Has_Coversheet;
		string Crash_Time_AM;
		string Crash_Time_PM;
		string Time_Notified_AM;
		string Time_Notified_PM;
		string EMS_Notified_Time;
		string EMS_Arrival_Time;
		string First_Aid_By ; 
		string Person_First_Aid_Party_Type  ; 
		string Person_First_Aid_Party_Type_Description ;
		string Source_ID;

		string traffic_control_condition;
		string intersection_related;	
		string special_study_local;	
		string special_study_state;	
		string off_road_vehicle_involved;	
		string location_type2	;
		string speed_limit_posted;
		string traffic_control_damage_notify_date;
		string traffic_control_damage_notify_time	;
		string traffic_control_damage_notify_name;	
		string public_property_damaged;
		string replacement_report	;
		string deleted_report;
		string next_street_prefix	 ;
		string incident_damage_amount; 
		// silverlight 
		string dot_use;	
		string  number_of_persons_involved;	
		string unusual_road_condition_other_description	;
		string number_of_narrative_sections	;
		string CAD_number	;
		string visibility	;
		string  accident_at_intersection;
		string  accident_not_at_intersection	;
		string  first_harmful_event_within_interchange	;
		string  injury_involved;
		//string Admin_Portal_Visible;
		string Vendor_Code;	
		string Report_Property_Damage;	
		string Report_Collision_Type;	
		string Report_First_Harmful_Event;	
		string Report_Light_Condition;	
		string Report_Weather_Condition;
		string Report_Road_Condition;
		string cru_agency_id;
		string cru_agency_name;
		string Vendor_Report_Id	;
		string is_available_for_public	;
		string has_addendum	;
		string report_agency_ori	;
		string report_status;
		string ReportLinkID;
		String Page_Count;
		string is_delete;
		end;
										 
		ds_incident := DATASET(Data_Services.foreign_prod+'thor_data400::in::ecrash::incidnt_raw_new'
													 ,Lay
													 ,csv(terminator('\n'), separator(','),quote('"'),maxlength(60000)))(Incident_ID != 'Incident_ID');
													 

		FLAccidents_Ecrash.Layout_Infiles.incident_new ExpandIncidentLayout(ds_incident L) := TRANSFORM
		                                                                                        SELF.Contrib_Source := '';
																										                                      	SELF := L;
																								                                        	 END;
																									 
		upd_incident_layout := PROJECT(ds_incident, ExpandIncidentLayout(LEFT));
		
		OUTPUT(upd_incident_layout,,'~thor_data400::in::ecrash::incident_layout_change_contrib_source_'+workunit,overwrite,__compressed__,
					csv(terminator('\n'), separator(','),quote('"'),maxlength(60000)));

		do_all :=  SEQUENTIAL(
														FileServices.StartSuperFileTransaction(),
														FileServices.AddSuperFile('~thor_data400::in::ecrash::incidnt_raw_new','~thor_data400::in::ecrash::incident_layout_change_contrib_source_'+workunit),
														FileServices.FinishSuperFileTransaction()
												 );
					 
		RETURN do_all;
END;

