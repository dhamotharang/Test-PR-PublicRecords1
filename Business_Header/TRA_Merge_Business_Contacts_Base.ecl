IMPORT ut;

EXPORT Layout_Business_Contact_Full TRA_Merge_Business_Contacts_Base(Layout_Business_Contact_Full L, Layout_Business_Contact_Full R) := TRANSFORM
SELF.source := IF(L.source = '', R.source, L.source);
SELF.dt_first_seen := 
            ut.EarliestDate(ut.EarliestDate(L.dt_first_seen,R.dt_first_seen),
		    ut.EarliestDate(L.dt_last_seen,R.dt_last_seen));
SELF.dt_last_seen := max(L.dt_last_seen,R.dt_last_seen);
SELF.vendor_id := IF(L.vendor_id = '', R.vendor_id, L.vendor_id);
SELF.title := IF(L.title = '', R.title, L.title);
SELF.fname := IF(L.fname = '', R.fname, L.fname);
SELF.mname := IF(L.mname = '', R.mname, L.mname);
SELF.lname := IF(L.lname = '', R.lname, L.lname);
SELF.name_suffix := IF(L.name_suffix = '', R.name_suffix, L.name_suffix);
SELF.name_score := IF(L.name_score = '', R.name_score, L.name_score);
SELF.phone := IF(L.phone = 0, R.phone, L.phone);
SELF.email_address := IF(L.email_address = '', R.email_address, L.email_address);
SELF.ssn := IF(L.ssn = 0, R.ssn, L.ssn);
SELF.prim_range := IF(l.prim_range = '' AND l.zip4 = 0, r.prim_range, l.prim_range);
SELF.predir := IF(l.predir = '' AND l.zip4 = 0, r.predir, l.predir);
SELF.prim_name := IF(l.prim_name = '' AND l.zip4 = 0, r.prim_name, l.prim_name);
SELF.addr_suffix := IF(l.addr_suffix = '' AND l.zip4 = 0, r.addr_suffix, l.addr_suffix);
SELF.postdir := IF(l.postdir = '' AND l.zip4 = 0, r.postdir, l.postdir);
SELF.unit_desig := IF(l.unit_desig = ''AND l.zip4 = 0, r.unit_desig, l.unit_desig);
SELF.sec_range := IF(l.sec_range = '' AND l .zip4 = 0, r.sec_range, l.sec_range);
SELF.city := IF(l.city = '' AND l.zip4 = 0, r.city, l.city);
SELF.state := IF(l.state = '' AND l.zip4 = 0, r.state, l.state);
SELF.zip := IF(l.zip = 0 AND l.zip4 = 0, r.zip, l.zip);
SELF.zip4 := IF(l.zip4 = 0, r.zip4, l.zip4);
SELF.county := IF(l.county = '' AND l.zip4 = 0, r.county, l.county);
SELF.msa := IF(l.msa = '' AND l.zip4 = 0, r.msa, l.msa);
SELF.geo_lat := IF(l.geo_lat = '' AND l.zip4 = 0, r.geo_lat, l.geo_lat);
SELF.geo_long := IF(l.geo_long = '' AND l.zip4 = 0, r.geo_long, l.geo_long);
SELF.record_type := IF(L.record_type = 'C', L.record_type, R.record_type);
SELF.company_title := IF(L.company_title = '', R.company_title, L.company_title);   
SELF.company_department := IF(L.company_department = '', R.company_department, L.company_department);
SELF.company_name := IF(L.company_name = '', R.company_name, L.company_name);
SELF.company_source_group := IF(L.company_source_group = '', R.company_source_group, L.company_source_group);
SELF.company_prim_range := IF(l.company_prim_range = '' AND l.company_zip4 = 0, r.company_prim_range, l.company_prim_range);
SELF.company_predir := IF(l.company_predir = '' AND l.company_zip4 = 0, r.company_predir, l.company_predir);
SELF.company_prim_name := IF(l.company_prim_name = '' AND l.company_zip4 = 0, r.company_prim_name, l.company_prim_name);
SELF.company_addr_suffix := IF(l.company_addr_suffix = '' AND l.company_zip4 = 0, r.company_addr_suffix, l.company_addr_suffix);
SELF.company_postdir := IF(l.company_postdir = '' AND l.company_zip4 = 0, r.company_postdir, l.company_postdir);
SELF.company_unit_desig := IF(l.company_unit_desig = ''AND l.company_zip4 = 0, r.company_unit_desig, l.company_unit_desig);
SELF.company_sec_range := IF(l.company_sec_range = '' AND l .company_zip4 = 0, r.company_sec_range, l.company_sec_range);
SELF.company_city := IF(l.company_city = '' AND l.company_zip4 = 0, r.company_city, l.company_city);
SELF.company_state := IF(l.company_state = '' AND l.company_zip4 = 0, r.company_state, l.company_state);
SELF.company_zip := IF(l.company_zip = 0 AND l.company_zip4 = 0, r.company_zip, l.company_zip);
SELF.company_zip4 := IF(l.company_zip4 = 0, r.company_zip4, l.company_zip4);
SELF.company_phone := IF(L.company_phone = 0, R.company_phone, L.company_phone);
SELF.company_fein := IF(L.company_fein = 0, R.company_fein, L.company_fein);
SELF := L;
END;