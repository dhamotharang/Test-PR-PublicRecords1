import iesp,BairRx_Intel,BairRx_Common,ut;

EXPORT ESPOut := MODULE

	EXPORT iesp.bair_intel.t_BAIRIntelSearchRecord SearchView(BairRx_Intel.Layouts.SearchPayload L) := TRANSFORM
		SELF.EntityID := L.eid,
		SELF.Class := L.incident_type,
		SELF.IncidentID := (STRING) L.incident_id,
		SELF.IncidentType := L.incident_type,
		SELF.Date := L.incident_date,
		SELF.IncidentTime := (STRING) L.incident_time,
		SELF.CaseNumber := L.case_number,
		SELF.CallCaseNumber := L.call_case_number,
		SELF.Address := L.incident_address,
		SELF.City := L.incident_city,
		SELF.State := L.incident_state,
		SELF.Zip := L.incident_zip,
		SELF.AddressName := L.address_name,		
		SELF.LocationType := L.location_type,
		SELF.XCoordinate := (STRING) L.X,
		SELF.YCoordinate := (STRING) L.Y,
		SELF.SourceReliability := L.source_relaiability,
		SELF.ContentValidity := L.incident_content_validity,
		SELF.SourceScore := (STRING) L.incident_source_score,
		SELF.EntryDate := L.incident_entry_date,
		SELF.PurgeDate := L.incident_purge_date,
		SELF.OfficersFirstName :=  L.reporting_officer_first_name, 
		SELF.OfficersLastName := L.reporting_officer_last_name,
		SELF.IntelEntityID := (STRING)L.id,
		SELF.FirstName := L.first_name,
		SELF.MiddleName := L.middle_name,
		SELF.LastName := L.last_name,
		SELF.Moniker := L.moniker,
		SELF.DOB := L.dob,
		SELF.SSN := L.ssn,
		SELF.Sex := L.sex,
		SELF.Race := L.race,
		SELF.Ethnicity := L.ethnicity,
		SELF.CountryOfOrigin := L.country_of_origin,
		SELF.Height := L.height,
		SELF.Weight := L.weight,
		SELF.EyeColor := L.eye_color,
		SELF.HairColor := L.hair_color,
		SELF.HairStyle := L.hair_style,
		SELF.FacialHair := L.facial_hair,
		SELF.TattooText1 := L.tattoo_text_1,
		SELF.TattooText2 := L.tattoo_text_2,
		SELF.TattooLocation1 := L.tattoo_location_1,
		SELF.TattooLocation2 := L.tattoo_location_2,
		SELF.Occupation := L.occupation,
		SELF.PlaceOfEmployment := L.place_of_employment,
		SELF.EntityAddress := L.entity_address,
		SELF.EntityCity := L.entity_city,
		SELF.EntityState := L.entity_state,
		SELF.EntityZip := L.entity_zip,
		SELF.PersonX := (STRING) L.person_x,
		SELF.PersonY := (STRING) L.person_y,
		SELF.PhoneNumber := L.phone_number,
		SELF.PhoneType := L.phone_type,
		SELF.EmailAddress := L.email_address,
		SELF.SocialMediaType1 := L.social_media_type_1,
		SELF.SocialMediaType2 := L.social_media_type_2,
		SELF.SocialMediaType3 := L.social_media_type_3,
		SELF.SocialMediaType4 := L.social_media_type_4,
		SELF.UserNameSite1 := L.user_name_site_1,
		SELF.UserNameSite2 := L.user_name_site_2,
		SELF.UserNameSite3 := L.user_name_site_3,
		SELF.UserNameSite4 := L.user_name_site_4,
		SELF.OrganizationType := L.organization_type,
		SELF.OrganizationSubType := L.organization_sub_type,
		SELF.OrganizationName := L.organization_name,
		SELF.NumberOfMembers := L.number_of_members,
		SELF.OrganizationRankRole := L.organization_rank_role,
		SELF.SourceType := L.entity_source_type,
		SELF.EntitySourceReliability := L.source_reliability,
		SELF.EntityContentValidity := L.entity_content_validity,
		SELF.EntitySourceScore := (STRING) L.entity_source_score,
		SELF.EntityEntryDate := L.entity_entry_date,
		SELF.EntityPurgeDate := L.entity_purge_date,
		SELF.VehicleYear := L.vehicle_year,  //ut.Max2(L.vehicle_year,0),// need to update after iesp datatype is changed to string
		SELF.VehicleType := L.vehicle_type,
		SELF.VehiclePlate := L.vehicle_plate,
		SELF.VehiclePlateState := L.vehicle_plate_state,
		SELF.VehicleMake := L.vehicle_make,
		SELF.VehicleModel := L.vehicle_model,
		SELF.VehicleColor := L.vehicle_color,
		SELF.ORI := (STRING) L.data_provider_id,
		SELF.UpdateDate := L.update_date,
		SELF.ComputedPurgeDate := L.purgedate_computed,
		SELF.DurationSince := L.duration_since,
		SELF.VehicleSecondaryColor := L.vehicle_color_secondary,
		SELF.VehicleVin := L.vehicle_vin
		// SELF := []
	END;

	SHARED iesp.bair_intel.t_BAIRIntelIncidentRecord xtIncident(BairRx_Intel.Layouts.PayloadIncident L) := TRANSFORM
		//SELF.EntityID := L.eid,
		SELF.Class := L.incident_type,
		SELF.IncidentID := (string) L.incident_id,
		SELF.IncidentType := L.incident_type,
		SELF.Date := L.incident_date,
		SELF.IncidentTime := (string) L.incident_time,
		SELF.CaseNumber := L.case_number,
		SELF.CallCaseNumber := L.call_case_number,
		SELF.Address := L.incident_address,
		SELF.City := L.incident_city,
		SELF.State := L.incident_state,
		SELF.Zip := L.incident_zip,
		SELF.AddressName := L.address_name,
		SELF.LocationType := L.location_type,
		SELF.XCoordinate := (STRING) L.X,
		SELF.YCoordinate := (STRING) L.Y,
		SELF.SourceReliability := L.source_relaiability,
		SELF.ContentValidity := L.incident_content_validity,
		SELF.SourceScore := (string) L.incident_source_score,
		SELF.EntryDate := L.incident_entry_date,
		SELF.PurgeDate := L.incident_purge_date,
		SELF.OfficersFirstName := L.reporting_officer_first_name,
		SELF.OfficersLastName := L.reporting_officer_last_name,
		SELF.ORI := (STRING) L.data_provider_id,
		SELF.UpdateDate := L.update_date,
		SELF.ComputedPurgeDate := L.purgedate_computed,
		SELF.DurationSince := L.duration_since
	END;
	
	SHARED iesp.bair_intel.t_BAIRIntelEntityRecord xtEntity(BairRx_Intel.Layouts.PayloadEntity L) := TRANSFORM
		SELF.IntelEntityID := (string) L.id,
		SELF.LexID := '',
		SELF.FirstName := L.first_name,
		SELF.MiddleName := L.middle_name,
		SELF.LastName := L.last_name,
		SELF.Moniker := L.moniker,
		SELF.DOB := L.dob,
		SELF.SSN := L.ssn,
		SELF.Sex := L.sex,
		SELF.Race := L.race,
		SELF.Ethnicity := L.ethnicity,
		SELF.CountryOfOrigin := L.country_of_origin,
		SELF.Height := L.height,
		SELF.Weight := L.weight,
		SELF.EyeColor := L.eye_color,
		SELF.HairColor := L.hair_color,
		SELF.HairStyle := L.hair_style,
		SELF.FacialHair := L.facial_hair,
		SELF.TattooText1 := L.tattoo_text_1,
		SELF.TattooText2 := L.tattoo_text_2,
		SELF.TattooLocation1 := L.tattoo_location_1,
		SELF.TattooLocation2 := L.tattoo_location_2,
		SELF.Occupation := L.occupation,
		SELF.PlaceOfEmployment := L.place_of_employment,
		SELF.EntityAddress := L.entity_address,
		SELF.EntityCity := L.entity_city,
		SELF.EntityState := L.entity_state,
		SELF.EntityZip := L.entity_zip,
		SELF.PersonX := (STRING) L.person_x,
		SELF.PersonY := (STRING) L.person_y,
		SELF.PhoneNumber := L.phone_number,
		SELF.PhoneType := L.phone_type,
		SELF.EmailAddress := L.email_address,
		SELF.SocialMediaType1 := L.social_media_type_1,
		SELF.SocialMediaType2 := L.social_media_type_2,
		SELF.SocialMediaType3 := L.social_media_type_3,
		SELF.SocialMediaType4 := L.social_media_type_4,
		SELF.UserNameSite1 := L.user_name_site_1,
		SELF.UserNameSite2 := L.user_name_site_2,
		SELF.UserNameSite3 := L.user_name_site_3,
		SELF.UserNameSite4 := L.user_name_site_4,
		SELF.OrganizationType := L.organization_type,
		SELF.OrganizationSubType := L.organization_sub_type,
		SELF.OrganizationName := L.organization_name,
		SELF.NumberOfMembers := L.number_of_members,
		SELF.OrganizationRankRole := L.organization_rank_role,
		SELF.SourceType := L.entity_source_type,
		SELF.EntitySourceReliability := L.source_reliability,
		SELF.EntityContentValidity := L.entity_content_validity,
		SELF.EntitySourceScore := (STRING) L.entity_source_score,
		SELF.EntityEntryDate := L.entity_entry_date,
		SELF.EntityPurgeDate := L.entity_purge_date,
		SELF.ORI := (STRING) L.data_provider_id,
		SELF.VehicleType := L.vehicle_type,
		SELF.VehicleMake := L.vehicle_make,
		SELF.VehicleModel := L.vehicle_model,
		SELF.VehicleColor := L.vehicle_color,
		SELF.VehicleYear := MAX(L.vehicle_year,0),// need to update after iesp datatype is changed to string
		SELF.VehiclePlate := L.vehicle_plate,
		SELF.VehiclePlateState := L.vehicle_plate_state,
		SELF.VehicleSecondaryColor := L.vehicle_color_secondary,
		SELF.VehicleVin := L.vehicle_vin
	END;
	

	
	iesp.bair_share.t_BAIRNote xtReportNotes(BairRx_Common.Layouts.PayloadNotes L) := TRANSFORM
		SELF.NoteType := BairRx_Common.Constants.NoteTypeLabel(L.note_type),
		SELF.NoteText := L.notes;
	END;

	EXPORT iesp.bair_intel.t_BAIRIntelReportRecord ReportView(BairRx_Intel.Layouts.ReportPayload L) := TRANSFORM
		incident := L.Incidents[1];
		SELF.EntityID := L.eid,
		SELF.Class := incident.incident_type,
		SELF.IncidentType := incident.incident_type,
		SELF.CaseNumber := incident.case_number,
		SELF.Date := incident.incident_date,
		SELF.IncidentTime := (STRING) incident.incident_time,
		SELF.Address := incident.incident_address,
		SELF.ORI := (STRING) L.data_provider_id,
		SELF.Incidents := PROJECT(L.Incidents, xtIncident(LEFT)),
		SELF.Entities := PROJECT(L.Entities, xtEntity(LEFT));
		SELF.Notes := PROJECT(L.Notes, xtReportNotes(LEFT));
		SELF.AddressClean:= [];
		END;
		
END;
