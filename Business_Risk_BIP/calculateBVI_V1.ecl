IMPORT Business_Risk, Business_Risk_BIP, Risk_Indicators, RiskWise, UT;

EXPORT calculateBVI_V1 (STRING2 BNAT_Indicator, 
												STRING2 BNAP_Indicator, 
												STRING2 BNAS_Indicator, 
												BOOLEAN MultiSrcAddr, 
												BOOLEAN MultiSrcAddrCurr, 
												BOOLEAN MultiSrcCmpy, 
												BOOLEAN MultiSrcCmpyCurr, 
												BOOLEAN WatchlistHit, 
												STRING1 DeceasedFEIN_As_SSN) := FUNCTION

	TempBVI := CASE((INTEGER)BNAP_Indicator,
										0 => CASE((INTEGER)BNAT_Indicator,
															0 => '00',
															1 => '10',
															2 => '00',
															3 => '00',
															4 => '20',
															5 => '30',
															6 => '30',
															7 => IF(MultiSrcAddr AND MultiSrcCmpy, '50', '40'),
															8 => '50',
																	 '00'),
										1 => CASE((INTEGER)BNAT_Indicator, 
															0 => '00',
															1 => '10',
															2 => '00',
															3 => '00',
															4 => '20',
															5 => '30',
															6 => '30',
															7 => IF(MultiSrcAddr AND MultiSrcCmpy, '50', '40'),
															8 => '50',
																	 '00'),
										2 => CASE((INTEGER)BNAT_Indicator, 
															0 => '00',
															1 => '10',
															2 => '00',
															3 => '00',
															4 => '20',
															5 => '30',
															6 => '30',
															7 => IF(MultiSrcAddr AND MultiSrcCmpy, '50', '40'),
															8 => '50',
																	 '00'),
										3 => CASE((INTEGER)BNAT_Indicator, 
															0 => '10',
															1 => '10',
															2 => '00',
															3 => '00',
															4 => '20',
															5 => '30',
															6 => '30',
															7 => IF(MultiSrcAddr AND MultiSrcCmpy, '50', '40'),
															8 => '50',
																	 '00'),
										4 => CASE((INTEGER)BNAT_Indicator, 
															0 => '20',
															1 => '20',
															2 => '20',
															3 => '20',
															4 => '20',
															5 => '40',
															6 => '40',
															7 => IF(MultiSrcAddr AND MultiSrcCmpy, '50', '40'),
															8 => '50',
																	 '00'),
										5 => CASE((INTEGER)BNAT_Indicator, 
															0 => '30',
															1 => '20',
															2 => '30',
															3 => '30',
															4 => '30',
															5 => '30',
															6 => '40',
															7 => IF(MultiSrcAddr AND MultiSrcCmpy, '50', '40'),
															8 => '50',
																	 '00'),
										6 => INTFORMAT(UT.Min2(((INTEGER)CASE((INTEGER)BNAT_Indicator, 
															0 => '40',
															1 => '30',
															2 => '40',
															3 => '40',
															4 => '40',
															5 => '40',
															6 => '40',
															7 => '50',
															8 => '50',
																	 '00')) + 
																	 IF(MultiSrcAddrCurr AND MultiSrcCmpyCurr, 10, 0), 50), 2, 1), // If we have multiple current sources confirming address and company name, give it a 10 point boost (Not to exceed '50')
										7 => INTFORMAT(UT.Min2(((INTEGER)CASE((INTEGER)BNAT_Indicator, 
															0 => '40',
															1 => '30',
															2 => '40',
															3 => '40',
															4 => '40',
															5 => '40',
															6 => '40',
															7 => '50',
															8 => '50',
																	 '00')) + 
																	 IF(MultiSrcAddrCurr AND MultiSrcCmpyCurr, 10, 0), 50), 2, 1), // If we have multiple current sources confirming address and company name, give it a 10 point boost (Not to exceed '50')
										8 => INTFORMAT(UT.Min2(((INTEGER)CASE((INTEGER)BNAT_Indicator, 
															0 => '40',
															1 => '30',
															2 => '40',
															3 => '40',
															4 => '40',
															5 => '50',
															6 => '40',
															7 => '50',
															8 => '50',
																	 '00')) + 
																	 IF(MultiSrcAddrCurr AND MultiSrcCmpyCurr, 10, 0), 50), 2, 1), // If we have multiple current sources confirming address and company name, give it a 10 point boost (Not to exceed '50')
												'00');					

	TempBVIwBNAS := CASE((INTEGER)TempBVI,
													0 => CASE((INTEGER)BNAS_Indicator,
																		1 => '20',
																		2 => '20',
																		3 => '30',
																				 TempBVI),
													10 => CASE((INTEGER)BNAS_Indicator,
																		1 => '20',
																		2 => '20',
																		3 => '30',
																				 TempBVI),
													20 => CASE((INTEGER)BNAS_Indicator,
																		1 => '30',
																		2 => '30',
																		3 => '40',
																				 TempBVI),
																TempBVI);
	BVIIndicator := MAP(WatchlistHit 											=> '10',
									(INTEGER)BNAS_Indicator = 0 OR 
											TempBVI IN ['30', '40', '50'] OR
											DeceasedFEIN_As_SSN = 'Y'					=> TempBVI,
																													 TempBVIwBNAS);
																														 
	RETURN(BVIIndicator);
END;