Import iesp,AutoStandardI;
EXPORT Transforms_HCP := Module
	Shared iesp.healthcare_prvaccurint.t_HealthCareAccurintHCPSearchOption getOptions(Healthcare_Header_Services.Layouts.common_runtime_config cfg) := transform
		gm := AutoStandardI.GlobalModule();
		self.ThresholdLimit := cfg.penalty_threshold;
		self.ReturnCount := Healthcare_Header_Services.Constants.MAX_SEARCH_RESULTS;
		self.StartingRecord := if(cfg.isBatchService,0,1);
		self.MaxResults := cfg.MaxResults;
		self.PenaltyThreshold := cfg.penalty_threshold;
		self.TransactionId := gm.TransactionId;
		self.DataRestrictionMask := if(gm.DataRestrictionMask<>'',gm.DataRestrictionMask,cfg.DRM);
		self.DataPermissionMask := if(gm.DataPermissionMask<>'',gm.DataPermissionMask,cfg.DPM);
		self.CompanyId := (string)gm.GlobalCompanyId;
		self.GLBPurpose := (string)gm.GLBPurpose;
		self.DLPurpose := (string)gm.DPPAPurpose;
		self.isbatchservice := cfg.isbatchservice;
		self.IncludeSanctions := cfg.IncludeSanctions;
		self.IncludeGroupAffiliations := cfg.IncludeGroupAffiliations;
		self.IncludeHospitalAffiliations := cfg.IncludeHospitalAffiliations;
		self.IncludeSpecialties := cfg.IncludeSpecialties;
		self.IncludeLicenses := cfg.IncludeLicenses;
		self.IncludeNPI := True;
		self.IncludeDEA := True;
		self.IncludeTaxonomy := True;
		self.IncludeFein := cfg.IncludeFein;
		self.DOBMask := gm.dobmask;
		self.IncludeProvidersOnly := cfg.IncludeProvidersOnly;
		self.IncludeSanctionsOnly := cfg.IncludeSanctionsOnly;
		self.IncludeBoardCertifiedSpecialty := cfg.IncludeABMSBoardCertifiedSpecialty;
		self.IncludeABMSCareer := cfg.IncludeABMSCareer;
		self.IncludeABMSEducation := cfg.IncludeABMSEducation;
		self.IncludeABMSTypeOfPractice := cfg.IncludeABMSBoardCertifiedSpecialty;
		self.IncludeABMSProfessionalAssociations := cfg.IncludeABMSProfessionalAssociations;
		self:=[];
	end;
	Shared iesp.healthcare_prvaccurint.t_HealthCareAccurintHCPSearchBy getSearchBy(Healthcare_Header_Services.Layouts.autokeyInput input) := transform
		self.MedicalSchoolName := input.MedicalSchoolNameVerification;
		self.GraduationYear := input.GraduationYearVerification;
		self.BoardCertifiedSpecialty1 := input.BoardCertifiedSpecialtyVerification;
		self.BoardCertifiedSubSpecialty1 := input.BoardCertifiedSubSpecialtyVerification;
		self.BoardCertifiedSpecialty2 := input.BoardCertifiedSpecialty2Verification;
		self.BoardCertifiedSubSpecialty2 := input.BoardCertifiedSubSpecialty2Verification;
		self.BoardCertifiedSpecialty3 := input.BoardCertifiedSpecialty3Verification;
		self.BoardCertifiedSubSpecialty3 := input.BoardCertifiedSubSpecialty3Verification;
		self.BoardCertifiedSpecialty4 := input.BoardCertifiedSpecialty4Verification;
		self.BoardCertifiedSubSpecialty4 := input.BoardCertifiedSubSpecialty4Verification;
		self.BoardCertifiedSpecialty5 := input.BoardCertifiedSpecialty5Verification;
		self.BoardCertifiedSubSpecialty5 := input.BoardCertifiedSubSpecialty5Verification;
		self.LicenseNumber := if(input.license_number<>'',input.license_number,input.StateLicense1Verification);
		self.LicenseState := if(input.license_state<>'',input.license_state,input.StateLicense1StateVerification);
		self.LicenseNumber2 := input.StateLicense2Verification;
		self.LicenseState2 := input.StateLicense2StateVerification;
		self.LicenseNumber3 := input.StateLicense3Verification;
		self.LicenseState3 := input.StateLicense3StateVerification;
		self.LicenseNumber4 := input.StateLicense4Verification;
		self.LicenseState4 := input.StateLicense4StateVerification;
		self.LicenseNumber5 := input.StateLicense5Verification;
		self.LicenseState5 := input.StateLicense5StateVerification;
		self.LicenseNumber6 := input.StateLicense6Verification;
		self.LicenseState6 := input.StateLicense6StateVerification;
		self.LicenseNumber7 := input.StateLicense7Verification;
		self.LicenseState7 := input.StateLicense7StateVerification;
		self.LicenseNumber8 := input.StateLicense8Verification;
		self.LicenseState8 := input.StateLicense8StateVerification;
		self.LicenseNumber9 := input.StateLicense9Verification;
		self.LicenseState9 := input.StateLicense9StateVerification;
		self.LicenseNumber10 := input.StateLicense10Verification;
		self.LicenseState10 := input.StateLicense10StateVerification;
		self.Phone10 := if(input.homephone<>'',input.homephone,input.workphone);
		self.NPINumber := input.NPI;
		self.DEANumber := input.DEA;
		self.DEANumber2 := input.DEA2;
		self.Taxonomy := input.Taxonomy1Verification;
		self.Taxonomy2 := input.Taxonomy2Verification;
		self.Taxonomy3 := input.Taxonomy3Verification;
		self.Taxonomy4 := input.Taxonomy4Verification;
		self.Taxonomy5 := input.Taxonomy5Verification;
		self.providerid := (String)input.providerid;
		self.did := (String)input.did;
		self:=input;
		self:=[];
	end;
	Export iesp.healthcare_prvaccurint.t_HealthCareAccurintHCPSearchRequestEx toSoapInput(dataset(Healthcare_Header_Services.Layouts.autokeyInput) input, dataset(Healthcare_Header_Services.Layouts.common_runtime_config) cfg) := function
		Options := project(cfg,getOptions(left))[1]; 
		SearchBy := Project(input,getSearchBy(left))[1];
		iesp.healthcare_prvaccurint.t_HealthCareAccurintHCPSearchRequestEx buildInput():=transform
			self.criteria.User.GLBPurpose := (string)cfg[1].glb;
			self.criteria.User.DLPurpose := (string)cfg[1].dppa;
			self.criteria.User.SSNMask := cfg[1].SSNMask;
			self.criteria.User.DOBMask := cfg[1].DOBMask;
			self.criteria.User.DataRestrictionMask := cfg[1].DRM;
			self.criteria.User.DataPermissionMask := cfg[1].DPM;
			self.criteria.Options := Options;
			self.criteria.SearchBy := SearchBy;
			self:=[];
		end;
		return dataset([buildInput()]);
	end;
	Export iesp.healthcare_prvaccurint.t_HealthCareAccurintHCPBatchRequestEx toSoapBatchInput(dataset(Healthcare_Header_Services.Layouts.autokeyInput) input, dataset(Healthcare_Header_Services.Layouts.common_runtime_config) cfg) := function
		Options := project(cfg,getOptions(left))[1]; 
		SearchBy := Project(input,getSearchBy(left));
		iesp.healthcare_prvaccurint.t_HealthCareAccurintHCPBatchRequestEx buildInput():=transform
			self.criteria.User.GLBPurpose := (string)cfg[1].glb;
			self.criteria.User.DLPurpose := (string)cfg[1].dppa;
			self.criteria.User.SSNMask := cfg[1].SSNMask;
			self.criteria.User.DOBMask := cfg[1].DOBMask;
			self.criteria.User.DataRestrictionMask := cfg[1].DRM;
			self.criteria.User.DataPermissionMask := cfg[1].DPM;
			self.criteria.Options := Options;
			self.criteria.SearchBy := SearchBy;
			self:=[];
		end;
		return dataset([buildInput()]);
	end;
	Shared Healthcare_Header_Services.Layouts.CombinedHeaderResults setInternalLayout(iesp.healthcare_prvaccurint.t_HealthCareAccurintHCPSearchProvider outRec) := transform
		self.status := outRec.status[1];
		self.Names := project(outRec.Names,transform(Healthcare_Header_Services.Layouts.layout_nameinfo,self.gender:=left.gender[1];self:=left;));
		self.Addresses := project(outRec.Addresses,transform(Healthcare_Header_Services.Layouts.layout_addressinfo,
																													self.Phones:=project(left.Phones,transform(Healthcare_Header_Services.Layouts.layout_addressphone,self:=left));
																													self:=left;));
		self.ssns :=[];
		self.dobs := project(outRec.dobs,transform(Healthcare_Header_Services.Layouts.layout_dob,self:=left;));
		self.phones := project(outRec.phones,transform(Healthcare_Header_Services.Layouts.layout_phone,self:=left;));
		self.dids := project(outRec.dids,transform(Healthcare_Header_Services.Layouts.layout_did,self:=left;));
		self.bdids := [];
		self.bipkeys := []; 
		self.feins := project(outRec.taxids,transform(Healthcare_Header_Services.Layouts.layout_fein,self.fein:=left.taxid;self:=left;));
		self.taxids := project(outRec.taxids,transform(Healthcare_Header_Services.Layouts.layout_taxid,self:=left;));
		self.upins := project(outRec.upins,transform(Healthcare_Header_Services.Layouts.layout_upin,self:=left;));
		self.npis := project(outRec.npis,transform(Healthcare_Header_Services.Layouts.layout_npi,self:=left;));
		self.deas := project(outRec.deas,transform(Healthcare_Header_Services.Layouts.layout_dea,self:=left;));
		self.clianumbers :=[];
		self.optouts := project(outRec.optouts,transform(Healthcare_Header_Services.Layouts.layout_optout,self:=left;));
		self.StateLicenses := project(outRec.StateLicenses,transform(Healthcare_Header_Services.Layouts.layout_licenseinfo,self:=left;));
		self.affiliates := project(outRec.affiliates,transform(Healthcare_Header_Services.Layouts.layout_affiliateHospital,self:=left;));
		self.hospitals := project(outRec.hospitals,transform(Healthcare_Header_Services.Layouts.layout_affiliateHospital,self:=left;));
		self.newaffiliations := project(outRec.newaffiliations,transform(Healthcare_Header_Services.Layouts.layout_newaffiliates,self:=left;));
		self.Languages := project(outRec.Languages,transform(Healthcare_Header_Services.Layouts.layout_language,self:=left;));
		self.Degrees := project(outRec.Degrees,transform(Healthcare_Header_Services.Layouts.layout_degree,self.degree:=left.value;self:=[];));
		self.Specialties := project(outRec.Specialties,transform(Healthcare_Header_Services.Layouts.layout_specialty,self:=left;));
		self.Residencies :=[];
		self.MedSchools := project(outRec.MedSchools,transform(Healthcare_Header_Services.Layouts.layout_medschool,self:=left;));
		self.Taxonomy := project(outRec.Taxonomy,transform(Healthcare_Header_Services.Layouts.layout_taxonomy,self:=left;));
		self.sources := project(outRec.sources,transform(Healthcare_Header_Services.Layouts.layout_SrcID,self:=left;));
		self.Sanctions := project(outRec.Sanctions,transform(Healthcare_Header_Services.Layouts.layout_sanctions,self:=left;));
		self.LegacySanctions := project(outRec.LegacySanctions,transform(Healthcare_Header_Services.Layouts.layout_LegacySanctions,self:=left;));
		self.SrcRecRaw :=[];
		self.NPIRaw := project(outRec.NPIRaw,transform(iesp.npireport.t_NPIReport,
																										self.EntityInformation := left.EntityInformation;
																										self.NPIInformation := left.NPIInformation;
																										self.ProviderMailingAddress := left.ProviderMailingAddress;
																										self.ProviderPracticeAddress := left.ProviderPracticeAddress;
																										self.ProviderTaxonomies := project(left.ProviderTaxonomies,transform(iesp.npireport.t_ProviderTaxonomies,self:=left));
																										self.OtherProviderIdentifiers := project(left.OtherProviderIdentifiers,transform(iesp.npireport.t_ProviderIdentifiers,self:=left));
																										self:=left;));
		self.DEARaw := project(outRec.DEARaw,transform(iesp.healthcare.t_DEAControlledSubstanceRecordEx,
																										self.address.StreetNumber := left.address.prim_range;
																										self.address.StreetPreDirection := left.address.predir;
																										self.address.StreetName := left.address.prim_name;
																										self.address.StreetSuffix := left.address.addr_suffix;
																										self.address.StreetPostDirection := left.address.postdir;
																										self.address.UnitDesignation := left.address.unit_desig;
																										self.address.UnitNumber := left.address.sec_range;
																										self.address.StreetAddress1 := left.address.Address1;
																										self.address.StreetAddress2 := left.address.Address2;
																										self.address.City := if(left.address.p_city_name<>'',left.address.p_city_name,left.address.v_city_name);
																										self.address.State := left.address.St;
																										self.address.Zip5 := left.address.Z5;
																										self.address.Zip4 := left.address.Zip4;
																										self.address.County := left.address.county;
																										self.address.PostalCode := left.address.postalcode;
																										self.address.StateCityZip := left.address.statecityzip;
																										self:=left;
																										self:=[];));
		self.ProfLicRaw := project(outRec.ProfLicRaw,transform(iesp.proflicense.t_ProfessionalLicenseRecord,
																										self.address.StreetNumber := left.address.prim_range;
																										self.address.StreetPreDirection := left.address.predir;
																										self.address.StreetName := left.address.prim_name;
																										self.address.StreetSuffix := left.address.addr_suffix;
																										self.address.StreetPostDirection := left.address.postdir;
																										self.address.UnitDesignation := left.address.unit_desig;
																										self.address.UnitNumber := left.address.sec_range;
																										self.address.StreetAddress1 := left.address.Address1;
																										self.address.StreetAddress2 := left.address.Address2;
																										self.address.City := if(left.address.p_city_name<>'',left.address.p_city_name,left.address.v_city_name);
																										self.address.State := left.address.St;
																										self.address.Zip5 := left.address.Z5;
																										self.address.Zip4 := left.address.Zip4;
																										self.address.County := left.address.county;
																										self.address.PostalCode := left.address.postalcode;
																										self.address.StateCityZip := left.address.statecityzip;
																										self:=left;
																										self:=[];));
		self.abmsRaw := project(outRec.abmsRaw,transform(iesp.abms.t_ABMSResults,
																										self.Addresses := project(left.addresses,transform(iesp.abms.t_ABMSAddressInfo,
																																																				self.address.StreetNumber := left.address.prim_range;
																																																				self.address.StreetPreDirection := left.address.predir;
																																																				self.address.StreetName := left.address.prim_name;
																																																				self.address.StreetSuffix := left.address.addr_suffix;
																																																				self.address.StreetPostDirection := left.address.postdir;
																																																				self.address.UnitDesignation := left.address.unit_desig;
																																																				self.address.UnitNumber := left.address.sec_range;
																																																				self.address.StreetAddress1 := left.address.Address1;
																																																				self.address.StreetAddress2 := left.address.Address2;
																																																				self.address.City := if(left.address.p_city_name<>'',left.address.p_city_name,left.address.v_city_name);
																																																				self.address.State := left.address.St;
																																																				self.address.Zip5 := left.address.Z5;
																																																				self.address.Zip4 := left.address.Zip4;
																																																				self.address.County := left.address.county;
																																																				self.address.PostalCode := left.address.postalcode;
																																																				self.address.StateCityZip := left.address.statecityzip;
																																																				self:=left;));
																										self.Contacts := project(left.Contacts,transform(iesp.abms.t_ABMSContactInfo,self:=left));
																										self.UniqueIds := Project(left.UniqueIds, transform(iesp.share.t_StringArrayItem, self:=left));
																										self.BusinessIds := Project(left.BusinessIds, transform(iesp.share.t_StringArrayItem, self:=left));
																										self.RecordSources := Project(left.RecordSources, transform(iesp.share.t_StringArrayItem, self:=left));
																										self.TypeOfPractices := Project(left.TypeOfPractices, transform(iesp.abms.t_ABMSTypeOfPractice, self:=left));
																										self.Certifications := Project(left.Certifications, transform(iesp.abms.t_ABMSCertificate, self:=left));
																										self.CareerHistory := Project(left.CareerHistory, transform(iesp.abms.t_ABMSCareer, self:=left));
																										self.EducationHistory := Project(left.EducationHistory, transform(iesp.abms.t_ABMSEducation, self:=left));
																										self.ProfessionalAssociations := Project(left.ProfessionalAssociations, transform(iesp.abms.t_ABMSProfessionalAssociation, self:=left));
																										self:=left;));
		self.CLIARaw := [];
		self.NCPDPRaw := [];
		self.VerificationInfo := project(outRec.VerificationInfo,transform(Healthcare_Header_Services.Layouts.Verifications,self:=left));
		self:=outRec;
		self:=[];
	end;
	Export toInternalLayout(iesp.healthcare_prvaccurint.t_HealthCareAccurintHCPSearchResponse outRec) := function
		// recs	:= project(outRec.response.healthcareproviders,setInternalLayout(left));		
		searchResults := outRec.HealthCareProviders;
		recs:=project(searchResults,setInternalLayout(left));
		return recs;
	end;
End;