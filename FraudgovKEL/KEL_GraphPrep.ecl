
EXPORT KEL_GraphPrep := MODULE

  IMPORT FraudgovKEL, FraudGovPlatform_Analytics, FraudGovPlatform, Data_services, Std;

	
  // LEAVING THIS HERE FOR R&D to switch in to limit compile times.
  /*
jr := RECORD
  integer1 entitytype;
  string label;
  integer1 riskindx;
  integer1 aotcurrprofflag;
  integer1 aotkractflagev;
  integer1 aotsafeactflagev;
  unsigned8 aotkractnewdtev;
  unsigned8 aotkractcntev;
  unsigned8 aotnonstactcntev;
  unsigned8 aotnewkraftidactcntev;
  unsigned8 aotidactcnt30d;
  unsigned8 aotnonstactcnt30d;
  unsigned8 aotnewkraftnonstactcntev;
  unsigned8 aothiidcurrprofusngcntev;
  unsigned8 aotidusngcntev;
  unsigned8 aotidactcntev;
  unsigned8 aotidcurrprofusngcntev;
  unsigned1 not_aotkractflagev;
  unsigned1 not_aotsafeactflagev;
  string customerprogramdescription;
  integer8 industrytype;
  integer8 customerid;
  string entitycontextuid;
  integer8 recordid;
  string caseid;
  unsigned4 eventdate;
  string ottoaddressid;
  unsigned4 deceaseddate;
  unsigned4 deceaseddateofbirth;
  string deceasedfirst;
  string deceasedmiddle;
  string deceasedlast;
  string phonenumber;
  string ottoemailid;
  string ottoipaddressid;
  string ottodriverslicenseid;
  integer8 currentlyincarceratedflag;
  integer8 deceased;
  integer8 eventage;
  integer8 contributorsafeflag;
  integer8 safeflag;
  integer8 incustomerpopulation;
  integer8 addressisvacant;
  integer8 addressiscmra;
  integer8 addressispobox;
  integer8 invalidaddress;
  integer8 addressoutofstate;
  string unique_number;
  string mac_address;
  string serial_number;
  string device_type;
  string device_identification_provider;
  string routingnumber2;
  integer8 addreventcount;
  integer8 ssneventcount;
  integer8 personeventcount;
  integer8 phoneeventcount;
  integer8 emaileventcount;
  integer8 ipeventcount;
  integer8 bankaccounteventcount;
  integer8 driverslicenseeventcount;
  integer8 addrevent30count;
  integer8 ssnevent30count;
  integer8 personevent30count;
  integer8 phoneevent30count;
  integer8 emailevent30count;
  integer8 ipevent30count;
  integer8 bankaccountevent30count;
  integer8 driverslicenseevent30count;
  integer8 addrevent365count;
  integer8 ssnevent365count;
  integer8 personevent365count;
  integer8 phoneevent365count;
  integer8 emailevent365count;
  integer8 ipevent365count;
  integer8 bankaccountevent365count;
  integer8 driverslicenseevent365count;
  string rin_sourcelabel;
  integer8 rin_source;
  integer8 addreventafterkrflag;
  integer8 ssneventafterkrflag;
  integer8 personeventafterkrflag;
  integer8 phoneeventafterkrflag;
  integer8 emaileventafterkrflag;
  integer8 ipeventafterkrflag;
  integer8 bankaccounteventafterkrflag;
  integer8 driverslicenseeventafterkrflag;
  integer8 addreventafterkrcount;
  integer8 ssneventafterkrcount;
  integer8 personeventafterkrcount;
  integer8 phoneeventafterkrcount;
  integer8 emaileventafterkrcount;
  integer8 ipeventafterkrcount;
  integer8 bankaccounteventafterkrcount;
  integer8 driverslicenseeventafterkrcount;
  integer8 kreventafterknownrisk;
  integer8 krpersonprofileflag;
  integer8 kremailprofileflag;
  integer8 kraddressprofileflag;
  integer8 kripprofileflag;
  integer8 krssnprofileflag;
  integer8 krphoneprofileflag;
  integer8 krbankaccountprofileflag;
  integer8 krdriverslicenseprofileflag;
  integer8 idislasteventid;
  integer8 emlislasteventid;
  integer8 addrislasteventid;
  integer8 ipislasteventid;
  integer8 bnkislasteventid;
  integer8 dlislasteventid;
  integer8 ssnislasteventid;
  integer8 phislasteventid;
  string personlabel;
  string emaillabel;
  string addresslabel;
  string iplabel;
  string bankaccountlabel;
  string driverslicenselabel;
  string ssnlabel;
  string phonelabel;
  string addressentitycontextuid;
  string ssnentitycontextuid;
  string personentitycontextuid;
  string phoneentitycontextuid;
  string emailentitycontextuid;
  string ipentitycontextuid;
  string bankaccountentitycontextuid;
  string driverslicenseentitycontextuid;
  string streetaddress;
  string city;
  string state;
  string zip;
  integer8 agencyuid;
  integer8 agencyprogtype;
  string agencyprogdesc;
  string agencyprogjurst;
  integer8 t_srcagencyuid;
  integer8 t_srcagencyprogtype;
  integer8 t_actuid;
  unsigned4 t_actdtecho;
  integer8 t_srctype;
  string t_srcdesc;
  integer8 t_srcclasstype;
  integer8 t_personuidecho;
  string t_inpclnaddrstreetecho;
  string t_inpclnmiddlenmecho;
  string t_inpcaseidecho;
  string t_inpdvcidecho;
  string t_inpclntitleecho;
  string t_inpclnfirstnmecho;
  string t_inpclnlastnmecho;
  string t_inpclnnmsuffixecho;
  string t_inpclnaddrprimrangeecho;
  string t_inpclnaddrpredirecho;
  string t_inpclnaddrprimnmecho;
  string t_inpclnaddrsuffixecho;
  string t_inpclnaddrpostdirecho;
  string t_inpclnaddrunitdesigecho;
  string t_inpclnaddrsecrangeecho;
  string t_inpclnaddrcityecho;
  string t_inpclnaddrstecho;
  string t_inpclnaddrzip5echo;
  string t_inpclnaddrzip4echo;
  real8 t_inpclnaddrlatecho;
  real8 t_inpclnaddrlongecho;
  string t_inpclnaddrcountyecho;
  integer8 t_inpclnaddrgeoblkecho;
  string t_inpclnssnecho;
  integer8 t_inpclndobecho;
  string t_inpclndlecho;
  string t_inpclndlstecho;
  string t_inpclnemailecho;
  string t_inpclnbnkacctecho;
  string t_inpclnbnkacctrtgecho;
  string t_inpclnipaddrecho;
  string t_inpclnphnecho;
  integer8 t1_lexidpopflag;
  integer8 t1_rinidpopflag;
  integer8 t18_isipmetahitflag;
  string t18_ipaddrcity;
  string t18_ipaddrcountry;
  string t18_ipaddrregion;
  string t18_ipaddrdomain;
  string t18_ipaddrispnm;
  string t18_ipaddrloctype;
  string t18_ipaddrproxytype;
  string t18_ipaddrproxydesc;
  integer8 t18_ipaddrisispflag;
  string t18_ipaddrasncompnm;
  string t18_ipaddrasn;
  string t18_ipaddrcompnm;
  string t18_ipaddrorgnm;
  integer8 t18_ipaddrhostedflag;
  integer8 t18_ipaddrvpnflag;
  integer8 t18_ipaddrtornodeflag;
  integer8 t18_ipaddrlocnonusflag;
  integer8 t18_ipaddrlocmiamiflag;
  integer8 t19_bnkacctpopflag;
  integer8 t19_isbnkapphitflag;
  string t19_bnkacctbnknm;
  integer8 t19_bnkaccthrprepdrtgflag;
  integer8 t17_emailpopflag;
  string t17_emaildomain;
  integer8 t17_emaildomaindispflag;
  integer8 t9_addrpopflag;
  string t9_addrtype;
  string t9_addrstatus;
  integer8 t16_phnpopflag;
  integer8 t15_ssnpopflag;
  integer8 t20_dlpopflag;
  integer8 t18_ipaddrpopflag;
  integer8 t_inagencyflag;
  integer8 t15_ssniskrflag;
  integer8 t20_dliskrflag;
  integer8 t9_addriskrflag;
  integer8 t16_phniskrflag;
  integer8 t17_emailiskrflag;
  integer8 t18_ipaddriskrflag;
  integer8 t19_bnkacctiskrflag;
  integer8 t1_idiskrgenfrdflag;
  integer8 t1_idiskrstolidflag;
  integer8 t1_idiskrappfrdflag;
  integer8 t1_idiskrothfrdflag;
  integer8 t1_idiskrflag;
  integer8 t_firstnmpopflag;
  integer8 t_lastnmpopflag;
  integer8 t_dobpopflag;
  integer8 p1_aotidcurrprofflag;
  integer8 p9_aotaddrcurrprofflag;
  integer8 p15_aotssncurrprofflag;
  integer8 p20_aotdlcurrprofflag;
  integer8 p16_aotphncurrprofflag;
  integer8 p17_aotemailcurrprofflag;
  integer8 p18_aotipaddrcurrprofflag;
  integer8 p19_aotbnkacctcurrprofflag;
  integer8 p1_aotidkractcntev;
  integer8 p1_aotidkractflagev;
  integer8 p1_aotidkractshrdcntev;
  integer8 p1_aotidkractshrdflagev;
  integer8 p1_aotidkractolddtev;
  integer8 p1_aotidkractnewdtev;
  integer8 p1_aotidkractshrdolddtev;
  integer8 p1_aotidkractshrdnewdtev;
  integer8 p1_aotidkrappfrdactcntev;
  integer8 p1_aotidkrappfrdactflagev;
  integer8 p1_aotidkrappfrdactshrdcntev;
  integer8 p1_aotidkrappfrdactshrdflagev;
  integer8 p1_aotidkrappfrdactolddtev;
  integer8 p1_aotidkrappfrdactnewdtev;
  integer8 p1_aotidkrappfrdactshrdolddtev;
  integer8 p1_aotidkrappfrdactshrdnewdtev;
  integer8 p1_aotidkrgenfrdactcntev;
  integer8 p1_aotidkrgenfrdactflagev;
  integer8 p1_aotidkrgenfrdactshrdcntev;
  integer8 p1_aotidkrgenfrdactshrdflagev;
  integer8 p1_aotidkrgenfrdactolddtev;
  integer8 p1_aotidkrgenfrdactnewdtev;
  integer8 p1_aotidkrgenfrdactshrdolddtev;
  integer8 p1_aotidkrgenfrdactshrdnewdtev;
  integer8 p1_aotidkrothfrdactcntev;
  integer8 p1_aotidkrothfrdactflagev;
  integer8 p1_aotidkrothfrdactshrdcntev;
  integer8 p1_aotidkrothfrdactshrdflagev;
  integer8 p1_aotidkrothfrdactolddtev;
  integer8 p1_aotidkrothfrdactnewdtev;
  integer8 p1_aotidkrothfrdactshrdolddtev;
  integer8 p1_aotidkrothfrdactshrdnewdtev;
  integer8 t_evttype1statuscodeecho;
  integer8 t_evttype2statuscodeecho;
  integer8 t_evttype3statuscodeecho;
  integer8 t_idstatuscodeecho;
  integer8 t_namestatuscodeecho;
  integer8 t_addrstatuscodeecho;
  integer8 t_bnkacctstatuscodeecho;
  integer8 t_dlstatuscodeecho;
  integer8 t_emailstatuscodeecho;
  integer8 t_ipaddrstatuscodeecho;
  integer8 t_phnstatuscodeecho;
  integer8 t_ssnstatuscodeecho;
  integer8 p1_aotidkrstolidactcntev;
  integer8 p1_aotidkrstolidactflagev;
  integer8 p1_aotidkrstolidactshrdcntev;
  integer8 p1_aotidkrstolidactshrdflagev;
  integer8 p1_aotidkrstolidactolddtev;
  integer8 p1_aotidkrstolidactnewdtev;
  integer8 p1_aotidkrstolidactshrdolddtev;
  integer8 p1_aotidkrstolidactshrdnewdtev;
  integer8 p9_aotaddrkractcntev;
  integer8 p9_aotaddrkractflagev;
  integer8 p9_aotaddrkractshrdcntev;
  integer8 p9_aotaddrkractshrdflagev;
  integer8 p9_aotaddrkractolddtev;
  integer8 p9_aotaddrkractnewdtev;
  integer8 p9_aotaddrkractshrdolddtev;
  integer8 p9_aotaddrkractshrdnewdtev;
  integer8 p15_aotssnkractcntev;
  integer8 p15_aotssnkractflagev;
  integer8 p15_aotssnkractshrdcntev;
  integer8 p15_aotssnkractshrdflagev;
  integer8 p15_aotssnkractolddtev;
  integer8 p15_aotssnkractnewdtev;
  integer8 p15_aotssnkractshrdolddtev;
  integer8 p15_aotssnkractshrdnewdtev;
  integer8 p16_aotphnkractcntev;
  integer8 p16_aotphnkractflagev;
  integer8 p16_aotphnkractshrdcntev;
  integer8 p16_aotphnkractshrdflagev;
  integer8 p16_aotphnkractolddtev;
  integer8 p16_aotphnkractnewdtev;
  integer8 p16_aotphnkractshrdolddtev;
  integer8 p16_aotphnkractshrdnewdtev;
  integer8 p17_aotemailkractcntev;
  integer8 p17_aotemailkractflagev;
  integer8 p17_aotemailkractshrdcntev;
  integer8 p17_aotemailkractshrdflagev;
  integer8 p17_aotemailkractolddtev;
  integer8 p17_aotemailkractnewdtev;
  integer8 p17_aotemailkractshrdolddtev;
  integer8 p17_aotemailkractshrdnewdtev;
  integer8 p18_aotipaddrkractcntev;
  integer8 p18_aotipaddrkractflagev;
  integer8 p18_aotipaddrkractshrdcntev;
  integer8 p18_aotipaddrkractshrdflagev;
  integer8 p18_aotipaddrkractolddtev;
  integer8 p18_aotipaddrkractnewdtev;
  integer8 p18_aotipaddrkractshrdolddtev;
  integer8 p18_aotipaddrkractshrdnewdtev;
  integer8 p19_aotbnkacctkractcntev;
  integer8 p19_aotbnkacctkractflagev;
  integer8 p19_aotbnkacctkractshrdcntev;
  integer8 p19_aotbnkacctkractshrdflagev;
  integer8 p19_aotbnkacctkractolddtev;
  integer8 p19_aotbnkacctkractnewdtev;
  integer8 p19_aotbnkacctkractshrdolddtev;
  integer8 p19_aotbnkacctkractshrdnewdtev;
  integer8 p20_aotdlkractcntev;
  integer8 p20_aotdlkractflagev;
  integer8 p20_aotdlkractshrdcntev;
  integer8 p20_aotdlkractshrdflagev;
  integer8 p20_aotdlkractolddtev;
  integer8 p20_aotdlkractnewdtev;
  integer8 p20_aotdlkractshrdolddtev;
  integer8 p20_aotdlkractshrdnewdtev;
  integer8 t9_addrissafeflag;
  integer8 t16_phnissafeflag;
  integer8 t18_ipaddrissafeflag;
  integer8 p9_aotaddrsafeactcntev;
  integer8 p9_aotaddrsafeactflagev;
  integer8 p9_aotaddrsafeactolddtev;
  integer8 p9_aotaddrsafeactnewdtev;
  integer8 p16_aotphnsafeactcntev;
  integer8 p16_aotphnsafeactflagev;
  integer8 p16_aotphnsafeactolddtev;
  integer8 p16_aotphnsafeactnewdtev;
  integer8 p18_aotipaddrsafeactcntev;
  integer8 p18_aotipaddrsafeactflagev;
  integer8 p18_aotipaddrsafeactolddtev;
  integer8 p18_aotipaddrsafeactnewdtev;
  integer8 t_isbcshllhitflag;
  integer8 t_bcshlllexidecho;
  integer8 t1l_lexidseenflag;
  integer8 t1l_bcshlllexidmatchesinpflag;
  integer8 t1l_idisbcshllhitflag;
  integer8 t1_idage;
  integer8 t1l_dobverindx;
  integer8 t1_napsummary;
  integer8 t1l_iddeceasedflag;
  integer8 t1l_nassummary;
  integer8 t1_cvi;
  string t1_fp3;
  integer8 t1_fp3_stolenidentityindex;
  integer8 t1_fp3_syntheticidentityindex;
  integer8 t1_fp3_manipidentityindex;
  integer8 t1l_fp_sourcerisklevel;
  integer8 t1_adultidnotseenflag;
  integer8 t1_minorwlexidflag;
  integer8 t1_ssnpriordobflag;
  integer8 t1_firstnmnotverflag;
  integer8 t1_lastnmnotverflag;
  integer8 t1_addrnotverflag;
  integer8 t1l_ssnnotverflag;
  integer8 t1l_ssnwaltnaverflag;
  integer8 t1l_ssnwaddrnotverflag;
  integer8 t1_phnnotverflag;
  integer8 t1l_dobnotverflag;
  integer8 t1_hiriskcviflag;
  integer8 t1_medriskcviflag;
  integer8 t1l_hdrsrccatcntlwflag;
  integer8 t1_stolidflag;
  integer8 t1_synthidflag;
  integer8 t1_manipidflag;
  integer8 t1l_iddtofdeathaftidactcntev;
  integer8 t1l_iddtofdeathaftidactflagev;
  string t_bcshllarchdtecho;
  string t1l_bestfirstnmecho;
  string t1l_bestlastnmecho;
  integer8 t1l_bestfirstnmpopflag;
  integer8 t1l_bestlastnmpopflag;
  string t1l_bestfullnmecho;
  string t1l_curraddrprimrangeecho;
  string t1l_curraddrpredirecho;
  string t1l_curraddrprimnmecho;
  string t1l_curraddrsuffixecho;
  string t1l_curraddrpostdirecho;
  string t1l_curraddrunitdesigecho;
  string t1l_curraddrsecrangeecho;
  string t1l_curraddrcityecho;
  string t1l_curraddrstecho;
  string t1l_curraddrzip5echo;
  integer8 t1l_curraddrpopflag;
  string t1l_curraddrfullecho;
  integer8 t1l_curraddrolddt;
  integer8 t1l_curraddrnewdt;
  string t1l_bestssnecho;
  integer8 t1l_bestssnpopflag;
  integer8 t1l_bestdobecho;
  integer8 t1l_bestdobpopflag;
  string t1l_bestphnecho;
  integer8 t1l_bestphnpopflag;
  string t1l_bestdlecho;
  string t1l_bestdlstecho;
  integer8 t1l_bestdlpopflag;
  string t1l_bestdlexpdt;
  string t1l_bestfirstnmmatchesinpflag;
  string t1l_bestlastnmmatchesinpflag;
  integer8 t1l_bestfullnmmatchesinpflag;
  integer8 t1l_curraddrmatchesinpflag;
  string t1l_bestssnmatchesinpflag;
  integer8 t1l_bestdobmatchesinpflag;
  integer8 t1l_bestphnmatchesinpflag;
  integer8 t1l_bestdlmatchesinpflag;
  integer8 t1l_curraddrnotinagcyjurstflag;
  integer8 t1l_bestdlnotinagcyjurstflag;
  integer8 p1_aotidactcntev;
  integer8 p1_aotidactcnt30d;
  integer8 p9_aotidactcntev;
  integer8 p9_aotidactcnt30d;
  integer8 p15_aotidactcntev;
  integer8 p15_aotidactcnt30d;
  integer8 p16_aotidactcntev;
  integer8 p16_aotidactcnt30d;
  integer8 p17_aotidactcntev;
  integer8 p17_aotidactcnt30d;
  integer8 p18_aotidactcntev;
  integer8 p18_aotidactcnt30d;
  integer8 p19_aotidactcntev;
  integer8 p19_aotidactcnt30d;
  integer8 p20_aotidactcntev;
  integer8 p20_aotidactcnt30d;
  integer8 p1_aotaddactcntev;
  integer8 p1_aotaddactcnt30d;
  integer8 p9_aotaddactcntev;
  integer8 p9_aotaddactcnt30d;
  integer8 p15_aotaddactcntev;
  integer8 p15_aotaddactcnt30d;
  integer8 p16_aotaddactcntev;
  integer8 p16_aotaddactcnt30d;
  integer8 p17_aotaddactcntev;
  integer8 p17_aotaddactcnt30d;
  integer8 p18_aotaddactcntev;
  integer8 p18_aotaddactcnt30d;
  integer8 p19_aotaddactcntev;
  integer8 p19_aotaddactcnt30d;
  integer8 p20_aotaddactcntev;
  integer8 p20_aotaddactcnt30d;
  integer8 p1_aotnonstactcntev;
  integer8 p1_aotnonstactcnt30d;
  integer8 p9_aotnonstactcntev;
  integer8 p9_aotnonstactcnt30d;
  integer8 p15_aotnonstactcntev;
  integer8 p15_aotnonstactcnt30d;
  integer8 p16_aotnonstactcntev;
  integer8 p16_aotnonstactcnt30d;
  integer8 p17_aotnonstactcntev;
  integer8 p17_aotnonstactcnt30d;
  integer8 p18_aotnonstactcntev;
  integer8 p18_aotnonstactcnt30d;
  integer8 p19_aotnonstactcntev;
  integer8 p19_aotnonstactcnt30d;
  integer8 p20_aotnonstactcntev;
  integer8 p20_aotnonstactcnt30d;
  integer8 p1_aotidnewkraftidactcntev;
  integer8 p9_aotaddrnewkraftidactcntev;
  integer8 p15_aotssnnewkraftidactcntev;
  integer8 p16_aotphnnewkraftidactcntev;
  integer8 p17_aotemlnewkraftidactcntev;
  integer8 p18_aotipnewkraftidactcntev;
  integer8 p19_aotbkacnewkraftidactcntev;
  integer8 p20_aotdlnewkraftidactcntev;
  integer8 p1_aotidnewkraftaddactcntev;
  integer8 p9_aotaddrnewkraftaddactcntev;
  integer8 p15_aotssnnewkraftaddactcntev;
  integer8 p16_aotphnnewkraftaddactcntev;
  integer8 p17_aotemlnewkraftaddactcntev;
  integer8 p18_aotipnewkraftaddactcntev;
  integer8 p19_aotbkacnewkraftaddactcntev;
  integer8 p20_aotdlnewkraftaddactcntev;
  integer8 p1_aotidnewkraftnonstactcntev;
  integer8 p9_aotaddrnewkraftnonstactcntev;
  integer8 p15_aotssnnewkraftnonstactcntev;
  integer8 p16_aotphnnewkraftnonstactcntev;
  integer8 p17_aotemlnewkraftnonstactcntev;
  integer8 p18_aotipnewkraftnonstactcntev;
  integer8 p19_aotbkacnewkraftnonstactcntev;
  integer8 p20_aotdlnewkraftnonstactcntev;
  integer8 p9_aotidcurrprofusngaddrcntev;
  integer8 p15_aotidcurrprofusngssncntev;
  integer8 p16_aotidcurrprofusngphncntev;
  integer8 p17_aotidcurrprofusngemlcntev;
  integer8 p18_aotidcurrprofusngipcntev;
  integer8 p19_aotidcurrprofusngbkaccntev;
  integer8 p20_aotidcurrprofusngdlcntev;
  integer8 p9_aotidhistprofusngaddrcntev;
  integer8 p15_aotidhistprofusngssncntev;
  integer8 p16_aotidhistprofusngphncntev;
  integer8 p17_aotidhistprofusngemlcntev;
  integer8 p18_aotidhistprofusngipcntev;
  integer8 p19_aotidhistprofusngbkaccntev;
  integer8 p20_aotidhistprofusngdlcntev;
  integer8 p9_aotidusngaddrcntev;
  integer8 p15_aotidusngssncntev;
  integer8 p16_aotidusngphncntev;
  integer8 p17_aotidusngemailcntev;
  integer8 p18_aotidusngipaddrcntev;
  integer8 p19_aotidusngbnkacctcntev;
  integer8 p20_aotidusngdlcntev;
  integer8 p1_aotidnaccollactcntev;
  integer8 p1_aotidnaccollflagev;
  integer8 p1_aotidnaccollnewdt;
  integer8 p1_aotidnaccollnewtype;
  integer8 p1_idriskunscrbleflag;
  integer8 p9_addrriskunscrbleflag;
  integer8 p15_ssnriskunscrbleflag;
  integer8 p16_phnriskunscrbleflag;
  integer8 p17_emailriskunscrbleflag;
  integer8 p18_ipaddrriskunscrbleflag;
  integer8 p19_bnkacctriskunscrbleflag;
  integer8 p20_dlriskunscrbleflag;
  integer8 t1l_idcurrincarcflag;
  string t_inpclnfullnmecho;
  string t_acttmecho;
  string t_inpaddrtypeecho;
  string t_inpclnmailingaddrstreetecho;
  string t_inpclnmailingaddrcityecho;
  string t_inpclnmailingaddrstecho;
  string t_inpclnmailingaddrzipecho;
  string t_inpphncontacttypeecho;
  string t_inpclncellphnecho;
  string t_inpclnworkphnecho;
  string t_inpclnbnkacct2echo;
  string t_inpclnbnkacctrtg2echo;
  string t_inpethnicityecho;
  string t_inpraceecho;
  string t_inpheadofhhecho;
  string t_inprelationshipecho;
  string t_inpdvcuniquenumecho;
  string t_inpdvcmacaddrecho;
  string t_inpdvcserialnumecho;
  string t_inpdvctypeecho;
  string t_inpdvcidprovecho;
  integer8 t_inpdvclatecho;
  integer8 t_inpdvclongecho;
  string t_inpinvestigatoridecho;
  string t_inpreferralcaseidecho;
  string t_inpreferraltypedescecho;
  string t_inpreferralreasondescecho;
  string t_inpreferraldispositionecho;
  string t_inpclearedfraudecho;
  string t_inpreasondescecho;
  string t_inpclientidecho;
  string t_agencyusernm;
  string t_statusactiondesc;
  string t_inpclearedreasonecho;
  integer8 t1_idinvupdflag;
  integer8 t1l_iddtofdeath;
  integer8 t1l_idcrimflsdmatchflag;
  integer8 t1l_idcrimhitflag;
  integer8 t1_minoridflag;
  integer8 t9_idcurrprofusngaddrcntev;
  integer8 t15_idcurrprofusngssncntev;
  integer8 t20_idcurrprofusngdlcntev;
  integer8 t19_idcurrprofusngbnkacctcntev;
  integer8 t9_addrvaltype;
  string t9_addrmaildroptype;
  integer8 t15_ssnvaltype;
  integer8 t20_dlvaltype;
  integer8 t16_phnvaltype;
  integer8 t16_isphnmetahitflag;
  integer8 t16_phnmetanewvenddt;
  integer8 t16_phnmetaoldvenddt;
  integer8 t9_addrpoboxmultcurridflagev;
  integer8 t9_addrisvacantflag;
  integer8 t9_addrisinvalidflag;
  integer8 t9_addriscmraflag;
  integer8 t15_ssnmultcurridflagev;
  integer8 t15_ssnisinvalidflag;
  integer8 t20_dlmultcurridflagev;
  integer8 t20_dlisinvalidflag;
  string t16_phnprepdflag;
  integer8 t16_phnisinvalidflag;
  integer8 t19_bnkacctmultcurridflagev;
  integer8 p1_idactolddt;
  integer8 p9_idactolddt;
  integer8 p15_idactolddt;
  integer8 p16_idactolddt;
  integer8 p17_idactolddt;
  integer8 p18_idactolddt;
  integer8 p19_idactolddt;
  integer8 p20_idactolddt;
  string t_addrstatusdesc;
  string t_bnkacctstatusdesc;
  string t_dlstatusdesc;
  string t_emailstatusdesc;
  string t_evttype1statusdesc;
  string t_evttype2statusdesc;
  string t_evttype3statusdesc;
  string t_idstatusdesc;
  string t_namestatusdesc;
  string t_ipaddrstatusdesc;
  string t_phnstatusdesc;
  string t_ssnstatusdesc;
  string t_inpdvciprovecho;
  string t_inpclnbnkacct2rtg2echo;
  integer1 p1_idriskindx;
  integer1 p15_ssnriskindx;
  integer1 p16_phnriskindx;
  integer1 p17_emailriskindx;
  integer1 p19_bnkacctriskindx;
  integer1 p20_dlriskindx;
  integer1 p18_ipaddrriskindx;
  integer1 p9_addrriskindx;
  unsigned8 iscurrent;
  unsigned8 ishistorical;
 END;


    SHARED EntityEventPivot := DATASET('~gov::otto::eventpivot', jr, THOR);
*/
  SHARED EntityEventPivot := FraudgovKEL.KEL_EventPivot.EventPivotShell;

  // build only for profile records in pivot
  EXPORT LinksPrep := JOIN(EntityEventPivot(iscurrent = 1), EntityEventPivot, 
                   LEFT.customerid = RIGHT.customerid AND LEFT.industrytype=RIGHT.industrytype AND LEFT.recordid=RIGHT.recordid AND LEFT.entitycontextuid != RIGHT.entitycontextuid AND 
                   (LEFT.entitytype != 1 AND RIGHT.entitytype = 1 OR LEFT.entitytype = 1 AND RIGHT.entitytype != 1),
                   TRANSFORM({LEFT.customerid, LEFT.industrytype, STRING treeuid, RIGHT.entitycontextuid, LEFT.t_actdtecho}, SELF.treeuid := LEFT.entitycontextuid, SELF.entitycontextuid := RIGHT.entitycontextuid, SELF := LEFT), HASH);
 
  // Zero Degree
  SHARED Links0 := PROJECT(DEDUP(SORT(LinksPrep, customerid, industrytype, treeuid, LOCAL), customerid, industrytype, treeuid, LOCAL), TRANSFORM(RECORDOF(LEFT), SELF.entitycontextuid := LEFT.treeuid, SELF := LEFT));
  // 1st degree
  SHARED Links1Prep := JOIN(DISTRIBUTE(LinksPrep, HASH64(entitycontextuid)), 
					      DISTRIBUTE(LinksPrep, HASH64(treeuid)),
                   LEFT.customerid = RIGHT.customerid AND LEFT.industrytype = RIGHT.industrytype AND LEFT.entitycontextuid = RIGHT.treeuid AND LEFT.treeuid != RIGHT.entitycontextuid,
                   TRANSFORM(RECORDOF(LEFT), SELF.treeuid := LEFT.treeuid, SELF.entitycontextuid := RIGHT.entitycontextuid, SELF := LEFT), LOCAL);
				   				   
  EXPORT Links1 := DEDUP(SORT(DISTRIBUTE(Links1Prep, HASH64(treeuid)), customerid, industrytype, treeuid, entitycontextuid), customerid, industrytype, treeuid, entitycontextuid);
                     
  EXPORT LinksFinal := DEDUP(SORT(DISTRIBUTE(Links0 + LinksPrep + Links1, HASH32(treeuid)), customerid, industrytype, treeuid, entitycontextuid, -t_actdtecho, LOCAL), customerid, industrytype, treeuid, entitycontextuid, LOCAL);

  GraphFinal := JOIN(LinksFinal, EntityEventPivot, LEFT.customerid = RIGHT.customerid AND LEFT.industrytype = RIGHT.industrytype AND LEFT.entitycontextuid = RIGHT.entitycontextuid, 
                  TRANSFORM({LEFT.customerid, LEFT.industrytype, LEFT.treeuid, LEFT.entitycontextuid, RIGHT.t_actdtecho, RIGHT.entitytype, RIGHT.label, 
                    RIGHT.riskindx, RIGHT.aotkractflagev, RIGHT.aotsafeactflagev, RIGHT.personeventcount,
                    RIGHT.t_inpclndobecho, RIGHT.t1L_iddeceasedflag, RIGHT.aotidactcntev, RIGHT.deceaseddate, RIGHT.T1_MinorIDFlag}, 
                    SELF.customerid := LEFT.customerid, SELF.treeuid := LEFT.treeuid, SELF.entitycontextuid := LEFT.entitycontextuid, SELF := RIGHT),
                 KEEP(1), HASH) : PERSIST('~fraudgov::tempfraudgov::temp::persist::entities');

  EXPORT Vertices := GraphFinal;

  EdgesFinal := JOIN(LinksFinal, LinksPrep(treeuid[2..3] = '01'), LEFT.customerid = RIGHT.customerid AND LEFT.industrytype = RIGHT.industrytype AND LEFT.entitycontextuid = RIGHT.treeuid,
                TRANSFORM({LEFT.customerid, LEFT.industrytype, LEFT.treeuid, STRING fromentitycontextuid, STRING toentitycontextuid, RIGHT.t_actdtecho}, 
                SELF.fromentitycontextuid := RIGHT.treeuid, SELF.toentitycontextuid := RIGHT.entitycontextuid, SELF.t_actdtecho := RIGHT.t_actdtecho, SELF := LEFT), HASH);// : PERSIST('~fraudgov::tempfraudgov::temp::persist::edges');

  EXPORT Edges := EdgesFinal;	

END;
