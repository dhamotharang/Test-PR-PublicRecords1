import doxie_build,Criminal_Records,dops,DOPSGrowthCheck, corrections;
export proc_build_DOC_keys(string filedate) := function

GetDops:=dops.GetDeployedDatasets('P','B','F');
OnlyCrim:=GetDops(datasetname='DOCKeys');
father_filedate := OnlyCrim[1].buildversion;
set of string	DistSet:=['offender_key'];
set of string InputSet_PunishmentType:=['ok','pt','process_date','event_dt','vendor','punishment_type','sent_date','sent_length','cur_stat_inm_desc','latest_adm_dt','sch_rel_dt','act_rel_dt','ctl_rel_dt','release_type','par_cur_stat_desc','par_status_dt','par_st_dt','par_sch_end_dt','par_act_end_dt','par_cty','cur_loc_inm','cur_loc_sec','presump_par_rel_dt','sent_length_desc','offender_key'];
set of string PersistFieldsSet_PunishmentType:=['offender_key','event_dt','vendor','punishment_type','sent_date','sent_length','cur_stat_inm_desc','latest_adm_dt','sch_rel_dt','act_rel_dt','ctl_rel_dt','release_type','par_cur_stat_desc','par_status_dt','par_st_dt','par_sch_end_dt','par_act_end_dt','par_cty','pro_st_dt','pro_end_dt','pro_status','cur_loc_inm','cur_loc_sec','presump_par_rel_dt','sent_length_desc'];
set of string InputSet_Offenders:=['offender_key','id_num','pty_nm','case_num','orig_lname','orig_fname','orig_mname','orig_name_suffix','pty_typ','case_court','case_date','case_type','case_type_desc','dle_num','fbi_num','doc_num','ins_num','dl_num','dl_state','dob','street_address_1','street_address_2','street_address_3','street_address_4','street_address_5','race','race_desc','height','sex','skin_color','skin_color_desc','eye_color','eye_color_desc','hair_color','hair_color_desc','Party_status_desc','weight'];
set of string InputSet_Offense := ['offender_key','off_date','case_num','off_code','off_desc_1','off_desc_2','off_typ','off_lev','arr_date','stc_desc_1','stc_desc_2','stc_desc_3','stc_desc_4','min_term','min_term_desc','max_term','max_term_desc','parole','offensetown','stc_dt','probation','inc_adm_dt','ct_disp_dt','ct_disp_desc_1','cty_conv','convict_dt','stc_comp','stc_lgth','stc_lgth_desc','num_of_counts','chg','court_desc','add_off_desc'];	
set of string key_corrections_DistSet:=['offender_key'];
set of string DistSet_court_offenses :=['offense_persistent_id'] ;
set of string InputSet_court_offenses := ['offender_key','vendor','state_origin','source_file','data_type','off_comp','off_delete_flag',   'off_date','arr_date','num_of_counts','le_agency_cd','le_agency_desc','le_agency_case_number',   'traffic_ticket_number','traffic_dl_no','traffic_dl_st','arr_off_code','arr_off_desc_1',   'arr_off_desc_2','arr_off_type_cd','arr_off_type_desc','arr_off_lev','arr_statute','arr_statute_desc',   'arr_disp_date','arr_disp_code','arr_disp_desc_1','arr_disp_desc_2','pros_refer_cd','pros_refer',   'pros_assgn_cd','pros_assgn','pros_chg_rej','pros_off_code','pros_off_desc_1','pros_off_desc_2',   'pros_off_type_cd','pros_off_type_desc','pros_off_lev','pros_act_filed','court_case_number',   'court_cd','court_desc','court_appeal_flag','court_final_plea','court_off_code','court_off_desc_1',   'court_off_desc_2','court_off_type_cd','court_off_type_desc','court_off_lev','court_statute',   'court_additional_statutes','court_statute_desc','court_disp_date','court_disp_code',   'court_disp_desc_1','court_disp_desc_2','sent_date','sent_jail','sent_susp_time',   'sent_court_cost','sent_court_fine','sent_susp_court_fine','sent_probation','sent_addl_prov_code',   'sent_addl_prov_desc_1','sent_addl_prov_desc_2','sent_consec','sent_agency_rec_cust_ori',   'sent_agency_rec_cust','appeal_date','appeal_off_disp','appeal_final_decision','convict_dt',   'offense_town','cty_conv','restitution','community_service','parole','addl_sent_dates',   'probation_desc2','court_dt','court_county','arr_off_lev_mapped','court_off_lev_mapped','fcra_offense_key','fcra_conviction_flag','fcra_traffic_flag','fcra_date','fcra_date_type',   'conviction_override_date','conviction_override_date_type','offense_score','offense_category'] ;
  							
	
DeltaCommands:=sequential(
DOPSGrowthCheck.CalculateStats('DOCKeys','hygenics_crim.key_prep_punishment(true)', 'key_offender_punishment',	'~thor_data400::key::corrections_punishment::'+filedate+'::public',	'ok,pt',	'punishment_persistent_id',	'','','','',	filedate,	father_filedate, true, true)
,DOPSGrowthCheck.CalculateStats('DOCKeys','hygenics_crim.key_prep_offenders(true)','key_offenders','~thor_data400::key::corrections_offenders::'+filedate+'::public','sdid','offender_persistent_id','','','','',filedate,father_filedate,true,true)
,DOPSGrowthCheck.CalculateStats('DOCKeys','hygenics_crim.key_prep_offenses(true)',  'key_offenses',  '~thor_data400::key::corrections_offenses::'+filedate+'::public',  'ok',  'offense_persistent_id',  '',  '',  '',  '',  filedate,  father_filedate,  true,  true)
,DOPSGrowthCheck.CalculateStats('DOCKeys','hygenics_crim.key_prep_offenders_OffenderKey(true)','key_offender_offenderkey','~thor_data400::key::corrections_offenders::'+filedate+'::offenderkey_public','ofk','offender_persistent_id','','','','',filedate,father_filedate,true,true)
,DOPSGrowthCheck.CalculateStats('DOCKeys', 'hygenics_crim.key_prep_courtoffenses(true)', 'key_court_offenses', '~thor_data400::key::corrections_court_offenses::'+filedate+'::public', 'ofk', 'offense_persistent_id', '', '', '', '', filedate, father_filedate, true, true)
,DOPSGrowthCheck.DeltaCommand('~thor_data400::key::corrections_punishment::'+filedate+'::public','~thor_data400::key::corrections_punishment::'+father_filedate+'::public','DOCKeys','key_offender_punishment','hygenics_crim.key_prep_punishment(true)','punishment_persistent_id',filedate,father_filedate,InputSet_PunishmentType)
,DOPSGrowthCheck.DeltaCommand('~thor_data400::key::corrections_offenders::'+filedate+'::public','~thor_data400::key::corrections_offenders::'+father_filedate+'::public','DOCKeys','key_offenders','hygenics_crim.key_prep_offenders(true)','offender_persistent_id',filedate,father_filedate,['offender_persistent_id'])
,DOPSGrowthCheck.DeltaCommand('~thor_data400::key::corrections_offenses::'+filedate+'::public', '~thor_data400::key::corrections_offenses::'+father_filedate+'::public', 'DOCKeys', 'key_offenses', 'hygenics_crim.key_prep_offenses(true)', 'offense_persistent_id', filedate, father_filedate, InputSet_Offense)
,DOPSGrowthCheck.DeltaCommand('~thor_data400::key::corrections_offenders::'+filedate+'::offenderkey_public','~thor_data400::key::corrections_offenders::'+father_filedate+'::offenderkey_public','DOCKeys','key_offender_offenderkey','hygenics_crim.key_prep_offenders_OffenderKey(true)','offender_persistent_id',filedate,father_filedate,['offender_persistent_id'])
,DOPSGrowthCheck.DeltaCommand('~thor_data400::key::corrections_court_offenses::'+filedate+'::public', '~thor_data400::key::corrections_court_offenses::'+father_filedate+'::public', 'DOCKeys', 'key_court_offenses', 'hygenics_crim.key_prep_courtoffenses(true)', 'offense_persistent_id', filedate, father_filedate, ['ofk','offense_persistent_id','offender_key','vendor'])
,DOPSGrowthCheck.ChangesByField('~thor_data400::key::corrections_punishment::'+filedate+'::public',	'~thor_data400::key::corrections_punishment::'+father_filedate+'::public',	'DOCKeys',	'key_offender_punishment',	'hygenics_crim.key_prep_punishment(true)',	'punishment_persistent_id',	'',	filedate,	father_filedate)
,DOPSGrowthCheck.ChangesByField('~thor_data400::key::corrections_offenders::'+filedate+'::public','~thor_data400::key::corrections_offenders::'+father_filedate+'::public','DOCKeys','key_offenders','hygenics_crim.key_prep_offenders(true)','offender_persistent_id','',filedate,father_filedate)
,DOPSGrowthCheck.ChangesByField('~thor_data400::key::corrections_offenses::'+filedate+'::public', '~thor_data400::key::corrections_offenses::'+father_filedate+'::public', 'DOCKeys', 'key_offenses', 'hygenics_crim.key_prep_offenses(true)', 'offense_persistent_id', 'process_date', filedate, father_filedate)
,DOPSGrowthCheck.ChangesByField('~thor_data400::key::corrections_offenders::'+filedate+'::offenderkey_public','~thor_data400::key::corrections_offenders::'+father_filedate+'::offenderkey_public','DOCKeys','key_offender_offenderkey','hygenics_crim.key_prep_offenders_OffenderKey(true)','offender_persistent_id','',filedate,father_filedate)
,DOPSGrowthCheck.ChangesByField('~thor_data400::key::corrections_court_offenses::'+filedate+'::public',   '~thor_data400::key::corrections_court_offenses::'+father_filedate+'::public',   'DOCKeys',   'key_court_offenses',   'hygenics_crim.key_prep_courtoffenses(true)',   'offense_persistent_id',   'process_date',   filedate,   father_filedate)
,DopsGrowthCheck.PersistenceCheck('~thor_data400::base::corrections_punishment_public', '~thor_data400::base::corrections_punishment_public_father','DOCKeys',	'key_offender_punishment',	'hygenics_crim.layout_crimpunishment','punishment_persistent_id',	PersistFieldsSet_PunishmentType,		PersistFieldsSet_PunishmentType,		filedate,		father_filedate)
,DopsGrowthCheck.PersistenceCheck('~thor_data400::base::corrections_offenders_public','~thor_data400::base::corrections_offenders_public_father','DOCKeys','key_offenders'                     ,'hygenics_crim.layout_offender','offender_persistent_id',InputSet_Offenders,InputSet_Offenders,filedate,father_filedate)
,DOPSGrowthCheck.PersistenceCheck('~thor_data400::key::corrections_offenses::'+filedate+'::public',  '~thor_data400::key::corrections_offenses::'+father_filedate+'::public',  'DOCKeys',  'key_offenses',  'hygenics_crim.key_prep_offenses(true)',  'offense_persistent_id',  InputSet_Offense,  DistSet,  filedate,  father_filedate)
,DopsGrowthCheck.PersistenceCheck('~thor_data400::base::corrections_offenders_public','~thor_data400::base::corrections_offenders_public_father','DOCKeys','key_offender_offenderkey','hygenics_crim.layout_offender','offender_persistent_id',InputSet_Offenders,InputSet_Offenders,filedate,father_filedate,true,false)
,DOPSGrowthCheck.PersistenceCheck('~thor_data400::key::corrections_court_offenses::'+filedate+'::public', '~thor_data400::key::corrections_court_offenses::'+father_filedate+'::public', 'DOCKeys', 'key_court_offenses', 'hygenics_crim.key_prep_courtoffenses(true)', 'offense_persistent_id', InputSet_court_offenses, DistSet_court_offenses, filedate, father_filedate, true, true)
);

return sequential(
		hygenics_crim.proc_build_DOC_offenders_key(filedate),
		hygenics_crim.proc_build_DOC_fcra_offenders_key(filedate),
		hygenics_crim.proc_build_autokey(filedate),
		hygenics_crim.proc_build_DOC_offenses_key(filedate),
		hygenics_crim.proc_build_DOC_activity_key(filedate),
		hygenics_crim.proc_build_DOC_court_offenses_key(filedate),
		hygenics_crim.proc_build_DOC_punishment_key(filedate),
		DeltaCommands
		);
end;